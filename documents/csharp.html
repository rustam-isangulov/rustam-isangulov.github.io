<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2023-06-06 Tue 09:48 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Notes from the initial C# DeepDive at HZD</title>
<meta name="generator" content="Org mode" />
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #ccc;
    box-shadow: 3px 3px 3px #eee;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: auto;
    padding-top: 1.2em;
  }
  pre.src:before {
    display: none;
    position: absolute;
    background-color: white;
    top: -10px;
    right: 10px;
    padding: 3px;
    border: 1px solid black;
  }
  pre.src:hover:before { display: inline; margin-top: 14px;}
  /* Languages per Org manual */
  pre.src-asymptote:before { content: 'Asymptote'; }
  pre.src-awk:before { content: 'Awk'; }
  pre.src-C:before { content: 'C'; }
  /* pre.src-C++ doesn't work in CSS */
  pre.src-clojure:before { content: 'Clojure'; }
  pre.src-css:before { content: 'CSS'; }
  pre.src-D:before { content: 'D'; }
  pre.src-ditaa:before { content: 'ditaa'; }
  pre.src-dot:before { content: 'Graphviz'; }
  pre.src-calc:before { content: 'Emacs Calc'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-fortran:before { content: 'Fortran'; }
  pre.src-gnuplot:before { content: 'gnuplot'; }
  pre.src-haskell:before { content: 'Haskell'; }
  pre.src-hledger:before { content: 'hledger'; }
  pre.src-java:before { content: 'Java'; }
  pre.src-js:before { content: 'Javascript'; }
  pre.src-latex:before { content: 'LaTeX'; }
  pre.src-ledger:before { content: 'Ledger'; }
  pre.src-lisp:before { content: 'Lisp'; }
  pre.src-lilypond:before { content: 'Lilypond'; }
  pre.src-lua:before { content: 'Lua'; }
  pre.src-matlab:before { content: 'MATLAB'; }
  pre.src-mscgen:before { content: 'Mscgen'; }
  pre.src-ocaml:before { content: 'Objective Caml'; }
  pre.src-octave:before { content: 'Octave'; }
  pre.src-org:before { content: 'Org mode'; }
  pre.src-oz:before { content: 'OZ'; }
  pre.src-plantuml:before { content: 'Plantuml'; }
  pre.src-processing:before { content: 'Processing.js'; }
  pre.src-python:before { content: 'Python'; }
  pre.src-R:before { content: 'R'; }
  pre.src-ruby:before { content: 'Ruby'; }
  pre.src-sass:before { content: 'Sass'; }
  pre.src-scheme:before { content: 'Scheme'; }
  pre.src-screen:before { content: 'Gnu Screen'; }
  pre.src-sed:before { content: 'Sed'; }
  pre.src-sh:before { content: 'shell'; }
  pre.src-sql:before { content: 'SQL'; }
  pre.src-sqlite:before { content: 'SQLite'; }
  /* additional languages in org.el's org-babel-load-languages alist */
  pre.src-forth:before { content: 'Forth'; }
  pre.src-io:before { content: 'IO'; }
  pre.src-J:before { content: 'J'; }
  pre.src-makefile:before { content: 'Makefile'; }
  pre.src-maxima:before { content: 'Maxima'; }
  pre.src-perl:before { content: 'Perl'; }
  pre.src-picolisp:before { content: 'Pico Lisp'; }
  pre.src-scala:before { content: 'Scala'; }
  pre.src-shell:before { content: 'Shell Script'; }
  pre.src-ebnf2ps:before { content: 'ebfn2ps'; }
  /* additional language identifiers per "defun org-babel-execute"
       in ob-*.el */
  pre.src-cpp:before  { content: 'C++'; }
  pre.src-abc:before  { content: 'ABC'; }
  pre.src-coq:before  { content: 'Coq'; }
  pre.src-groovy:before  { content: 'Groovy'; }
  /* additional language identifiers from org-babel-shell-names in
     ob-shell.el: ob-shell is the only babel language using a lambda to put
     the execution function name together. */
  pre.src-bash:before  { content: 'bash'; }
  pre.src-csh:before  { content: 'csh'; }
  pre.src-ash:before  { content: 'ash'; }
  pre.src-dash:before  { content: 'dash'; }
  pre.src-ksh:before  { content: 'ksh'; }
  pre.src-mksh:before  { content: 'mksh'; }
  pre.src-posh:before  { content: 'posh'; }
  /* Additional Emacs modes also supported by the LaTeX listings package */
  pre.src-ada:before { content: 'Ada'; }
  pre.src-asm:before { content: 'Assembler'; }
  pre.src-caml:before { content: 'Caml'; }
  pre.src-delphi:before { content: 'Delphi'; }
  pre.src-html:before { content: 'HTML'; }
  pre.src-idl:before { content: 'IDL'; }
  pre.src-mercury:before { content: 'Mercury'; }
  pre.src-metapost:before { content: 'MetaPost'; }
  pre.src-modula-2:before { content: 'Modula-2'; }
  pre.src-pascal:before { content: 'Pascal'; }
  pre.src-ps:before { content: 'PostScript'; }
  pre.src-prolog:before { content: 'Prolog'; }
  pre.src-simula:before { content: 'Simula'; }
  pre.src-tcl:before { content: 'tcl'; }
  pre.src-tex:before { content: 'TeX'; }
  pre.src-plain-tex:before { content: 'Plain TeX'; }
  pre.src-verilog:before { content: 'Verilog'; }
  pre.src-vhdl:before { content: 'VHDL'; }
  pre.src-xml:before { content: 'XML'; }
  pre.src-nxml:before { content: 'XML'; }
  /* add a generic configuration mode; LaTeX export needs an additional
     (add-to-list 'org-latex-listings-langs '(conf " ")) in .emacs */
  pre.src-conf:before { content: 'Configuration File'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .equation-container {
    display: table;
    text-align: center;
    width: 100%;
  }
  .equation {
    vertical-align: middle;
  }
  .equation-label {
    display: table-cell;
    text-align: right;
    vertical-align: middle;
  }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  .org-svg { width: 90%; }
  /*]]>*/-->
</style>
<link rel="stylesheet" type="text/css" href="/documents/css/htmlize.css"/>
<link rel="stylesheet" type="text/css" href="/documents/css/readtheorg.css"/>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>
<script type="text/javascript" src="https://fniessen.github.io/org-html-themes/src/lib/js/jquery.stickytableheaders.min.js"></script>
<script type="text/javascript" src="https://fniessen.github.io/org-html-themes/src/readtheorg_theme/js/readtheorg.js"></script>
<style>pre.src{background:#343131;color:lightgray;} </style>
<script type="text/javascript">
// @license magnet:?xt=urn:btih:e95b018ef3580986a04669f1b5879592219e2a7a&dn=public-domain.txt Public Domain
<!--/*--><![CDATA[/*><!--*/
     function CodeHighlightOn(elem, id)
     {
       var target = document.getElementById(id);
       if(null != target) {
         elem.classList.add("code-highlighted");
         target.classList.add("code-highlighted");
       }
     }
     function CodeHighlightOff(elem, id)
     {
       var target = document.getElementById(id);
       if(null != target) {
         elem.classList.remove("code-highlighted");
         target.classList.remove("code-highlighted");
       }
     }
    /*]]>*///-->
// @license-end
</script>
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        displayAlign: "center",
        displayIndent: "0em",

        "HTML-CSS": { scale: 100,
                        linebreaks: { automatic: "false" },
                        webFont: "TeX"
                       },
        SVG: {scale: 100,
              linebreaks: { automatic: "false" },
              font: "TeX"},
        NativeMML: {scale: 100},
        TeX: { equationNumbers: {autoNumber: "AMS"},
               MultLineWidth: "85%",
               TagSide: "right",
               TagIndent: ".8em"
             }
});
</script>
<script type="text/javascript"
        src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS_HTML"></script>
</head>
<body>
<div id="content">
<h1 class="title">Notes from the initial C# DeepDive at HZD</h1>
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#orgc6c2510">1. References</a></li>
<li><a href="#org423f756">2. Basics</a>
<ul>
<li><a href="#org61f4d18">2.1. Top-level statements are translated by compiler into a static Main method, from this:</a></li>
<li><a href="#org7261eeb">2.2. Value vs Reference types</a></li>
<li><a href="#org4ff6343">2.3. Overflow check operators</a></li>
<li><a href="#orgdbcb80f">2.4. Verbatim string literals</a></li>
<li><a href="#org1817d61">2.5. String interpolation</a></li>
<li><a href="#org84bff9d">2.6. Array indices</a></li>
<li><a href="#orgae13d28">2.7. Array initialization</a></li>
<li><a href="#org2be326d">2.8. Obtain default values</a></li>
<li><a href="#org8261e6d">2.9. Parameters</a>
<ul>
<li><a href="#orgc8ef63e">2.9.1. (Default) Passing arguments by value</a></li>
<li><a href="#org805eb73">2.9.2. The <code>ref</code> modifier</a></li>
<li><a href="#orge9b16e0">2.9.3. The <code>out</code> modifier</a></li>
<li><a href="#org42ea0f3">2.9.4. <code>out</code> variables and discards</a></li>
<li><a href="#org0407cce">2.9.5. The <code>params</code> modifier</a></li>
<li><a href="#org343c39d">2.9.6. Optional parameters</a></li>
<li><a href="#org7cfa8ed">2.9.7. Named arguments</a></li>
</ul>
</li>
<li><a href="#org143f08c">2.10. <code>ref</code> locals</a></li>
<li><a href="#orge7b84db">2.11. Null Operators</a>
<ul>
<li><a href="#org03463b3">2.11.1. Null-Coalescing Operator</a></li>
<li><a href="#org81c4693">2.11.2. Null-Coalescing Assignment Operator</a></li>
<li><a href="#orgf1a1bac">2.11.3. Null-Conditional Operator ("Elvis")</a></li>
</ul>
</li>
<li><a href="#org4b1e1bc">2.12. Statements</a>
<ul>
<li><a href="#orgda571b0">2.12.1. Switching on <i>types</i></a></li>
<li><a href="#org7cefb67">2.12.2. Switch expressions</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#orgf32de9e">3. Creating Types in C#</a>
<ul>
<li><a href="#orgbc2fa5b">3.1. Classes</a>
<ul>
<li><a href="#orga481c57">3.1.1. Doconstructors</a></li>
<li><a href="#org3903019">3.1.2. Object initializers</a></li>
<li><a href="#org3fcfe8a">3.1.3. Properties</a></li>
<li><a href="#org9e20263">3.1.4. Init-only setters</a></li>
<li><a href="#org1666d4b">3.1.5. Indexers</a></li>
<li><a href="#org493670c">3.1.6. Pattern variable</a></li>
<li><a href="#orgffbedf3">3.1.7. Covariant return types</a></li>
<li><a href="#org4d4dd4d">3.1.8. <code>new</code> versus <code>override</code></a></li>
<li><a href="#org76250a2">3.1.9. Initialization sequence</a></li>
</ul>
</li>
<li><a href="#org44ff89b">3.2. Structs</a></li>
<li><a href="#org7294d26">3.3. Interfaces</a>
<ul>
<li><a href="#orgd62505e">3.3.1. Implementing Interface members virtually</a></li>
</ul>
</li>
<li><a href="#orgf204463">3.4. Enums</a></li>
<li><a href="#orgdfc900a">3.5. Generics</a></li>
<li><a href="#orga7e1b68">3.6. Generic methods</a></li>
</ul>
</li>
<li><a href="#org0eed850">4. Advanced C#</a>
<ul>
<li><a href="#orgeca457b">4.1. Delegates</a></li>
<li><a href="#org45fd1f8">4.2. Higher-order functions</a></li>
<li><a href="#org4b07755">4.3. Multicast delegates</a></li>
<li><a href="#orgccb8436">4.4. The <code>Func</code> and <code>Action</code> delegates</a></li>
<li><a href="#org4a8ddf1">4.5. Generic delegate type parameter variance</a></li>
<li><a href="#orga9880ae">4.6. Events</a></li>
<li><a href="#org4035ac2">4.7. Lambda expressions</a></li>
<li><a href="#org9c1a045">4.8. Capture outer variables</a></li>
<li><a href="#org68ba046">4.9. <code>try</code> statements and exceptions</a></li>
<li><a href="#org9722cd2">4.10. Exception filters</a></li>
<li><a href="#org83bf4a7">4.11. <code>finally</code> block</a></li>
<li><a href="#org8baf9d4">4.12. <code>using</code> block</a></li>
<li><a href="#org67e4577">4.13. <code>using</code> declaration</a></li>
<li><a href="#orge0c49e0">4.14. Enumeration and iterators</a></li>
<li><a href="#org0ac35a9">4.15. Collection initializers</a></li>
<li><a href="#org78278a2">4.16. Iterators</a></li>
<li><a href="#orgfcc053b">4.17. Nullable Value Types</a></li>
<li><a href="#org7939bcd">4.18. bool? with &amp; and | Operators</a></li>
<li><a href="#org68ba718">4.19. Nullable reference types</a></li>
<li><a href="#org5469dd0">4.20. Extension methods</a></li>
<li><a href="#org5006da7">4.21. Anonymous Types</a></li>
<li><a href="#org75c63b3">4.22. Tuples</a></li>
<li><a href="#orgd18e2e2">4.23. Records</a></li>
<li><a href="#orgb7d6fe5">4.24. Records non-distructive mutation</a></li>
<li><a href="#orgb63e485">4.25. Patterns</a></li>
</ul>
</li>
<li><a href="#orgbdc7ff2">5. .NET Overview</a>
<ul>
<li><a href="#org7830c9a">5.1. String and Text handling</a></li>
</ul>
</li>
<li><a href="#org3aa7185">6. Collections</a>
<ul>
<li><a href="#orgb94dd57">6.1. <code>IEnumerator&lt;T&gt;</code> / <code>IEnumerable&lt;T&gt;</code></a></li>
<li><a href="#org5093080">6.2. <code>ICollection</code> and <code>IList</code> interfaces</a></li>
<li><a href="#orgaef3931">6.3. <code>IReadOnlyCollection&lt;T&gt;</code> / <code>IReadOnlyList&lt;T&gt;</code></a></li>
<li><a href="#org9bf03a6">6.4. Array Class</a></li>
<li><a href="#org4bbb7aa">6.5. Lists, Queues, Stacks, and Sets</a></li>
<li><a href="#orgfa8d313">6.6. Dictionaries</a></li>
<li><a href="#orgdde7162">6.7. Custom collections</a></li>
<li><a href="#orgd708bd4">6.8. Immutable Collections</a></li>
</ul>
</li>
<li><a href="#orgde45c83">7. LINQ Queries</a>
<ul>
<li><a href="#org8f19f52">7.1. Intro</a></li>
<li><a href="#org0bd2ded">7.2. Fluent syntax</a></li>
<li><a href="#orgc650cfa">7.3. Query expressions</a></li>
<li><a href="#orgfd9f515">7.4. How Deferred Execution Works</a></li>
<li><a href="#org19b7aae">7.5. Subqueries</a></li>
<li><a href="#org248ec21">7.6. The <code>into</code> keyword</a></li>
<li><a href="#orgf7d7445">7.7. Wrapping queries</a></li>
<li><a href="#orgd760554">7.8. Mapping to objects</a></li>
<li><a href="#orga4c1a05">7.9. Mapping with anonymous types</a></li>
<li><a href="#orgfc171b2">7.10. The <code>let</code> keyword</a></li>
<li><a href="#orgdd5cdd3">7.11. [SKIPPED for now] Interpreted(DB) Queries with EF framework</a></li>
</ul>
</li>
<li><a href="#orgf2d5fc7">8. LINQ Operators</a>
<ul>
<li><a href="#org21a4eed">8.1. Overview</a></li>
<li><a href="#org5590f1a">8.2. Examples</a></li>
<li><a href="#orgef755fa">8.3. Join with a simple key</a></li>
<li><a href="#orgb722f23">8.4. Multiple join with composite key</a></li>
<li><a href="#org1639464">8.5. <code>join</code> clause</a>
<ul>
<li><a href="#orgab62b94">8.5.1. Inner join</a></li>
<li><a href="#org0840788">8.5.2. Group join</a></li>
<li><a href="#orgf3d3f3d">8.5.3. Left outer join</a></li>
<li><a href="#org8f00386">8.5.4. <i>source data for examples above</i></a></li>
</ul>
</li>
<li><a href="#orga9c271d">8.6. <code>group by</code> clause</a></li>
<li><a href="#orgaf78e50">8.7. Generation Methods</a></li>
</ul>
</li>
<li><a href="#orgcb0acc6">9. Working with JSON</a></li>
<li><a href="#org58dc54c">10. Stream and I/O</a>
<ul>
<li><a href="#org26d4eb5">10.1. Stream architecture</a></li>
<li><a href="#org2807b7f">10.2. <code>FileStream</code></a>
<ul>
<li><a href="#org587b878">10.2.1. Create with facade static methods</a></li>
<li><a href="#orgaedec60">10.2.2. Specify file name</a></li>
<li><a href="#org81de674">10.2.3. Read file content</a></li>
<li><a href="#org1ad58a0">10.2.4. Write into file</a></li>
</ul>
</li>
<li><a href="#orgb67a37f">10.3. <code>StreamReader</code> and <code>StreamWriter</code></a></li>
<li><a href="#org8c06633">10.4. File and Directory Operations</a>
<ul>
<li><a href="#org75a6975">10.4.1. <code>File</code></a></li>
<li><a href="#orgfd07dee">10.4.2. <code>Directory</code></a></li>
<li><a href="#orgba2aa48">10.4.3. <code>Path</code></a></li>
</ul>
</li>
<li><a href="#org98ed3ae">10.5. Catching Filesystem Events</a></li>
</ul>
</li>
<li><a href="#orgdc0598d">11. LogProcessor project</a>
<ul>
<li><a href="#orgb36a6e6">11.1. Create initial stab</a></li>
<li><a href="#orgd16080e">11.2. Working with the GitHub repo</a>
<ul>
<li><a href="#org9965ace">11.2.1. Create a repo with VisualStudio .gitignore</a></li>
<li><a href="#org1f07905">11.2.2. Clone repo</a></li>
<li><a href="#org07f0662">11.2.3. Check <code>.net</code> info:</a></li>
<li><a href="#orgb78cd8f">11.2.4. Create a new solution with main and test projects</a></li>
<li><a href="#org0c6b5f8">11.2.5. Run test and main projects</a></li>
<li><a href="#org19c81e0">11.2.6. Add command line parser to the main project</a></li>
<li><a href="#org9420e55">11.2.7. Update test project</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>

<div id="outline-container-orgc6c2510" class="outline-2">
<h2 id="orgc6c2510"><span class="section-number-2">1</span> References</h2>
</div>


<div id="outline-container-org423f756" class="outline-2">
<h2 id="org423f756"><span class="section-number-2">2</span> Basics</h2>
<div class="outline-text-2" id="text-2">
</div>
<div id="outline-container-org61f4d18" class="outline-3">
<h3 id="org61f4d18"><span class="section-number-3">2.1</span> Top-level statements are translated by compiler into a static Main method, from this:</h3>
<div class="outline-text-3" id="text-2-1">
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #C678DD;">using</span> <span style="color: #E06C75;">System</span>; <span style="color: #5C6370; font-style: italic;">// </span><span style="color: #5C6370; font-style: italic;">Part 1</span>
Console.WriteLine (<span style="color: #98C379;">"Hello, world"</span>); <span style="color: #5C6370; font-style: italic;">// </span><span style="color: #5C6370; font-style: italic;">Part 2</span>
<span style="color: #E5C07B;">void</span> <span style="color: #61AFEF;">SomeMethod1</span>() { ... } <span style="color: #5C6370; font-style: italic;">// </span><span style="color: #5C6370; font-style: italic;">Part 2</span>
Console.WriteLine (<span style="color: #98C379;">"Hello again!"</span>); <span style="color: #5C6370; font-style: italic;">// </span><span style="color: #5C6370; font-style: italic;">Part 2</span>
<span style="color: #E5C07B;">void</span> <span style="color: #61AFEF;">SomeMethod2</span>() { ... } <span style="color: #5C6370; font-style: italic;">// </span><span style="color: #5C6370; font-style: italic;">Part 2</span>
<span style="color: #C678DD;">class</span> <span style="color: #E5C07B;">SomeClass</span> { ... } <span style="color: #5C6370; font-style: italic;">// </span><span style="color: #5C6370; font-style: italic;">Part 3</span>
<span style="color: #C678DD;">namespace</span> <span style="color: #E06C75;">SomeNamespace</span> { ... } <span style="color: #5C6370; font-style: italic;">// </span><span style="color: #5C6370; font-style: italic;">Part 3</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #C678DD;">using</span> <span style="color: #E06C75;">System</span>; <span style="color: #5C6370; font-style: italic;">// </span><span style="color: #5C6370; font-style: italic;">Part 1</span>
<span style="color: #C678DD;">static</span> <span style="color: #C678DD;">class</span> <span style="color: #E5C07B;">Program$</span> <span style="color: #5C6370; font-style: italic;">// </span><span style="color: #5C6370; font-style: italic;">Special compiler-generated name</span>
{
    <span style="color: #C678DD;">static</span> <span style="color: #E5C07B;">void</span> <span style="color: #61AFEF;">Main$</span> (<span style="color: #E5C07B;">string</span>[] <span style="color: #E06C75;">args</span>) <span style="color: #5C6370; font-style: italic;">// </span><span style="color: #5C6370; font-style: italic;">Compiler-generated name</span>
    {
        Console.WriteLine (<span style="color: #98C379;">"Hello, world"</span>); <span style="color: #5C6370; font-style: italic;">// </span><span style="color: #5C6370; font-style: italic;">Part 2</span>
        <span style="color: #E5C07B;">void</span> <span style="color: #61AFEF;">SomeMethod1</span>() { ... } <span style="color: #5C6370; font-style: italic;">// </span><span style="color: #5C6370; font-style: italic;">Part 2</span>
        Console.WriteLine (<span style="color: #98C379;">"Hello again!"</span>); <span style="color: #5C6370; font-style: italic;">// </span><span style="color: #5C6370; font-style: italic;">Part 2</span>
        <span style="color: #E5C07B;">void</span> <span style="color: #61AFEF;">SomeMethod2</span>() { ... } <span style="color: #5C6370; font-style: italic;">// </span><span style="color: #5C6370; font-style: italic;">Part 2</span>
    }
}
<span style="color: #C678DD;">class</span> <span style="color: #E5C07B;">SomeClass</span> { ... } <span style="color: #5C6370; font-style: italic;">// </span><span style="color: #5C6370; font-style: italic;">Part 3</span>
<span style="color: #C678DD;">namespace</span> <span style="color: #E06C75;">SomeNamespace</span> { ... } <span style="color: #5C6370; font-style: italic;">// </span><span style="color: #5C6370; font-style: italic;">Part 3</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org7261eeb" class="outline-3">
<h3 id="org7261eeb"><span class="section-number-3">2.2</span> Value vs Reference types</h3>
<div class="outline-text-3" id="text-2-2">
<p>
Value types:
</p>
<ul class="org-ul">
<li>buit-ins</li>
<li>struct</li>
<li>enum</li>
</ul>


<p>
Ref types:
</p>
<ul class="org-ul">
<li>String</li>
<li>class</li>
<li>array</li>
<li>&#x2026;</li>
</ul>
</div>
</div>

<div id="outline-container-org4ff6343" class="outline-3">
<h3 id="org4ff6343"><span class="section-number-3">2.3</span> Overflow check operators</h3>
<div class="outline-text-3" id="text-2-3">
<p>
Check for overflow can be done for an expression or a statement block:
</p>
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #E5C07B;">int</span> <span style="color: #E06C75;">a</span> = 1000000;
<span style="color: #E5C07B;">int</span> <span style="color: #E06C75;">b</span> = 1000000;
<span style="color: #E5C07B;">int</span> <span style="color: #E06C75;">c</span> = <span style="color: #C678DD;">checked</span> (a * b); <span style="color: #5C6370; font-style: italic;">// </span><span style="color: #5C6370; font-style: italic;">Checks just the expression.</span>
<span style="color: #C678DD;">checked</span> <span style="color: #5C6370; font-style: italic;">// </span><span style="color: #5C6370; font-style: italic;">Checks all expressions</span>
{ <span style="color: #5C6370; font-style: italic;">// </span><span style="color: #5C6370; font-style: italic;">in statement block.</span>
    <span style="color: #5C6370; font-style: italic;">// </span><span style="color: #5C6370; font-style: italic;">...</span>
    c = a * b;
    <span style="color: #5C6370; font-style: italic;">// </span><span style="color: #5C6370; font-style: italic;">...</span>
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgdbcb80f" class="outline-3">
<h3 id="orgdbcb80f"><span class="section-number-3">2.4</span> Verbatim string literals</h3>
<div class="outline-text-3" id="text-2-4">
<blockquote>
<p>
A verbatim string literal is prefixed with @ and does not support escape sequences.
</p>
</blockquote>

<p>
This example does not neet repeated backslashes:
</p>
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #E5C07B;">string</span> <span style="color: #E06C75;">a2</span> = @<span style="color: #98C379;">"\\server\fileshare\helloworld.cs"</span>;
</pre>
</div>

<p>
A verbatim string literal can span multiple lines:
</p>
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #E5C07B;">string</span> <span style="color: #E06C75;">escaped</span> = <span style="color: #98C379;">"First Line\r\nSecond Line"</span>;
<span style="color: #E5C07B;">string</span> <span style="color: #E06C75;">verbatim</span> = @<span style="color: #98C379;">"First Line</span>
<span style="color: #98C379;">Second Line"</span>;
<span style="color: #5C6370; font-style: italic;">// </span><span style="color: #5C6370; font-style: italic;">True if your text editor uses CR-LF line separators:</span>
Console.WriteLine (escaped == verbatim);
</pre>
</div>
</div>
</div>

<div id="outline-container-org1817d61" class="outline-3">
<h3 id="org1817d61"><span class="section-number-3">2.5</span> String interpolation</h3>
<div class="outline-text-3" id="text-2-5">
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #E5C07B;">int</span> <span style="color: #E06C75;">x</span> = 4;
Console.Write ($<span style="color: #98C379;">"A square has {x} sides"</span>); <span style="color: #5C6370; font-style: italic;">// </span><span style="color: #5C6370; font-style: italic;">Prints: A square has 4 sides</span>
</pre>
</div>

<blockquote>
<p>
Any valid C# expression of any type can appear within the braces, and C# will
convert the expression to a string by calling its ToString method or equivalent.
</p>
</blockquote>

<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #E5C07B;">bool</span> <span style="color: #E06C75;">b</span> = <span style="color: #56B6C2;">true</span>;
Console.WriteLine ($<span style="color: #98C379;">"The answer in binary is {(b ? 1 : 0)}"</span>);
</pre>
</div>
</div>
</div>

<div id="outline-container-org84bff9d" class="outline-3">
<h3 id="org84bff9d"><span class="section-number-3">2.6</span> Array indices</h3>
<div class="outline-text-3" id="text-2-6">
<p>
<code>^</code> - indicates the <i>end</i> of an array. <code>^0</code> equals the length of an array.
</p>
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #E5C07B;">char</span>[] <span style="color: #E06C75;">vowels</span> = <span style="color: #C678DD;">new</span> <span style="color: #E5C07B;">char</span>[] {<span style="color: #98C379;">'a'</span>,<span style="color: #98C379;">'e'</span>,<span style="color: #98C379;">'i'</span>,<span style="color: #98C379;">'o'</span>,<span style="color: #98C379;">'u'</span>};
<span style="color: #E5C07B;">char</span> <span style="color: #E06C75;">lastElement</span> = vowels [^1]; <span style="color: #5C6370; font-style: italic;">// </span><span style="color: #5C6370; font-style: italic;">'u'</span>
<span style="color: #E5C07B;">char</span> <span style="color: #E06C75;">secondToLast</span> = vowels [^2]; <span style="color: #5C6370; font-style: italic;">// </span><span style="color: #5C6370; font-style: italic;">'o'</span>
</pre>
</div>

<p>
<code>Index</code> type usage:
</p>
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #E5C07B;">Index</span> <span style="color: #E06C75;">first</span> = 0;
<span style="color: #E5C07B;">Index</span> <span style="color: #E06C75;">last</span> = ^1;
<span style="color: #E5C07B;">char</span> <span style="color: #E06C75;">firstElement</span> = vowels [first]; <span style="color: #5C6370; font-style: italic;">// </span><span style="color: #5C6370; font-style: italic;">'a'</span>
<span style="color: #E5C07B;">char</span> <span style="color: #E06C75;">lastElement</span> = vowels [last]; <span style="color: #5C6370; font-style: italic;">// </span><span style="color: #5C6370; font-style: italic;">'u'</span>
</pre>
</div>

<p>
Ranges let you <i>slice</i> an array:
</p>
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #E5C07B;">char</span>[] <span style="color: #E06C75;">firstTwo</span> = vowels [..2]; <span style="color: #5C6370; font-style: italic;">// </span><span style="color: #5C6370; font-style: italic;">'a', 'e'</span>
<span style="color: #E5C07B;">char</span>[] <span style="color: #E06C75;">lastThree</span> = vowels [2..]; <span style="color: #5C6370; font-style: italic;">// </span><span style="color: #5C6370; font-style: italic;">'i', 'o', 'u'</span>
<span style="color: #E5C07B;">char</span>[] <span style="color: #E06C75;">middleOne</span> = vowels [2..3]; <span style="color: #5C6370; font-style: italic;">// </span><span style="color: #5C6370; font-style: italic;">'i'</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgae13d28" class="outline-3">
<h3 id="orgae13d28"><span class="section-number-3">2.7</span> Array initialization</h3>
<div class="outline-text-3" id="text-2-7">
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #E5C07B;">char</span>[] <span style="color: #E06C75;">vowels</span> = {<span style="color: #98C379;">'a'</span>,<span style="color: #98C379;">'e'</span>,<span style="color: #98C379;">'i'</span>,<span style="color: #98C379;">'o'</span>,<span style="color: #98C379;">'u'</span>};

<span style="color: #E5C07B;">int</span>[,] rectangularMatrix =
{
    {0,1,2},
    {3,4,5},
    {6,7,8}
};

<span style="color: #E5C07B;">int</span>[][] <span style="color: #E06C75;">jaggedMatrix</span> =
{
    <span style="color: #C678DD;">new</span> <span style="color: #E5C07B;">int</span>[] {0,1,2},
    <span style="color: #C678DD;">new</span> <span style="color: #E5C07B;">int</span>[] {3,4,5},
    <span style="color: #C678DD;">new</span> <span style="color: #E5C07B;">int</span>[] {6,7,8,9}
};
</pre>
</div>
</div>
</div>

<div id="outline-container-org2be326d" class="outline-3">
<h3 id="org2be326d"><span class="section-number-3">2.8</span> Obtain default values</h3>
<div class="outline-text-3" id="text-2-8">
<div class="org-src-container">
<pre class="src src-csharp">Console.WriteLine (<span style="color: #C678DD;">default</span> (<span style="color: #E5C07B;">decimal</span>)); <span style="color: #5C6370; font-style: italic;">// </span><span style="color: #5C6370; font-style: italic;">0</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org8261e6d" class="outline-3">
<h3 id="org8261e6d"><span class="section-number-3">2.9</span> Parameters</h3>
<div class="outline-text-3" id="text-2-9">
<blockquote>
<p>
A method may have a sequence of parameters. Parameters define the set of arguments that must be provided for that method.
</p>
</blockquote>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">modifier</th>
<th scope="col" class="org-left">passed by</th>
<th scope="col" class="org-left">var must be assigned</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">(None)</td>
<td class="org-left">Value</td>
<td class="org-left">Going in</td>
</tr>

<tr>
<td class="org-left"><code>ref</code></td>
<td class="org-left">Reference</td>
<td class="org-left">Going in</td>
</tr>

<tr>
<td class="org-left"><code>in</code></td>
<td class="org-left">Reference (read-only)</td>
<td class="org-left">Going in</td>
</tr>

<tr>
<td class="org-left"><code>out</code></td>
<td class="org-left">Reference</td>
<td class="org-left">Going out</td>
</tr>
</tbody>
</table>
</div>


<div id="outline-container-orgc8ef63e" class="outline-4">
<h4 id="orgc8ef63e"><span class="section-number-4">2.9.1</span> (Default) Passing arguments by value</h4>
<div class="outline-text-4" id="text-2-9-1">
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #E5C07B;">int</span> <span style="color: #E06C75;">x</span> = 8;
Foo (x); <span style="color: #5C6370; font-style: italic;">// </span><span style="color: #5C6370; font-style: italic;">Make a copy of x</span>
Console.WriteLine (x); <span style="color: #5C6370; font-style: italic;">// </span><span style="color: #5C6370; font-style: italic;">x will still be 8</span>
<span style="color: #C678DD;">static</span> <span style="color: #E5C07B;">void</span> <span style="color: #61AFEF;">Foo</span> (<span style="color: #E5C07B;">int</span> <span style="color: #E06C75;">p</span>)
{
    p = p + 1; <span style="color: #5C6370; font-style: italic;">// </span><span style="color: #5C6370; font-style: italic;">Increment p by 1</span>
    Console.WriteLine (p); <span style="color: #5C6370; font-style: italic;">// </span><span style="color: #5C6370; font-style: italic;">Write p to screen</span>
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org805eb73" class="outline-4">
<h4 id="org805eb73"><span class="section-number-4">2.9.2</span> The <code>ref</code> modifier</h4>
<div class="outline-text-4" id="text-2-9-2">
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #E5C07B;">int</span> <span style="color: #E06C75;">x</span> = 8;
Foo (<span style="color: #C678DD;">ref</span> <span style="color: #E5C07B;">x</span>); <span style="color: #5C6370; font-style: italic;">// </span><span style="color: #5C6370; font-style: italic;">Ask Foo to deal directly with x</span>
Console.WriteLine (x); <span style="color: #5C6370; font-style: italic;">// </span><span style="color: #5C6370; font-style: italic;">x is now 9</span>
<span style="color: #C678DD;">static</span> <span style="color: #E5C07B;">void</span> <span style="color: #61AFEF;">Foo</span> (<span style="color: #C678DD;">ref</span> <span style="color: #E5C07B;">int</span> <span style="color: #E06C75;">p</span>)
{
    p = p + 1; <span style="color: #5C6370; font-style: italic;">// </span><span style="color: #5C6370; font-style: italic;">Increment p by 1</span>
    Console.WriteLine (p); <span style="color: #5C6370; font-style: italic;">// </span><span style="color: #5C6370; font-style: italic;">Write p to screen</span>
}
</pre>
</div>

<p>
Example of a swap method
</p>

<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #E5C07B;">string</span> <span style="color: #E06C75;">x</span> = <span style="color: #98C379;">"Penn"</span>;
<span style="color: #E5C07B;">string</span> <span style="color: #E06C75;">y</span> = <span style="color: #98C379;">"Teller"</span>;
Swap (<span style="color: #C678DD;">ref</span> <span style="color: #E5C07B;">x</span>, <span style="color: #C678DD;">ref</span> <span style="color: #E5C07B;">y</span>);
Console.WriteLine (x); <span style="color: #5C6370; font-style: italic;">// </span><span style="color: #5C6370; font-style: italic;">Teller</span>
Console.WriteLine (y); <span style="color: #5C6370; font-style: italic;">// </span><span style="color: #5C6370; font-style: italic;">Penn</span>
<span style="color: #C678DD;">static</span> <span style="color: #E5C07B;">void</span> <span style="color: #61AFEF;">Swap</span> (<span style="color: #C678DD;">ref</span> <span style="color: #E5C07B;">string</span> <span style="color: #E06C75;">a</span>, <span style="color: #C678DD;">ref</span> <span style="color: #E5C07B;">string</span> <span style="color: #E06C75;">b</span>)
{
    <span style="color: #E5C07B;">string</span> <span style="color: #E06C75;">temp</span> = a;
    a = b;
    b = temp;
}
</pre>
</div>

<blockquote>
<p>
A parameter can be passed by reference or by value, regardless
of whether the parameter type is a reference type or a value
type.
</p>
</blockquote>
</div>
</div>

<div id="outline-container-orge9b16e0" class="outline-4">
<h4 id="orge9b16e0"><span class="section-number-4">2.9.3</span> The <code>out</code> modifier</h4>
<div class="outline-text-4" id="text-2-9-3">
<ul class="org-ul">
<li>It need not be assigned before going into the function.</li>
<li><p>
It must be assigned before it comes <i>out</i> of the function.
</p>

<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #E5C07B;">string</span> <span style="color: #E06C75;">a</span>, <span style="color: #E06C75;">b</span>;
Split (<span style="color: #98C379;">"Stevie Ray Vaughn"</span>, <span style="color: #C678DD;">out</span> <span style="color: #E5C07B;">a</span>, <span style="color: #C678DD;">out</span> <span style="color: #E5C07B;">b</span>);
Console.WriteLine (a); <span style="color: #5C6370; font-style: italic;">// </span><span style="color: #5C6370; font-style: italic;">Stevie Ray</span>
Console.WriteLine (b); <span style="color: #5C6370; font-style: italic;">// </span><span style="color: #5C6370; font-style: italic;">Vaughn</span>
<span style="color: #E5C07B;">void</span> <span style="color: #61AFEF;">Split</span> (<span style="color: #E5C07B;">string</span> <span style="color: #E06C75;">name</span>, <span style="color: #C678DD;">out</span> <span style="color: #E5C07B;">string</span> <span style="color: #E06C75;">firstNames</span>, <span style="color: #C678DD;">out</span> <span style="color: #E5C07B;">string</span> <span style="color: #E06C75;">lastName</span>)
{
    <span style="color: #E5C07B;">int</span> <span style="color: #E06C75;">i</span> = name.LastIndexOf (<span style="color: #98C379;">' '</span>);
    firstNames = name.Substring (0, i);
    lastName = name.Substring (i + 1);
}
</pre>
</div></li>
</ul>
</div>
</div>

<div id="outline-container-org42ea0f3" class="outline-4">
<h4 id="org42ea0f3"><span class="section-number-4">2.9.4</span> <code>out</code> variables and discards</h4>
<div class="outline-text-4" id="text-2-9-4">
<blockquote>
<p>
When calling methods with multiple out parameters, sometimes you're not interested
in receiving values from all the parameters. In such cases, you can "discard" the
ones in which you're uninterested by using an underscore:
</p>
</blockquote>

<div class="org-src-container">
<pre class="src src-csharp">Split (<span style="color: #98C379;">"Stevie Ray Vaughan"</span>, <span style="color: #C678DD;">out</span> <span style="color: #E5C07B;">string</span> <span style="color: #E06C75;">a</span>, <span style="color: #C678DD;">out</span> <span style="color: #E5C07B;">_</span>); <span style="color: #5C6370; font-style: italic;">// </span><span style="color: #5C6370; font-style: italic;">Discard 2nd param</span>
Console.WriteLine (a);
</pre>
</div>
</div>
</div>

<div id="outline-container-org0407cce" class="outline-4">
<h4 id="org0407cce"><span class="section-number-4">2.9.5</span> The <code>params</code> modifier</h4>
<div class="outline-text-4" id="text-2-9-5">
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #E5C07B;">int</span> <span style="color: #E06C75;">total</span> = Sum (1, 2, 3, 4);
Console.WriteLine (total); <span style="color: #5C6370; font-style: italic;">// </span><span style="color: #5C6370; font-style: italic;">10</span>
<span style="color: #5C6370; font-style: italic;">// </span><span style="color: #5C6370; font-style: italic;">The call to Sum above is equivalent to:</span>
<span style="color: #E5C07B;">int</span> <span style="color: #E06C75;">total2</span> = Sum (<span style="color: #C678DD;">new</span> <span style="color: #E5C07B;">int</span>[] { 1, 2, 3, 4 });
<span style="color: #E5C07B;">int</span> <span style="color: #61AFEF;">Sum</span> (<span style="color: #C678DD;">params</span> <span style="color: #E5C07B;">int</span>[] <span style="color: #E06C75;">ints</span>)
{
    <span style="color: #E5C07B;">int</span> <span style="color: #E06C75;">sum</span> = 0;
    <span style="color: #C678DD;">for</span> (<span style="color: #E5C07B;">int</span> <span style="color: #E06C75;">i</span> = 0; i &lt; ints.Length; i++)
        sum += ints [i]; <span style="color: #5C6370; font-style: italic;">// </span><span style="color: #5C6370; font-style: italic;">Increase sum by ints[i]</span>
    <span style="color: #C678DD;">return</span> sum;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org343c39d" class="outline-4">
<h4 id="org343c39d"><span class="section-number-4">2.9.6</span> Optional parameters</h4>
<div class="outline-text-4" id="text-2-9-6">
<blockquote>
<p>
Methods, constructors, and indexers (Chapter 3) can declare optional parameters. A
parameter is optional if it specifies a default value in its declaration:
</p>
</blockquote>

<div class="org-src-container">
<pre class="src src-csharp">Foo (1); <span style="color: #5C6370; font-style: italic;">// </span><span style="color: #5C6370; font-style: italic;">1, 0</span>
<span style="color: #E5C07B;">void</span> <span style="color: #61AFEF;">Foo</span> (<span style="color: #E5C07B;">int</span> <span style="color: #E06C75;">x</span> = 0, <span style="color: #E5C07B;">int</span> <span style="color: #E06C75;">y</span> = 0) {
    Console.WriteLine (x + <span style="color: #98C379;">", "</span> + y);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org7cfa8ed" class="outline-4">
<h4 id="org7cfa8ed"><span class="section-number-4">2.9.7</span> Named arguments</h4>
<div class="outline-text-4" id="text-2-9-7">
<div class="org-src-container">
<pre class="src src-csharp">Foo (x:1, y:2); <span style="color: #5C6370; font-style: italic;">// </span><span style="color: #5C6370; font-style: italic;">1, 2</span>
Foo (x:1, y:2); <span style="color: #5C6370; font-style: italic;">// </span><span style="color: #5C6370; font-style: italic;">semantically identical call</span>
Foo (y:2, x:1); <span style="color: #5C6370; font-style: italic;">// </span><span style="color: #5C6370; font-style: italic;">semantically identical call</span>
<span style="color: #E5C07B;">void</span> <span style="color: #61AFEF;">Foo</span> (<span style="color: #E5C07B;">int</span> <span style="color: #E06C75;">x</span>, <span style="color: #E5C07B;">int</span> <span style="color: #E06C75;">y</span>) {
    Console.WriteLine (x + <span style="color: #98C379;">", "</span> + y);
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org143f08c" class="outline-3">
<h3 id="org143f08c"><span class="section-number-3">2.10</span> <code>ref</code> locals</h3>
<div class="outline-text-3" id="text-2-10">
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #E5C07B;">int</span>[] <span style="color: #E06C75;">numbers</span> = { 0, 1, 2, 3, 4 };
<span style="color: #C678DD;">ref</span> <span style="color: #E5C07B;">int</span> <span style="color: #E06C75;">numRef</span> = <span style="color: #C678DD;">ref</span> numbers [2];

numRef *= 10;
Console.WriteLine (numRef); <span style="color: #5C6370; font-style: italic;">// </span><span style="color: #5C6370; font-style: italic;">20</span>
Console.WriteLine (numbers [2]); <span style="color: #5C6370; font-style: italic;">// </span><span style="color: #5C6370; font-style: italic;">20</span>
</pre>
</div>

<blockquote>
<p>
The Span&lt;T&gt; and ReadOnlySpan&lt;T&gt; types use <code>ref</code> returns to implement a highly efficient
indexer. Outside such scenarios, ref returns are not commonly used, and you can consider them a micro-optimization feature.
</p>
</blockquote>

<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #C678DD;">class</span> <span style="color: #E5C07B;">Program</span>
{
    <span style="color: #C678DD;">static</span> <span style="color: #E5C07B;">string</span> <span style="color: #E06C75;">x</span> = <span style="color: #98C379;">"Old Value"</span>;
    <span style="color: #C678DD;">static</span> <span style="color: #C678DD;">ref</span> <span style="color: #E5C07B;">string</span> <span style="color: #61AFEF;">GetX</span>() =&gt; <span style="color: #C678DD;">ref</span> x; <span style="color: #5C6370; font-style: italic;">// </span><span style="color: #5C6370; font-style: italic;">This method returns a ref</span>
    <span style="color: #C678DD;">static</span> <span style="color: #E5C07B;">void</span> <span style="color: #61AFEF;">Main</span>()
    {
        <span style="color: #C678DD;">ref</span> <span style="color: #E5C07B;">string</span> <span style="color: #E06C75;">xRef</span> = <span style="color: #C678DD;">ref</span> <span style="color: #61AFEF;">GetX</span>(); <span style="color: #5C6370; font-style: italic;">// </span><span style="color: #5C6370; font-style: italic;">Assign result to a ref local</span>
        xRef = <span style="color: #98C379;">"New Value"</span>;
        Console.WriteLine (<span style="color: #E5C07B;">x</span>); <span style="color: #5C6370; font-style: italic;">// </span><span style="color: #5C6370; font-style: italic;">New Value</span>
    }
}
</pre>
</div>

<p>
BUT!!!
</p>
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #E5C07B;">string</span> <span style="color: #E06C75;">localX</span> = <span style="color: #61AFEF;">GetX</span>(); <span style="color: #5C6370; font-style: italic;">// </span><span style="color: #5C6370; font-style: italic;">Legal: localX is an ordinary non-ref variable.</span>
</pre>
</div>

<p>
Define <i>writable</i> property or indexer:
</p>
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #C678DD;">static</span> <span style="color: #C678DD;">ref</span> <span style="color: #E5C07B;">string</span> <span style="color: #E06C75;">Prop</span> =&gt; <span style="color: #C678DD;">ref</span> x;

Prop = <span style="color: #98C379;">"New Value"</span>; <span style="color: #5C6370; font-style: italic;">// </span><span style="color: #5C6370; font-style: italic;">writable without setters</span>
</pre>
</div>

<p>
To prevent modifications use <code>readonly</code>:
</p>
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #C678DD;">static</span> <span style="color: #C678DD;">ref</span> <span style="color: #C678DD;">readonly</span> <span style="color: #E5C07B;">string</span> <span style="color: #E06C75;">Prop</span> =&gt; <span style="color: #C678DD;">ref</span> x;
</pre>
</div>
</div>
</div>

<div id="outline-container-orge7b84db" class="outline-3">
<h3 id="orge7b84db"><span class="section-number-3">2.11</span> Null Operators</h3>
<div class="outline-text-3" id="text-2-11">
</div>
<div id="outline-container-org03463b3" class="outline-4">
<h4 id="org03463b3"><span class="section-number-4">2.11.1</span> Null-Coalescing Operator</h4>
<div class="outline-text-4" id="text-2-11-1">
<blockquote>
<p>
"If the operand to the left is
non-null, give it to me; otherwise, give me another value."
</p>
</blockquote>

<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #E5C07B;">string</span> <span style="color: #E06C75;">s1</span> = <span style="color: #56B6C2;">null</span>;
<span style="color: #E5C07B;">string</span> <span style="color: #E06C75;">s2</span> = s1 ?? <span style="color: #98C379;">"nothing"</span>; <span style="color: #5C6370; font-style: italic;">// </span><span style="color: #5C6370; font-style: italic;">s2 evaluates to "nothing"</span>
</pre>
</div>

<blockquote>
<p>
If the lefthand expression is non-null, the righthand expression is never evaluated.
</p>
</blockquote>
</div>
</div>

<div id="outline-container-org81c4693" class="outline-4">
<h4 id="org81c4693"><span class="section-number-4">2.11.2</span> Null-Coalescing Assignment Operator</h4>
<div class="outline-text-4" id="text-2-11-2">
<blockquote>
<p>
If the operand to the left is null, assign the right operand to the left operand.
</p>
</blockquote>

<div class="org-src-container">
<pre class="src src-csharp">myVariable ??= someDefault;
</pre>
</div>

<p>
Above equals to:
</p>
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #C678DD;">if</span> (myVariable == <span style="color: #56B6C2;">null</span>) myVariable = someDefault;
</pre>
</div>
</div>
</div>

<div id="outline-container-orgf1a1bac" class="outline-4">
<h4 id="orgf1a1bac"><span class="section-number-4">2.11.3</span> Null-Conditional Operator ("Elvis")</h4>
<div class="outline-text-4" id="text-2-11-3">
<blockquote>
<p>
It allows you to call methods and access members just like the standard dot operator
except that if the operand on the left is null, the expression evaluates to null instead
of throwing a NullReferenceException
</p>
</blockquote>

<div class="org-src-container">
<pre class="src src-csharp">System.Text.<span style="color: #E5C07B;">StringBuilder</span> <span style="color: #E06C75;">sb</span> = <span style="color: #56B6C2;">null</span>;
<span style="color: #E5C07B;">string</span> <span style="color: #E06C75;">s</span> = sb?.<span style="color: #61AFEF;">ToString</span>(); <span style="color: #5C6370; font-style: italic;">// </span><span style="color: #5C6370; font-style: italic;">No error; s instead evaluates to null</span>
</pre>
</div>

<p>
Above is equivalent to:
</p>
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #E5C07B;">string</span> <span style="color: #E06C75;">s</span> = (sb == <span style="color: #56B6C2;">null</span> ? <span style="color: #56B6C2;">null</span> : sb.<span style="color: #61AFEF;">ToString</span>());
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org4b1e1bc" class="outline-3">
<h3 id="org4b1e1bc"><span class="section-number-3">2.12</span> Statements</h3>
<div class="outline-text-3" id="text-2-12">
</div>
<div id="outline-container-orgda571b0" class="outline-4">
<h4 id="orgda571b0"><span class="section-number-4">2.12.1</span> Switching on <i>types</i></h4>
<div class="outline-text-4" id="text-2-12-1">
<div class="org-src-container">
<pre class="src src-csharp">TellMeTheType (12);
TellMeTheType (<span style="color: #98C379;">"hello"</span>);
TellMeTheType (<span style="color: #56B6C2;">true</span>);
<span style="color: #E5C07B;">void</span> <span style="color: #61AFEF;">TellMeTheType</span> (<span style="color: #E5C07B;">object</span> <span style="color: #E06C75;">x</span>) <span style="color: #5C6370; font-style: italic;">// </span><span style="color: #5C6370; font-style: italic;">object allows any type.</span>
{
    <span style="color: #C678DD;">switch</span> (x)
    {
        <span style="color: #C678DD;">case</span> <span style="color: #E5C07B;">int</span> i:
            Console.WriteLine (<span style="color: #98C379;">"It's an int!"</span>);
            Console.WriteLine ($<span style="color: #98C379;">"The square of {i} is {i * i}"</span>);
            <span style="color: #C678DD;">break</span>;
        <span style="color: #C678DD;">case</span> <span style="color: #E5C07B;">string</span> s:
            Console.WriteLine (<span style="color: #98C379;">"It's a string"</span>);
            Console.WriteLine ($<span style="color: #98C379;">"The length of {s} is {s.Length}"</span>);
            <span style="color: #C678DD;">break</span>;
        <span style="color: #C678DD;">default</span>:
            Console.WriteLine (<span style="color: #98C379;">"I don't know what x is"</span>);
            <span style="color: #C678DD;">break</span>;
    }
}
</pre>
</div>

<p>
With <code>when</code>:
</p>
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #C678DD;">switch</span> (x)
{
    <span style="color: #C678DD;">case</span> <span style="color: #E5C07B;">bool</span> b <span style="color: #C678DD;">when</span> b == <span style="color: #56B6C2;">true</span>: <span style="color: #5C6370; font-style: italic;">// </span><span style="color: #5C6370; font-style: italic;">Fires only when b is true</span>
        Console.WriteLine (<span style="color: #98C379;">"True!"</span>);
        <span style="color: #C678DD;">break</span>;
    <span style="color: #C678DD;">case</span> <span style="color: #E5C07B;">bool</span> b:
        Console.WriteLine (<span style="color: #98C379;">"False!"</span>);
        <span style="color: #C678DD;">break</span>;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org7cefb67" class="outline-4">
<h4 id="org7cefb67"><span class="section-number-4">2.12.2</span> Switch expressions</h4>
<div class="outline-text-4" id="text-2-12-2">
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #E5C07B;">string</span> <span style="color: #E06C75;">cardName</span> = cardNumber <span style="color: #C678DD;">switch</span>
{
    13 =&gt; <span style="color: #98C379;">"King"</span>,
    12 =&gt; <span style="color: #98C379;">"Queen"</span>,
    11 =&gt; <span style="color: #98C379;">"Jack"</span>,
    _ =&gt; <span style="color: #98C379;">"Pip card"</span> <span style="color: #5C6370; font-style: italic;">// </span><span style="color: #5C6370; font-style: italic;">equivalent to 'default'</span>
};
</pre>
</div>
</div>
</div>
</div>
</div>


<div id="outline-container-orgf32de9e" class="outline-2">
<h2 id="orgf32de9e"><span class="section-number-2">3</span> Creating Types in C#</h2>
<div class="outline-text-2" id="text-3">
</div>
<div id="outline-container-orgbc2fa5b" class="outline-3">
<h3 id="orgbc2fa5b"><span class="section-number-3">3.1</span> Classes</h3>
<div class="outline-text-3" id="text-3-1">
</div>
<div id="outline-container-orga481c57" class="outline-4">
<h4 id="orga481c57"><span class="section-number-4">3.1.1</span> Doconstructors</h4>
<div class="outline-text-4" id="text-3-1-1">
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #E5C07B;">var</span> <span style="color: #E06C75;">rect</span> = <span style="color: #C678DD;">new</span> <span style="color: #E5C07B;">Rectangle</span> (3, 4);

(<span style="color: #E5C07B;">float</span> <span style="color: #E06C75;">width</span>, <span style="color: #E5C07B;">float</span> <span style="color: #E06C75;">height</span>) = rect; <span style="color: #5C6370; font-style: italic;">// </span><span style="color: #5C6370; font-style: italic;">Deconstruction</span>
<span style="color: #E5C07B;">var</span> (<span style="color: #E5C07B;">width1</span>, <span style="color: #E5C07B;">height1</span>) = rect;       <span style="color: #5C6370; font-style: italic;">// </span><span style="color: #5C6370; font-style: italic;">shorter version of the same</span>

<span style="color: #5C6370; font-style: italic;">// </span><span style="color: #5C6370; font-style: italic;">... or use desonctructing assignment</span>
<span style="color: #E5C07B;">float</span> <span style="color: #E06C75;">width3</span>, <span style="color: #E06C75;">height3</span>;
(width3, height3) = rect;

Console.WriteLine (width + <span style="color: #98C379;">" "</span> + height); <span style="color: #5C6370; font-style: italic;">// </span><span style="color: #5C6370; font-style: italic;">3 4</span>
</pre>
</div>

<p>
Defintion for the above:
</p>
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #C678DD;">class</span> <span style="color: #E5C07B;">Rectangle</span>
{
    <span style="color: #C678DD;">public</span> <span style="color: #C678DD;">readonly</span> <span style="color: #E5C07B;">float</span> <span style="color: #E06C75;">Width</span>, <span style="color: #E06C75;">Height</span>;
    <span style="color: #C678DD;">public</span> Rectangle (<span style="color: #E5C07B;">float</span> <span style="color: #E06C75;">width</span>, <span style="color: #E5C07B;">float</span> <span style="color: #E06C75;">height</span>)
    {
        Width = width;
        Height = height;
    }
    <span style="color: #C678DD;">public</span> <span style="color: #E5C07B;">void</span> <span style="color: #61AFEF;">Deconstruct</span> (<span style="color: #C678DD;">out</span> <span style="color: #E5C07B;">float</span> <span style="color: #E06C75;">width</span>, <span style="color: #C678DD;">out</span> <span style="color: #E5C07B;">float</span> <span style="color: #E06C75;">height</span>)
    {
        width = Width;
        height = Height;
    }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org3903019" class="outline-4">
<h4 id="org3903019"><span class="section-number-4">3.1.2</span> Object initializers</h4>
<div class="outline-text-4" id="text-3-1-2">
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #C678DD;">public</span> <span style="color: #C678DD;">class</span> <span style="color: #E5C07B;">Bunny</span>
{
    <span style="color: #C678DD;">public</span> <span style="color: #E5C07B;">string</span> <span style="color: #E06C75;">Name</span>;
    <span style="color: #C678DD;">public</span> <span style="color: #E5C07B;">bool</span> <span style="color: #E06C75;">LikesCarrots</span>;
    <span style="color: #C678DD;">public</span> <span style="color: #E5C07B;">bool</span> <span style="color: #E06C75;">LikesHumans</span>;
    <span style="color: #C678DD;">public</span> Bunny () {}
    <span style="color: #C678DD;">public</span> Bunny (<span style="color: #E5C07B;">string</span> <span style="color: #E06C75;">n</span>) { Name = n; }
}
</pre>
</div>

<p>
Using object initializers, you can instantiate Bunny objects as follows:
</p>

<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #5C6370; font-style: italic;">// </span><span style="color: #5C6370; font-style: italic;">Note parameterless constructors can omit empty parentheses</span>
<span style="color: #E5C07B;">Bunny</span> <span style="color: #E06C75;">b1</span> = <span style="color: #C678DD;">new</span> <span style="color: #E5C07B;">Bunny</span> { <span style="color: #E06C75;">Name</span>=<span style="color: #98C379;">"Bo"</span>, <span style="color: #E06C75;">LikesCarrots</span>=<span style="color: #56B6C2;">true</span>, <span style="color: #E06C75;">LikesHumans</span>=<span style="color: #56B6C2;">false</span> };
<span style="color: #E5C07B;">Bunny</span> <span style="color: #E06C75;">b2</span> = <span style="color: #C678DD;">new</span> <span style="color: #E5C07B;">Bunny</span> (<span style="color: #98C379;">"Bo"</span>) { LikesCarrots=<span style="color: #56B6C2;">true</span>, LikesHumans=<span style="color: #56B6C2;">false</span> };
</pre>
</div>

<p>
The code to construct b1 and b2 is precisely equivalent to the following:
</p>

<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #E5C07B;">Bunny</span> <span style="color: #E06C75;">temp1</span> = <span style="color: #C678DD;">new</span> <span style="color: #E5C07B;">Bunny</span>(); <span style="color: #5C6370; font-style: italic;">// </span><span style="color: #5C6370; font-style: italic;">temp1 is a compiler-generated name</span>
temp1.Name = <span style="color: #98C379;">"Bo"</span>;
temp1.LikesCarrots = <span style="color: #56B6C2;">true</span>;
temp1.LikesHumans = <span style="color: #56B6C2;">false</span>;
<span style="color: #E5C07B;">Bunny</span> <span style="color: #E06C75;">b1</span> = temp1;

<span style="color: #E5C07B;">Bunny</span> <span style="color: #E06C75;">temp2</span> = <span style="color: #C678DD;">new</span> <span style="color: #E5C07B;">Bunny</span> (<span style="color: #98C379;">"Bo"</span>);
temp2.LikesCarrots = <span style="color: #56B6C2;">true</span>;
temp2.LikesHumans = <span style="color: #56B6C2;">false</span>;
<span style="color: #E5C07B;">Bunny</span> <span style="color: #E06C75;">b2</span> = temp2;
</pre>
</div>

<p>
The temporary variables are to ensure that if an exception is thrown during initialization,
you can't end up with a half-initialized object.
</p>

<blockquote>
<p>
The second drawback of optional parameters is that when used in public libraries,
they hinder backward compatibility. This is because the act of adding an optional
parameter at a later date breaks the assembly's binary compatibility with existing
consumers.
</p>

<p>
The difficulty is that each optional parameter value is baked into the calling site. In
other words, C# translates our constructor call into this:
</p>

<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #E5C07B;">Bunny</span> <span style="color: #E06C75;">b1</span> = <span style="color: #C678DD;">new</span> <span style="color: #E5C07B;">Bunny</span> (<span style="color: #98C379;">"Bo"</span>, <span style="color: #56B6C2;">true</span>, <span style="color: #56B6C2;">false</span>);
</pre>
</div>

<p>
This is problematic if we instantiate the Bunny class from another assembly and
later modify Bunny by adding another optional parametersuch as likesCats.
Unless the referencing assembly is also recompiled, it will continue to call the
(now nonexistent) constructor with three parameters and fail at runtime. (A subtler
problem is that if we changed the value of one of the optional parameters, callers
in other assemblies would continue to use the old optional value until they were
recompiled.)
</p>
</blockquote>
</div>
</div>

<div id="outline-container-org3fcfe8a" class="outline-4">
<h4 id="org3fcfe8a"><span class="section-number-4">3.1.3</span> Properties</h4>
<div class="outline-text-4" id="text-3-1-3">
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #C678DD;">public</span> <span style="color: #C678DD;">class</span> <span style="color: #E5C07B;">Stock</span>
{
    <span style="color: #E5C07B;">decimal</span> <span style="color: #E06C75;">currentPrice</span>; <span style="color: #5C6370; font-style: italic;">// </span><span style="color: #5C6370; font-style: italic;">The private "backing" field</span>
    <span style="color: #C678DD;">public</span> <span style="color: #E5C07B;">decimal</span> <span style="color: #E06C75;">CurrentPrice</span> <span style="color: #5C6370; font-style: italic;">// </span><span style="color: #5C6370; font-style: italic;">The public property</span>
    {
        <span style="color: #C678DD;">get</span> { <span style="color: #C678DD;">return</span> currentPrice; }
        <span style="color: #C678DD;">set</span> { currentPrice = <span style="color: #56B6C2;">value</span>; }
    }
}
</pre>
</div>

<p>
With automatic properties:
</p>

<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #C678DD;">public</span> <span style="color: #C678DD;">class</span> <span style="color: #E5C07B;">Stock</span>
{
    <span style="color: #C678DD;">public</span> <span style="color: #E5C07B;">decimal</span> <span style="color: #E06C75;">CurrentPrice</span> { <span style="color: #C678DD;">get</span>; <span style="color: #C678DD;">set</span>; }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org9e20263" class="outline-4">
<h4 id="org9e20263"><span class="section-number-4">3.1.4</span> Init-only setters</h4>
<div class="outline-text-4" id="text-3-1-4">
<p>
Fromn C#9:
</p>
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #C678DD;">public</span> <span style="color: #C678DD;">class</span> <span style="color: #E5C07B;">Note</span>
{
    <span style="color: #C678DD;">public</span> <span style="color: #E5C07B;">int</span> <span style="color: #E06C75;">Pitch</span> { <span style="color: #C678DD;">get</span>; init; } = 20; <span style="color: #5C6370; font-style: italic;">// </span><span style="color: #5C6370; font-style: italic;">\223Init-only\224 property</span>
    <span style="color: #C678DD;">public</span> <span style="color: #E5C07B;">int</span> <span style="color: #E06C75;">Duration</span> { <span style="color: #C678DD;">get</span>; init; } = 100; <span style="color: #5C6370; font-style: italic;">// </span><span style="color: #5C6370; font-style: italic;">\223Init-only\224 property</span>
}
</pre>
</div>

<blockquote>
<p>
These init-only properties act like read-only properties, except that they can also be
set via an object initializer:
</p>
</blockquote>

<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #E5C07B;">var</span> <span style="color: #E06C75;">note</span> = <span style="color: #C678DD;">new</span> <span style="color: #E5C07B;">Note</span> { <span style="color: #E06C75;">Pitch</span> = 50 };
</pre>
</div>
</div>
</div>

<div id="outline-container-org1666d4b" class="outline-4">
<h4 id="org1666d4b"><span class="section-number-4">3.1.5</span> Indexers</h4>
<div class="outline-text-4" id="text-3-1-5">
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #E5C07B;">string</span> <span style="color: #E06C75;">s</span> = <span style="color: #56B6C2;">null</span>;
Console.WriteLine (s?[0]); <span style="color: #5C6370; font-style: italic;">// </span><span style="color: #5C6370; font-style: italic;">Writes nothing; no error.</span>
</pre>
</div>

<p>
Implementation example:
</p>
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #C678DD;">class</span> <span style="color: #E5C07B;">Sentence</span>
{
    <span style="color: #E5C07B;">string</span>[] <span style="color: #E06C75;">words</span> = <span style="color: #98C379;">"The quick brown fox"</span>.<span style="color: #61AFEF;">Split</span>();
    <span style="color: #C678DD;">public</span> <span style="color: #E5C07B;">string</span> <span style="color: #C678DD;">this</span> [<span style="color: #E5C07B;">int</span> wordNum] <span style="color: #5C6370; font-style: italic;">// </span><span style="color: #5C6370; font-style: italic;">indexer</span>
    {
        <span style="color: #C678DD;">get</span> { <span style="color: #C678DD;">return</span> words [wordNum]; }
        <span style="color: #C678DD;">set</span> { words [wordNum] = <span style="color: #56B6C2;">value</span>; }
    }

    <span style="color: #C678DD;">public</span> <span style="color: #E5C07B;">string</span> <span style="color: #C678DD;">this</span> [Index index] =&gt; words [index];
    <span style="color: #C678DD;">public</span> <span style="color: #E5C07B;">string</span>[] <span style="color: #C678DD;">this</span> [Range range] =&gt; words [range];
}
</pre>
</div>

<p>
Usage:
</p>
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #E5C07B;">Sentence</span> <span style="color: #E06C75;">s</span> = <span style="color: #C678DD;">new</span> <span style="color: #E5C07B;">Sentence</span>();
Console.WriteLine (s[3]); <span style="color: #5C6370; font-style: italic;">// </span><span style="color: #5C6370; font-style: italic;">fox</span>
s[3] = <span style="color: #98C379;">"kangaroo"</span>;
Console.WriteLine (s[3]); <span style="color: #5C6370; font-style: italic;">// </span><span style="color: #5C6370; font-style: italic;">kangaroo</span>

Console.WriteLine (s [^1]); <span style="color: #5C6370; font-style: italic;">// </span><span style="color: #5C6370; font-style: italic;">fox</span>
<span style="color: #E5C07B;">string</span>[] <span style="color: #E06C75;">firstTwoWords</span> = s [..2]; <span style="color: #5C6370; font-style: italic;">// </span><span style="color: #5C6370; font-style: italic;">(The, quick)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org493670c" class="outline-4">
<h4 id="org493670c"><span class="section-number-4">3.1.6</span> Pattern variable</h4>
<div class="outline-text-4" id="text-3-1-6">
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #C678DD;">if</span> (a <span style="color: #C678DD;">is</span> Stock s)
    Console.WriteLine (s.SharesOwned);
</pre>
</div>

<p>
Above is equivalent to:
</p>
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #E5C07B;">Stock</span> <span style="color: #E06C75;">s</span>;
<span style="color: #C678DD;">if</span> (a <span style="color: #C678DD;">is</span> Stock)
{
    s = (<span style="color: #E5C07B;">Stock</span>) a;
    Console.WriteLine (s.SharesOwned);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgffbedf3" class="outline-4">
<h4 id="orgffbedf3"><span class="section-number-4">3.1.7</span> Covariant return types</h4>
<div class="outline-text-4" id="text-3-1-7">
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #C678DD;">public</span> <span style="color: #C678DD;">class</span> <span style="color: #E5C07B;">Asset</span>
{
    <span style="color: #C678DD;">public</span> <span style="color: #E5C07B;">string</span> <span style="color: #E06C75;">Name</span>;
    <span style="color: #C678DD;">public</span> <span style="color: #C678DD;">virtual</span> <span style="color: #E5C07B;">Asset</span> <span style="color: #61AFEF;">Clone</span>() =&gt; <span style="color: #C678DD;">new</span> <span style="color: #E5C07B;">Asset</span> { <span style="color: #E06C75;">Name</span> = Name };
}
<span style="color: #C678DD;">public</span> <span style="color: #C678DD;">class</span> <span style="color: #E5C07B;">House</span> : <span style="color: #E5C07B;">Asset</span>
{
    <span style="color: #C678DD;">public</span> <span style="color: #E5C07B;">decimal</span> <span style="color: #E06C75;">Mortgage</span>;
    <span style="color: #C678DD;">public</span> <span style="color: #C678DD;">override</span> <span style="color: #E5C07B;">House</span> <span style="color: #61AFEF;">Clone</span>() =&gt; <span style="color: #C678DD;">new</span> <span style="color: #E5C07B;">House</span>
    { <span style="color: #E06C75;">Name</span> = Name, <span style="color: #E06C75;">Mortgage</span> = Mortgage };
}
</pre>
</div>

<blockquote>
<p>
This is permitted because it does not break the contract that <code>Clone</code> must return an
<code>Asset</code>: it returns a <code>House</code>, which is an <code>Asset</code> (and more).
</p>
</blockquote>
</div>
</div>

<div id="outline-container-org4d4dd4d" class="outline-4">
<h4 id="org4d4dd4d"><span class="section-number-4">3.1.8</span> <code>new</code> versus <code>override</code></h4>
<div class="outline-text-4" id="text-3-1-8">
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #C678DD;">public</span> <span style="color: #C678DD;">class</span> <span style="color: #E5C07B;">BaseClass</span>
{
    <span style="color: #C678DD;">public</span> <span style="color: #C678DD;">virtual</span> <span style="color: #E5C07B;">void</span> <span style="color: #61AFEF;">Foo</span>() { Console.WriteLine (<span style="color: #98C379;">"BaseClass.Foo"</span>); }
}
<span style="color: #C678DD;">public</span> <span style="color: #C678DD;">class</span> <span style="color: #E5C07B;">Overrider</span> : <span style="color: #E5C07B;">BaseClass</span>
{
    <span style="color: #C678DD;">public</span> <span style="color: #C678DD;">override</span> <span style="color: #E5C07B;">void</span> <span style="color: #61AFEF;">Foo</span>() { Console.WriteLine (<span style="color: #98C379;">"Overrider.Foo"</span>); }
}
<span style="color: #C678DD;">public</span> <span style="color: #C678DD;">class</span> <span style="color: #E5C07B;">Hider</span> : <span style="color: #E5C07B;">BaseClass</span>
{
    <span style="color: #C678DD;">public</span> <span style="color: #C678DD;">new</span> <span style="color: #E5C07B;">void</span> <span style="color: #E5C07B;">Foo</span>() { Console.WriteLine (<span style="color: #98C379;">"Hider.Foo"</span>); }
}
</pre>
</div>

<p>
Differences demonstrated below:
</p>
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #E5C07B;">Overrider</span> <span style="color: #E06C75;">over</span> = <span style="color: #C678DD;">new</span> <span style="color: #E5C07B;">Overrider</span>();
<span style="color: #E5C07B;">BaseClass</span> <span style="color: #E06C75;">b1</span> = over;
over.<span style="color: #61AFEF;">Foo</span>(); <span style="color: #5C6370; font-style: italic;">// </span><span style="color: #5C6370; font-style: italic;">Overrider.Foo</span>
b1.<span style="color: #61AFEF;">Foo</span>(); <span style="color: #5C6370; font-style: italic;">// </span><span style="color: #5C6370; font-style: italic;">Overrider.Foo</span>
<span style="color: #E5C07B;">Hider</span> <span style="color: #E06C75;">h</span> = <span style="color: #C678DD;">new</span> <span style="color: #E5C07B;">Hider</span>();
<span style="color: #E5C07B;">BaseClass</span> <span style="color: #E06C75;">b2</span> = h;
h.<span style="color: #61AFEF;">Foo</span>(); <span style="color: #5C6370; font-style: italic;">// </span><span style="color: #5C6370; font-style: italic;">Hider.Foo</span>
b2.<span style="color: #61AFEF;">Foo</span>(); <span style="color: #5C6370; font-style: italic;">// </span><span style="color: #5C6370; font-style: italic;">BaseClass.Foo</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org76250a2" class="outline-4">
<h4 id="org76250a2"><span class="section-number-4">3.1.9</span> Initialization sequence</h4>
<div class="outline-text-4" id="text-3-1-9">
<ul class="org-ul">
<li>From <code>subclass</code> to <code>base</code> class
<ul class="org-ul">
<li><code>Fields</code> are initialized</li>
<li>Arguments to <code>base</code>-class constructor calls are evaluated</li>
</ul></li>
<li>From <code>base</code> class to <code>subclass</code>
<ul class="org-ul">
<li>Constructor bodies are executed</li>
</ul></li>
</ul>


<p>
Example:
</p>
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #C678DD;">public</span> <span style="color: #C678DD;">class</span> <span style="color: #E5C07B;">B</span>
{
    <span style="color: #E5C07B;">int</span> <span style="color: #E06C75;">x</span> = 1; <span style="color: #5C6370; font-style: italic;">// </span><span style="color: #5C6370; font-style: italic;">Executes 3rd</span>
    <span style="color: #C678DD;">public</span> B (<span style="color: #E5C07B;">int</span> <span style="color: #E06C75;">x</span>)
    {
        ... <span style="color: #5C6370; font-style: italic;">// </span><span style="color: #5C6370; font-style: italic;">Executes 4th</span>
            }
}
<span style="color: #C678DD;">public</span> <span style="color: #C678DD;">class</span> <span style="color: #E5C07B;">D</span> : <span style="color: #E5C07B;">B</span>
{
    <span style="color: #E5C07B;">int</span> <span style="color: #E06C75;">y</span> = 1; <span style="color: #5C6370; font-style: italic;">// </span><span style="color: #5C6370; font-style: italic;">Executes 1st</span>
    <span style="color: #C678DD;">public</span> D (<span style="color: #E5C07B;">int</span> <span style="color: #E06C75;">x</span>)
        : <span style="color: #C678DD;">base</span> (x + 1) <span style="color: #5C6370; font-style: italic;">// </span><span style="color: #5C6370; font-style: italic;">Executes 2nd</span>
    {
        ... <span style="color: #5C6370; font-style: italic;">// </span><span style="color: #5C6370; font-style: italic;">Executes 5th</span>
            }
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org44ff89b" class="outline-3">
<h3 id="org44ff89b"><span class="section-number-3">3.2</span> Structs</h3>
<div class="outline-text-3" id="text-3-2">
<blockquote>
<p>
A <code>struct</code> is similar to a class, with the following key differences:
</p>
<ul class="org-ul">
<li>A <code>struct</code> is a value type, whereas a class is a reference type</li>
<li>A <code>struct</code> does not support inheritance</li>
</ul>
</blockquote>

<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #E5C07B;">Point</span> <span style="color: #E06C75;">p</span> = <span style="color: #C678DD;">new</span> <span style="color: #E5C07B;">Point</span>(); <span style="color: #5C6370; font-style: italic;">// </span><span style="color: #5C6370; font-style: italic;">p.x and p.y will be 0</span>
<span style="color: #C678DD;">struct</span> <span style="color: #E5C07B;">Point</span> { <span style="color: #E5C07B;">int</span> <span style="color: #E06C75;">x</span>, <span style="color: #E06C75;">y</span>; }
</pre>
</div>
</div>
</div>

<div id="outline-container-org7294d26" class="outline-3">
<h3 id="org7294d26"><span class="section-number-3">3.3</span> Interfaces</h3>
<div class="outline-text-3" id="text-3-3">
<p>
Interface:
</p>
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #C678DD;">public</span> <span style="color: #C678DD;">interface</span> <span style="color: #E5C07B;">IEnumerator</span>
{
    <span style="color: #E5C07B;">bool</span> <span style="color: #61AFEF;">MoveNext</span>();
    <span style="color: #E5C07B;">object</span> <span style="color: #E06C75;">Current</span> { <span style="color: #C678DD;">get</span>; }
    <span style="color: #E5C07B;">void</span> <span style="color: #61AFEF;">Reset</span>();
}
</pre>
</div>

<p>
Implementation:
</p>
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #C678DD;">internal</span> <span style="color: #C678DD;">class</span> <span style="color: #E5C07B;">Countdown</span> : <span style="color: #E5C07B;">IEnumerator</span>
{
    <span style="color: #E5C07B;">int</span> <span style="color: #E06C75;">count</span> = 11;
    <span style="color: #C678DD;">public</span> <span style="color: #E5C07B;">bool</span> <span style="color: #61AFEF;">MoveNext</span>() =&gt; count-- &gt; 0;
    <span style="color: #C678DD;">public</span> <span style="color: #E5C07B;">object</span> <span style="color: #E06C75;">Current</span> =&gt; count;
    <span style="color: #C678DD;">public</span> <span style="color: #E5C07B;">void</span> <span style="color: #61AFEF;">Reset</span>() { <span style="color: #C678DD;">throw</span> <span style="color: #C678DD;">new</span> <span style="color: #E5C07B;">NotSupportedException</span>(); }
}
</pre>
</div>
</div>

<div id="outline-container-orgd62505e" class="outline-4">
<h4 id="orgd62505e"><span class="section-number-4">3.3.1</span> Implementing Interface members virtually</h4>
<div class="outline-text-4" id="text-3-3-1">
<blockquote>
<p>
An implicitly implemented interface member is, by default, sealed. It must be
marked virtual or abstract in the base class in order to be overridden:
</p>
</blockquote>

<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #C678DD;">public</span> <span style="color: #C678DD;">interface</span> <span style="color: #E5C07B;">IUndoable</span> { <span style="color: #E5C07B;">void</span> <span style="color: #61AFEF;">Undo</span>(); }
<span style="color: #C678DD;">public</span> <span style="color: #C678DD;">class</span> <span style="color: #E5C07B;">TextBox</span> : <span style="color: #E5C07B;">IUndoable</span>
{
    <span style="color: #C678DD;">public</span> <span style="color: #C678DD;">virtual</span> <span style="color: #E5C07B;">void</span> <span style="color: #61AFEF;">Undo</span>() =&gt; Console.WriteLine (<span style="color: #98C379;">"TextBox.Undo"</span>);
}
<span style="color: #C678DD;">public</span> <span style="color: #C678DD;">class</span> <span style="color: #E5C07B;">RichTextBox</span> : <span style="color: #E5C07B;">TextBox</span>
{
    <span style="color: #C678DD;">public</span> <span style="color: #C678DD;">override</span> <span style="color: #E5C07B;">void</span> <span style="color: #61AFEF;">Undo</span>() =&gt; Console.WriteLine (<span style="color: #98C379;">"RichTextBox.Undo"</span>);
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgf204463" class="outline-3">
<h3 id="orgf204463"><span class="section-number-3">3.4</span> Enums</h3>
<div class="outline-text-3" id="text-3-4">
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #C678DD;">public</span> <span style="color: #C678DD;">enum</span> <span style="color: #E5C07B;">BorderSide</span> { <span style="color: #E06C75;">Left</span>, <span style="color: #E06C75;">Right</span>, <span style="color: #E06C75;">Top</span>, <span style="color: #E06C75;">Bottom</span> }
</pre>
</div>
</div>
</div>

<div id="outline-container-orgdfc900a" class="outline-3">
<h3 id="orgdfc900a"><span class="section-number-3">3.5</span> Generics</h3>
<div class="outline-text-3" id="text-3-5">
<p>
Define:
</p>
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #C678DD;">public</span> <span style="color: #C678DD;">class</span> <span style="color: #E5C07B;">Stack</span>&lt;<span style="color: #E5C07B;">T</span>&gt;
{
    <span style="color: #E5C07B;">int</span> <span style="color: #E06C75;">position</span>;
    <span style="color: #E5C07B;">T</span>[] <span style="color: #E06C75;">data</span> = <span style="color: #C678DD;">new</span> <span style="color: #E5C07B;">T</span>[100];
    <span style="color: #C678DD;">public</span> <span style="color: #E5C07B;">void</span> <span style="color: #61AFEF;">Push</span> (<span style="color: #E5C07B;">T</span> <span style="color: #E06C75;">obj</span>) =&gt; data[position++] = obj;
    <span style="color: #C678DD;">public</span> <span style="color: #E5C07B;">T</span> <span style="color: #61AFEF;">Pop</span>() =&gt; data[--position];
}
</pre>
</div>

<p>
Use:
</p>
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #E5C07B;">var</span> <span style="color: #E06C75;">stack</span> = <span style="color: #C678DD;">new</span> <span style="color: #E5C07B;">Stack</span>&lt;<span style="color: #E5C07B;">int</span>&gt;();
stack.Push (5);
stack.Push (10);
<span style="color: #E5C07B;">int</span> <span style="color: #E06C75;">x</span> = stack.<span style="color: #61AFEF;">Pop</span>(); <span style="color: #5C6370; font-style: italic;">// </span><span style="color: #5C6370; font-style: italic;">x is 10</span>
<span style="color: #E5C07B;">int</span> <span style="color: #E06C75;">y</span> = stack.<span style="color: #61AFEF;">Pop</span>(); <span style="color: #5C6370; font-style: italic;">// </span><span style="color: #5C6370; font-style: italic;">y is 5</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orga7e1b68" class="outline-3">
<h3 id="orga7e1b68"><span class="section-number-3">3.6</span> Generic methods</h3>
<div class="outline-text-3" id="text-3-6">
<p>
Define:
</p>
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #C678DD;">static</span> <span style="color: #E5C07B;">void</span> <span style="color: #61AFEF;">Swap</span>&lt;<span style="color: #E5C07B;">T</span>&gt; (<span style="color: #C678DD;">ref</span> <span style="color: #E5C07B;">T</span> <span style="color: #E06C75;">a</span>, <span style="color: #C678DD;">ref</span> <span style="color: #E5C07B;">T</span> <span style="color: #E06C75;">b</span>)
{
    <span style="color: #E5C07B;">T</span> <span style="color: #E06C75;">temp</span> = a;
    a = b;
    b = temp;
}
</pre>
</div>

<p>
Use:
</p>
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #E5C07B;">int</span> <span style="color: #E06C75;">x</span> = 5;
<span style="color: #E5C07B;">int</span> <span style="color: #E06C75;">y</span> = 10;
Swap (<span style="color: #C678DD;">ref</span> <span style="color: #E5C07B;">x</span>, <span style="color: #C678DD;">ref</span> <span style="color: #E5C07B;">y</span>);
</pre>
</div>
</div>
</div>
</div>


<div id="outline-container-org0eed850" class="outline-2">
<h2 id="org0eed850"><span class="section-number-2">4</span> Advanced C#</h2>
<div class="outline-text-2" id="text-4">
</div>
<div id="outline-container-orgeca457b" class="outline-3">
<h3 id="orgeca457b"><span class="section-number-3">4.1</span> Delegates</h3>
<div class="outline-text-3" id="text-4-1">
<blockquote>
<p>
A delegate is an object that knows how to call a method.
</p>

<p>
A delegate type defines the kind of method that delegate instances can call. Specifically,
it defines the method's return type and its parameter types.
</p>
</blockquote>

<p>
Examples:
</p>
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #C678DD;">delegate</span> <span style="color: #E5C07B;">int</span> <span style="color: #61AFEF;">Transformer</span> (<span style="color: #E5C07B;">int</span> <span style="color: #E06C75;">x</span>); <span style="color: #5C6370; font-style: italic;">// </span><span style="color: #5C6370; font-style: italic;">define a delegate</span>

<span style="color: #E5C07B;">int</span> <span style="color: #61AFEF;">Square</span> (<span style="color: #E5C07B;">int</span> <span style="color: #E06C75;">x</span>) =&gt; x *x;

<span style="color: #E5C07B;">Transformer</span> <span style="color: #E06C75;">t</span> = Square; <span style="color: #5C6370; font-style: italic;">// </span><span style="color: #5C6370; font-style: italic;">create a delegate instance</span>
<span style="color: #5C6370; font-style: italic;">// </span><span style="color: #5C6370; font-style: italic;">short for: Transformer t = new Transformer (Square)</span>

<span style="color: #E5C07B;">int</span> <span style="color: #E06C75;">answer</span> = <span style="color: #61AFEF;">t</span>(3); <span style="color: #5C6370; font-style: italic;">// </span><span style="color: #5C6370; font-style: italic;">answer is 9; invoke a delegate</span>
<span style="color: #5C6370; font-style: italic;">// </span><span style="color: #5C6370; font-style: italic;">short for: t.Invoke(3)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org45fd1f8" class="outline-3">
<h3 id="org45fd1f8"><span class="section-number-3">4.2</span> Higher-order functions</h3>
<div class="outline-text-3" id="text-4-2">
<p>
A function that takes another function as an argument or returns another <i>delegate</i>.
</p>

<p>
Example:
</p>
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #E5C07B;">int</span>[] <span style="color: #E06C75;">values</span> = { 1, 2, 3 };
Transform (values, Square); <span style="color: #5C6370; font-style: italic;">// </span><span style="color: #5C6370; font-style: italic;">Hook in the Square method</span>

<span style="color: #C678DD;">foreach</span> (<span style="color: #E5C07B;">int</span> <span style="color: #E06C75;">i</span> <span style="color: #C678DD;">in</span> values)
    Console.Write (i + <span style="color: #98C379;">" "</span>); <span style="color: #5C6370; font-style: italic;">// </span><span style="color: #5C6370; font-style: italic;">1 4 9</span>

<span style="color: #E5C07B;">void</span> <span style="color: #61AFEF;">Transform</span> (<span style="color: #E5C07B;">int</span>[] <span style="color: #E06C75;">values</span>, <span style="color: #E5C07B;">Transformer</span> <span style="color: #E06C75;">t</span>)
{
    <span style="color: #C678DD;">for</span> (<span style="color: #E5C07B;">int</span> <span style="color: #E06C75;">i</span> = 0; i &lt; values.Length; i++)
        values[i] = t (values[i]);
}

<span style="color: #E5C07B;">int</span> <span style="color: #61AFEF;">Square</span> (<span style="color: #E5C07B;">int</span> <span style="color: #E06C75;">x</span>) =&gt; x * x;
<span style="color: #E5C07B;">int</span> <span style="color: #61AFEF;">Cube</span> (<span style="color: #E5C07B;">int</span> <span style="color: #E06C75;">x</span>) =&gt; x * x * x;

<span style="color: #C678DD;">delegate</span> <span style="color: #E5C07B;">int</span> <span style="color: #61AFEF;">Transformer</span> (<span style="color: #E5C07B;">int</span> <span style="color: #E06C75;">x</span>);
</pre>
</div>
</div>
</div>

<div id="outline-container-org4b07755" class="outline-3">
<h3 id="org4b07755"><span class="section-number-3">4.3</span> Multicast delegates</h3>
<div class="outline-text-3" id="text-4-3">
<blockquote>
<p>
All delegate instances have <b>multicast</b> capability. This means that a delegate instance
can reference not just a single target method but also a list of target methods.
</p>
</blockquote>

<p>
Basic example:
</p>
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #E5C07B;">SomeDelegate</span> <span style="color: #E06C75;">d</span> = SomeMethod1;
d += SomeMethod2;
</pre>
</div>

<p>
Example (writing progress in two separarte sinks):
</p>
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #E5C07B;">ProgressReporter</span> <span style="color: #E06C75;">p</span> = WriteProgressToConsole;
p += WriteProgressToFile;
Util.HardWork (p);

<span style="color: #E5C07B;">void</span> <span style="color: #61AFEF;">WriteProgressToConsole</span> (<span style="color: #E5C07B;">int</span> <span style="color: #E06C75;">percentComplete</span>)
    =&gt; Console.WriteLine (percentComplete);

<span style="color: #E5C07B;">void</span> <span style="color: #61AFEF;">WriteProgressToFile</span> (<span style="color: #E5C07B;">int</span> <span style="color: #E06C75;">percentComplete</span>)
    =&gt; System.IO.File.WriteAllText (<span style="color: #98C379;">"progress.txt"</span>,
                                    percentComplete.<span style="color: #61AFEF;">ToString</span>());

<span style="color: #C678DD;">public</span> <span style="color: #C678DD;">delegate</span> <span style="color: #E5C07B;">void</span> <span style="color: #61AFEF;">ProgressReporter</span> (<span style="color: #E5C07B;">int</span> <span style="color: #E06C75;">percentComplete</span>);
<span style="color: #C678DD;">public</span> <span style="color: #C678DD;">class</span> <span style="color: #E5C07B;">Util</span>
{
    <span style="color: #C678DD;">public</span> <span style="color: #C678DD;">static</span> <span style="color: #E5C07B;">void</span> <span style="color: #61AFEF;">HardWork</span> (<span style="color: #E5C07B;">ProgressReporter</span> <span style="color: #E06C75;">p</span>)
    {
        <span style="color: #C678DD;">for</span> (<span style="color: #E5C07B;">int</span> <span style="color: #E06C75;">i</span> = 0; i &lt; 10; i++)
        {
            p (i * 10); <span style="color: #5C6370; font-style: italic;">// </span><span style="color: #5C6370; font-style: italic;">Invoke delegate</span>
            System.Threading.Thread.Sleep (100); <span style="color: #5C6370; font-style: italic;">// </span><span style="color: #5C6370; font-style: italic;">Simulate hard work</span>
        }
    }
</pre>
</div>
</div>
</div>

<div id="outline-container-orgccb8436" class="outline-3">
<h3 id="orgccb8436"><span class="section-number-3">4.4</span> The <code>Func</code> and <code>Action</code> delegates</h3>
<div class="outline-text-3" id="text-4-4">
<blockquote>
<p>
When C# was first introduced, the Func and Action delegates
did not exist (because generics did not exist). Its for this historical
reason that much of .NET uses custom delegate types
rather than Func and Action.
</p>
</blockquote>

<p>
These delegates are the Func and Action delegates, defined
in the System namespace:
</p>
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #C678DD;">delegate</span> <span style="color: #E5C07B;">TResult</span> <span style="color: #61AFEF;">Func</span> &lt;<span style="color: #C678DD;">out</span> <span style="color: #E5C07B;">TResult</span>&gt; ();
<span style="color: #C678DD;">delegate</span> <span style="color: #E5C07B;">TResult</span> <span style="color: #61AFEF;">Func</span> &lt;<span style="color: #C678DD;">in</span> T, <span style="color: #C678DD;">out</span> <span style="color: #E5C07B;">TResult</span>&gt; (<span style="color: #E5C07B;">T</span> <span style="color: #E06C75;">arg</span>);
<span style="color: #C678DD;">delegate</span> <span style="color: #E5C07B;">TResult</span> <span style="color: #61AFEF;">Func</span> &lt;<span style="color: #C678DD;">in</span> T1, <span style="color: #C678DD;">in</span> T2, <span style="color: #C678DD;">out</span> <span style="color: #E5C07B;">TResult</span>&gt; (<span style="color: #E5C07B;">T1</span> <span style="color: #E06C75;">arg1</span>, <span style="color: #E5C07B;">T2</span> <span style="color: #E06C75;">arg2</span>);
... and so <span style="color: #C678DD;">on</span>, up to T16
<span style="color: #C678DD;">delegate</span> <span style="color: #E5C07B;">void</span> <span style="color: #61AFEF;">Action</span> ();
<span style="color: #C678DD;">delegate</span> <span style="color: #E5C07B;">void</span> <span style="color: #61AFEF;">Action</span> &lt;<span style="color: #C678DD;">in</span> T&gt; (<span style="color: #E5C07B;">T</span> <span style="color: #E06C75;">arg</span>);
<span style="color: #C678DD;">delegate</span> <span style="color: #E5C07B;">void</span> <span style="color: #61AFEF;">Action</span> &lt;<span style="color: #C678DD;">in</span> T1, <span style="color: #C678DD;">in</span> T2&gt; (<span style="color: #E5C07B;">T1</span> <span style="color: #E06C75;">arg1</span>, <span style="color: #E5C07B;">T2</span> <span style="color: #E06C75;">arg2</span>);
... and so <span style="color: #C678DD;">on</span>, up <span style="color: #E5C07B;">to</span> <span style="color: #E06C75;">T16</span>
</pre>
</div>

<p>
Example of use:
</p>
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #C678DD;">public</span> <span style="color: #C678DD;">static</span> <span style="color: #E5C07B;">void</span> <span style="color: #61AFEF;">Transform</span>&lt;<span style="color: #E5C07B;">T</span>&gt; (<span style="color: #E5C07B;">T</span>[] <span style="color: #E06C75;">values</span>, <span style="color: #E5C07B;">Func</span>&lt;<span style="color: #E5C07B;">T</span>,<span style="color: #E5C07B;">T</span>&gt; <span style="color: #E06C75;">transformer</span>)
{
    <span style="color: #C678DD;">for</span> (<span style="color: #E5C07B;">int</span> <span style="color: #E06C75;">i</span> = 0; i &lt; values.Length; i++)
        values[i] = transformer (values[i]);
}
</pre>
</div>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">type</th>
<th scope="col" class="org-left">delegate</th>
<th scope="col" class="org-left">target method</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left"><i>contravariance</i></td>
<td class="org-left"><code>delegate void StringAction (string s);</code></td>
<td class="org-left"><code>void ActOnObject (object o) =&gt; Console.WriteLine (o);</code></td>
</tr>

<tr>
<td class="org-left"><i>covariance</i></td>
<td class="org-left"><code>delegate object ObjectRetriever();</code></td>
<td class="org-left"><code>string RetriveString() =&gt; "hello";</code></td>
</tr>
</tbody>
</table>

<ul class="org-ul">
<li>contravariance:
<ul class="org-ul">
<li><i>a delegate can have more specific parameter types than its method target</i></li>
</ul></li>
<li>covariance:
<ul class="org-ul">
<li><i>a delegate's target method might return a more specific type than described by the delegate</i></li>
</ul></li>
</ul>
</div>
</div>

<div id="outline-container-org4a8ddf1" class="outline-3">
<h3 id="org4a8ddf1"><span class="section-number-3">4.5</span> Generic delegate type parameter variance</h3>
<div class="outline-text-3" id="text-4-5">
<blockquote>
<p>
If you are defining a generic delegate type, it is good practice to do the following:
</p>
<ul class="org-ul">
<li>Mark a type parameter used only on the return value as covariant (<code>out</code>).</li>
<li>Mark any type parameters used only on parameters as contravariant (<code>in</code>).</li>
</ul>
</blockquote>

<p>
Covariant result example:
</p>
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #C678DD;">delegate</span> <span style="color: #E5C07B;">TResult</span> <span style="color: #61AFEF;">Func</span>&lt;<span style="color: #C678DD;">out</span> <span style="color: #E5C07B;">TResult</span>&gt;();

<span style="color: #5C6370; font-style: italic;">// </span><span style="color: #5C6370; font-style: italic;">Therefore....</span>
<span style="color: #E5C07B;">Func</span>&lt;<span style="color: #E5C07B;">string</span>&gt; <span style="color: #E06C75;">x</span> = ...;
<span style="color: #E5C07B;">Func</span>&lt;<span style="color: #E5C07B;">object</span>&gt; <span style="color: #E06C75;">y</span> = x;
</pre>
</div>

<p>
Contravariant parameter example:
</p>
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #C678DD;">delegate</span> <span style="color: #E5C07B;">void</span> <span style="color: #61AFEF;">Action</span>&lt;<span style="color: #C678DD;">in</span> T&gt; (<span style="color: #E5C07B;">T</span> <span style="color: #E06C75;">arg</span>);

<span style="color: #5C6370; font-style: italic;">// </span><span style="color: #5C6370; font-style: italic;">Therefore...</span>
<span style="color: #E5C07B;">Action</span>&lt;<span style="color: #E5C07B;">object</span>&gt; <span style="color: #E06C75;">x</span> = ...;
<span style="color: #E5C07B;">Action</span>&lt;<span style="color: #E5C07B;">string</span>&gt; <span style="color: #E06C75;">y</span> = x;
</pre>
</div>
</div>
</div>

<div id="outline-container-orga9880ae" class="outline-3">
<h3 id="orga9880ae"><span class="section-number-3">4.6</span> Events</h3>
<div class="outline-text-3" id="text-4-6">
<p>
.NET idiomatic events implementation example:
</p>
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #C678DD;">using</span> <span style="color: #E06C75;">System</span>;
<span style="color: #E5C07B;">Stock</span> <span style="color: #E06C75;">stock</span> = <span style="color: #C678DD;">new</span> <span style="color: #E5C07B;">Stock</span> (<span style="color: #98C379;">"THPW"</span>);
stock.Price = 27.10M;

<span style="color: #5C6370; font-style: italic;">// </span><span style="color: #5C6370; font-style: italic;">Register with the PriceChanged event</span>
stock.PriceChanged += stock_PriceChanged;
stock.Price = 31.59M;

<span style="color: #E5C07B;">void</span> <span style="color: #61AFEF;">stock_PriceChanged</span> (<span style="color: #E5C07B;">object</span> <span style="color: #E06C75;">sender</span>, <span style="color: #E5C07B;">PriceChangedEventArgs</span> <span style="color: #E06C75;">e</span>)
{
    <span style="color: #C678DD;">if</span> ((e.NewPrice - e.LastPrice) / e.LastPrice &gt; 0.1M)
        Console.WriteLine (<span style="color: #98C379;">"Alert, 10% stock price increase!"</span>);
}

<span style="color: #C678DD;">public</span> <span style="color: #C678DD;">class</span> <span style="color: #E5C07B;">PriceChangedEventArgs</span> : <span style="color: #E5C07B;">EventArgs</span>
{
    <span style="color: #C678DD;">public</span> <span style="color: #C678DD;">readonly</span> <span style="color: #E5C07B;">decimal</span> <span style="color: #E06C75;">LastPrice</span>;
    <span style="color: #C678DD;">public</span> <span style="color: #C678DD;">readonly</span> <span style="color: #E5C07B;">decimal</span> <span style="color: #E06C75;">NewPrice</span>;

    <span style="color: #C678DD;">public</span> PriceChangedEventArgs (<span style="color: #E5C07B;">decimal</span> <span style="color: #E06C75;">lastPrice</span>, <span style="color: #E5C07B;">decimal</span> <span style="color: #E06C75;">newPrice</span>)
    {
        LastPrice = lastPrice; NewPrice = newPrice;
    }
}

<span style="color: #C678DD;">public</span> <span style="color: #C678DD;">class</span> <span style="color: #E5C07B;">Stock</span>
{
    <span style="color: #E5C07B;">string</span> <span style="color: #E06C75;">symbol</span>;
    <span style="color: #E5C07B;">decimal</span> <span style="color: #E06C75;">price</span>;

    <span style="color: #C678DD;">public</span> Stock (<span style="color: #E5C07B;">string</span> <span style="color: #E06C75;">symbol</span>) =&gt; <span style="color: #C678DD;">this</span>.symbol = symbol;
    <span style="color: #C678DD;">public</span> <span style="color: #C678DD;">event</span> <span style="color: #E5C07B;">EventHandler</span>&lt;<span style="color: #E5C07B;">PriceChangedEventArgs</span>&gt; <span style="color: #E06C75;">PriceChanged</span>;

    <span style="color: #C678DD;">protected</span> <span style="color: #C678DD;">virtual</span> <span style="color: #E5C07B;">void</span> <span style="color: #61AFEF;">OnPriceChanged</span> (<span style="color: #E5C07B;">PriceChangedEventArgs</span> <span style="color: #E06C75;">e</span>)
    {
        PriceChanged?.Invoke (<span style="color: #C678DD;">this</span>, <span style="color: #E5C07B;">e</span>);
    }

    <span style="color: #C678DD;">public</span> <span style="color: #E5C07B;">decimal</span> <span style="color: #E06C75;">Price</span>
    {
        <span style="color: #C678DD;">get</span> =&gt; price;
        <span style="color: #C678DD;">set</span>
        {
            <span style="color: #C678DD;">if</span> (price == <span style="color: #56B6C2;">value</span>) <span style="color: #C678DD;">return</span>;
            <span style="color: #E5C07B;">decimal</span> <span style="color: #E06C75;">oldPrice</span> = price;
            price = <span style="color: #56B6C2;">value</span>;
            OnPriceChanged (<span style="color: #C678DD;">new</span> <span style="color: #E5C07B;">PriceChangedEventArgs</span> (<span style="color: #E5C07B;">oldPrice</span>, <span style="color: #E5C07B;">price</span>));
        }
    }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org4035ac2" class="outline-3">
<h3 id="org4035ac2"><span class="section-number-3">4.7</span> Lambda expressions</h3>
<div class="outline-text-3" id="text-4-7">
<blockquote>
<p>
A <b>lambda expression</b> is an unnamed method written in place of a delegate
instance.
</p>
</blockquote>

<p>
Example:
</p>
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #E5C07B;">Transformer</span> <span style="color: #E06C75;">sqr</span> = x =&gt; x * x;
Console.WriteLine (<span style="color: #61AFEF;">sqr</span>(3)); <span style="color: #5C6370; font-style: italic;">// </span><span style="color: #5C6370; font-style: italic;">9</span>

<span style="color: #C678DD;">delegate</span> <span style="color: #E5C07B;">int</span> <span style="color: #61AFEF;">Transformer</span> (<span style="color: #E5C07B;">int</span> <span style="color: #E06C75;">i</span>);
</pre>
</div>

<p>
Common use example:
</p>
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #E5C07B;">Func</span>&lt;<span style="color: #E5C07B;">string</span>,<span style="color: #E5C07B;">string</span>,<span style="color: #E5C07B;">int</span>&gt; <span style="color: #E06C75;">totalLength</span> = (s1, s2) =&gt; s1.Length + s2.Length;
<span style="color: #E5C07B;">int</span> <span style="color: #E06C75;">total</span> = totalLength (<span style="color: #98C379;">"hello"</span>, <span style="color: #98C379;">"world"</span>); <span style="color: #5C6370; font-style: italic;">// </span><span style="color: #5C6370; font-style: italic;">total is 10;</span>
</pre>
</div>

<p>
C#10, lambda can have return type specification:
</p>
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #E5C07B;">var</span> <span style="color: #E06C75;">sqr</span> = <span style="color: #E5C07B;">int</span> (<span style="color: #E5C07B;">int</span> <span style="color: #E06C75;">x</span>) =&gt; x * x;
</pre>
</div>
</div>
</div>

<div id="outline-container-org9c1a045" class="outline-3">
<h3 id="org9c1a045"><span class="section-number-3">4.8</span> Capture outer variables</h3>
<div class="outline-text-3" id="text-4-8">
<blockquote>
<p>
Outer variables referenced by a lambda expression are called <b>captured</b> variables. A
lambda expression that captures variables is called a <b>closure</b>.
</p>
</blockquote>

<blockquote>
<p>
Captured variables are evaluated when the delegate is actually <b>invoked</b>, not when the
variables were captured:
</p>
</blockquote>

<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #E5C07B;">int</span> <span style="color: #E06C75;">factor</span> = 2;
<span style="color: #E5C07B;">Func</span>&lt;<span style="color: #E5C07B;">int</span>, <span style="color: #E5C07B;">int</span>&gt; <span style="color: #E06C75;">multiplier</span> = n =&gt; n * factor;
factor = 10;
Console.WriteLine (multiplier (3)); <span style="color: #5C6370; font-style: italic;">// </span><span style="color: #5C6370; font-style: italic;">30</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org68ba046" class="outline-3">
<h3 id="org68ba046"><span class="section-number-3">4.9</span> <code>try</code> statements and exceptions</h3>
<div class="outline-text-3" id="text-4-9">
<p>
Structure:
</p>
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #C678DD;">try</span>
{
    <span style="color: #5C6370; font-style: italic;">// </span><span style="color: #5C6370; font-style: italic;">exception may get thrown within execution of this block</span>
}
<span style="color: #C678DD;">catch</span> (<span style="color: #E5C07B;">ExceptionA</span> <span style="color: #E06C75;">ex</span>)
{
    <span style="color: #5C6370; font-style: italic;">// </span><span style="color: #5C6370; font-style: italic;">handle exception of type ExceptionA</span>
}
<span style="color: #C678DD;">catch</span> (<span style="color: #E5C07B;">ExceptionB</span> <span style="color: #E06C75;">ex</span>)
{
    <span style="color: #5C6370; font-style: italic;">// </span><span style="color: #5C6370; font-style: italic;">handle exception of type ExceptionB</span>
}
<span style="color: #C678DD;">finally</span>
{
    <span style="color: #5C6370; font-style: italic;">// </span><span style="color: #5C6370; font-style: italic;">clean up code</span>
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org9722cd2" class="outline-3">
<h3 id="org9722cd2"><span class="section-number-3">4.10</span> Exception filters</h3>
<div class="outline-text-3" id="text-4-10">
<p>
Example:
</p>
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #C678DD;">catch</span> (<span style="color: #E5C07B;">WebException</span> <span style="color: #E06C75;">ex</span>) <span style="color: #C678DD;">when</span> (ex.Status == WebExceptionStatus.Timeout)
{
    <span style="color: #5C6370; font-style: italic;">// </span><span style="color: #5C6370; font-style: italic;">excpetion handling code</span>
}
<span style="color: #C678DD;">catch</span> (<span style="color: #E5C07B;">WebException</span> <span style="color: #E06C75;">ex</span>) <span style="color: #C678DD;">when</span> (ex.Status == WebExceptionStatus.SendFailure)
{
    <span style="color: #5C6370; font-style: italic;">// </span><span style="color: #5C6370; font-style: italic;">excpetion handling code</span>
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org83bf4a7" class="outline-3">
<h3 id="org83bf4a7"><span class="section-number-3">4.11</span> <code>finally</code> block</h3>
<div class="outline-text-3" id="text-4-11">
<p>
Example:
</p>
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #E5C07B;">void</span> <span style="color: #61AFEF;">ReadFile</span>()
{
    <span style="color: #E5C07B;">StreamReader</span> <span style="color: #E06C75;">reader</span> = <span style="color: #56B6C2;">null</span>; <span style="color: #5C6370; font-style: italic;">// </span><span style="color: #5C6370; font-style: italic;">In System.IO namespace</span>
    <span style="color: #C678DD;">try</span>
    {
        reader = File.OpenText (<span style="color: #98C379;">"file.txt"</span>);
        <span style="color: #C678DD;">if</span> (reader.EndOfStream) <span style="color: #C678DD;">return</span>;
        Console.WriteLine (reader.<span style="color: #61AFEF;">ReadToEnd</span>());
    }
    <span style="color: #C678DD;">finally</span>
    {
        <span style="color: #C678DD;">if</span> (reader != <span style="color: #56B6C2;">null</span>) reader.<span style="color: #61AFEF;">Dispose</span>();
    }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org8baf9d4" class="outline-3">
<h3 id="org8baf9d4"><span class="section-number-3">4.12</span> <code>using</code> block</h3>
<div class="outline-text-3" id="text-4-12">
<p>
This:
</p>
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #C678DD;">using</span> (<span style="color: #E5C07B;">StreamReader</span> <span style="color: #E06C75;">reader</span> = File.OpenText (<span style="color: #98C379;">"file.txt"</span>))
{
    <span style="color: #5C6370; font-style: italic;">// </span><span style="color: #5C6370; font-style: italic;">...</span>
}
</pre>
</div>

<p>
Is equivalent to this:
</p>
<div class="org-src-container">
<pre class="src src-csharp">{
    <span style="color: #E5C07B;">StreamReader</span> <span style="color: #E06C75;">reader</span> = File.OpenText (<span style="color: #98C379;">"file.txt"</span>);
    <span style="color: #C678DD;">try</span>
    {
        <span style="color: #5C6370; font-style: italic;">// </span><span style="color: #5C6370; font-style: italic;">...</span>
    }
    <span style="color: #C678DD;">finally</span>
    {
        <span style="color: #C678DD;">if</span> (reader != <span style="color: #56B6C2;">null</span>)
            ((<span style="color: #E5C07B;">IDisposable</span>)reader).<span style="color: #61AFEF;">Dispose</span>();
    }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org67e4577" class="outline-3">
<h3 id="org67e4577"><span class="section-number-3">4.13</span> <code>using</code> declaration</h3>
<div class="outline-text-3" id="text-4-13">
<blockquote>
<p>
If you omit the brackets and statement block following a using statement (C# 8+),
it becomes a using declaration. The resource is then disposed when execution falls
outside the enclosing statement block:
</p>
</blockquote>

<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #C678DD;">if</span> (File.Exists (<span style="color: #98C379;">"file.txt"</span>))
{
    <span style="color: #C678DD;">using</span> <span style="color: #E5C07B;">var</span> reader = File.OpenText (<span style="color: #98C379;">"file.txt"</span>);
    Console.WriteLine (reader.<span style="color: #61AFEF;">ReadLine</span>());
    <span style="color: #5C6370; font-style: italic;">// </span><span style="color: #5C6370; font-style: italic;">...</span>
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orge0c49e0" class="outline-3">
<h3 id="orge0c49e0"><span class="section-number-3">4.14</span> Enumeration and iterators</h3>
<div class="outline-text-3" id="text-4-14">
<p>
This:
</p>
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #C678DD;">foreach</span> (<span style="color: #E5C07B;">char</span> <span style="color: #E06C75;">c</span> <span style="color: #C678DD;">in</span> <span style="color: #98C379;">"beer"</span>)
    Console.WriteLine (c);
</pre>
</div>

<p>
Is equivalent to this:
</p>
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #C678DD;">using</span> (<span style="color: #E5C07B;">var</span> <span style="color: #E06C75;">enumerator</span> = <span style="color: #98C379;">"beer"</span>.<span style="color: #61AFEF;">GetEnumerator</span>())
<span style="color: #C678DD;">while</span> (enumerator.<span style="color: #61AFEF;">MoveNext</span>())
{
    <span style="color: #E5C07B;">var</span> <span style="color: #E06C75;">element</span> = enumerator.Current;
    Console.WriteLine (element);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org0ac35a9" class="outline-3">
<h3 id="org0ac35a9"><span class="section-number-3">4.15</span> Collection initializers</h3>
<div class="outline-text-3" id="text-4-15">
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #E5C07B;">List</span>&lt;<span style="color: #E5C07B;">int</span>&gt; <span style="color: #E06C75;">list</span> = <span style="color: #C678DD;">new</span> <span style="color: #E5C07B;">List</span>&lt;<span style="color: #E5C07B;">int</span>&gt; {1, 2, 3};

<span style="color: #E5C07B;">var</span> <span style="color: #E06C75;">dict</span> = <span style="color: #C678DD;">new</span> <span style="color: #E5C07B;">Dictionary</span>&lt;<span style="color: #E5C07B;">int</span>, <span style="color: #E5C07B;">string</span>&gt;()
{
    [3] = <span style="color: #98C379;">"three"</span>,
    [10] = <span style="color: #98C379;">"ten"</span>
};
</pre>
</div>
</div>
</div>

<div id="outline-container-org78278a2" class="outline-3">
<h3 id="org78278a2"><span class="section-number-3">4.16</span> Iterators</h3>
<div class="outline-text-3" id="text-4-16">
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #C678DD;">using</span> <span style="color: #E06C75;">System</span>;
<span style="color: #C678DD;">using</span> <span style="color: #E06C75;">System</span>.<span style="color: #E06C75;">Collections</span>.<span style="color: #E06C75;">Generic</span>;
<span style="color: #C678DD;">foreach</span> (<span style="color: #E5C07B;">int</span> <span style="color: #61AFEF;">fib</span> <span style="color: #C678DD;">in</span> <span style="color: #61AFEF;">Fibs</span>(6))
    Console.Write (fib + <span style="color: #98C379;">" "</span>); <span style="color: #5C6370; font-style: italic;">// </span><span style="color: #5C6370; font-style: italic;">1 1 2 3 5 8</span>
}

<span style="color: #E5C07B;">IEnumerable</span>&lt;<span style="color: #E5C07B;">int</span>&gt; <span style="color: #61AFEF;">Fibs</span> (<span style="color: #E5C07B;">int</span> <span style="color: #E06C75;">fibCount</span>)
{
    <span style="color: #C678DD;">for</span> (<span style="color: #E5C07B;">int</span> <span style="color: #E06C75;">i</span> = 0, <span style="color: #E06C75;">prevFib</span> = 1, <span style="color: #E06C75;">curFib</span> = 1; i &lt; fibCount; i++)
    {
        <span style="color: #C678DD;">yield</span> <span style="color: #C678DD;">return</span> prevFib;
        <span style="color: #E5C07B;">int</span> <span style="color: #E06C75;">newFib</span> = prevFib+curFib;
        prevFib = curFib;
        curFib = newFib;
    }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgfcc053b" class="outline-3">
<h3 id="orgfcc053b"><span class="section-number-3">4.17</span> Nullable Value Types</h3>
<div class="outline-text-3" id="text-4-17">
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #E5C07B;">int</span>? <span style="color: #E06C75;">i</span> = <span style="color: #56B6C2;">null</span>; <span style="color: #5C6370; font-style: italic;">// </span><span style="color: #5C6370; font-style: italic;">OK, Nullable Type</span>
Console.WriteLine (i == <span style="color: #56B6C2;">null</span>); <span style="color: #5C6370; font-style: italic;">// </span><span style="color: #5C6370; font-style: italic;">True</span>
</pre>
</div>

<p>
This is compiled into:
</p>
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #E5C07B;">Nullable</span>&lt;<span style="color: #E5C07B;">int</span>&gt; <span style="color: #E06C75;">i</span> = <span style="color: #C678DD;">new</span> <span style="color: #E5C07B;">Nullable</span>&lt;<span style="color: #E5C07B;">int</span>&gt;();
Console.WriteLine (<span style="color: #56B6C2; font-weight: bold;">!</span> i.HasValue); <span style="color: #5C6370; font-style: italic;">// </span><span style="color: #5C6370; font-style: italic;">True</span>

<span style="color: #C678DD;">public</span> <span style="color: #C678DD;">struct</span> <span style="color: #E5C07B;">Nullable</span>&lt;<span style="color: #E5C07B;">T</span>&gt; <span style="color: #C678DD;">where</span> T : <span style="color: #C678DD;">struct</span>
{
    <span style="color: #C678DD;">public</span> <span style="color: #E5C07B;">T</span> <span style="color: #E06C75;">Value</span> {<span style="color: #C678DD;">get</span>;}
    <span style="color: #C678DD;">public</span> <span style="color: #E5C07B;">bool</span> <span style="color: #E06C75;">HasValue</span> {<span style="color: #C678DD;">get</span>;}
    <span style="color: #C678DD;">public</span> <span style="color: #E5C07B;">T</span> <span style="color: #61AFEF;">GetValueOrDefault</span>();
    <span style="color: #C678DD;">public</span> <span style="color: #E5C07B;">T</span> <span style="color: #61AFEF;">GetValueOrDefault</span> (<span style="color: #E5C07B;">T</span> <span style="color: #E06C75;">defaultValue</span>);
    <span style="color: #5C6370; font-style: italic;">// </span><span style="color: #5C6370; font-style: italic;">...</span>
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org7939bcd" class="outline-3">
<h3 id="org7939bcd"><span class="section-number-3">4.18</span> bool? with &amp; and | Operators</h3>
<div class="outline-text-3" id="text-4-18">
<blockquote>
<p>
When supplied operands of type bool?, the &amp; and | operators treat null as an
unknown value. So, null | true is true because:
</p>
<ul class="org-ul">
<li>If the unknown value is false, the result would be true.</li>
<li>If the unknown value is true, the result would be true.</li>
</ul>
<p>
Similarly, null &amp; false is false. This behavior should be familiar to SQL users.
</p>
</blockquote>

<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #E5C07B;">bool</span>? <span style="color: #E06C75;">n</span> = <span style="color: #56B6C2;">null</span>;
<span style="color: #E5C07B;">bool</span>? <span style="color: #E06C75;">f</span> = <span style="color: #56B6C2;">false</span>;
<span style="color: #E5C07B;">bool</span>? <span style="color: #E06C75;">t</span> = <span style="color: #56B6C2;">true</span>;
Console.WriteLine (n | n); <span style="color: #5C6370; font-style: italic;">// </span><span style="color: #5C6370; font-style: italic;">(null)</span>
Console.WriteLine (n | f); <span style="color: #5C6370; font-style: italic;">// </span><span style="color: #5C6370; font-style: italic;">(null)</span>
Console.WriteLine (n | t); <span style="color: #5C6370; font-style: italic;">// </span><span style="color: #5C6370; font-style: italic;">True</span>
Console.WriteLine (n &amp; n); <span style="color: #5C6370; font-style: italic;">// </span><span style="color: #5C6370; font-style: italic;">(null)</span>
Console.WriteLine (n &amp; f); <span style="color: #5C6370; font-style: italic;">// </span><span style="color: #5C6370; font-style: italic;">False</span>
Console.WriteLine (n &amp; t); <span style="color: #5C6370; font-style: italic;">// </span><span style="color: #5C6370; font-style: italic;">(null)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org68ba718" class="outline-3">
<h3 id="org68ba718"><span class="section-number-3">4.19</span> Nullable reference types</h3>
<div class="outline-text-3" id="text-4-19">
<blockquote>
<p>

</p>

<p>
To enable nullable reference types, you must either add the Nullable element to
your .csproj project file (if you want to enable it for the entire project):
</p>

<p>
&lt;PropertyGroup&gt;
&lt;Nullable&gt;enable&lt;/Nullable&gt;
&lt;/PropertyGroup&gt;
</p>

<p>
or/and use the following directives in your code, in the places where it should take
effect:
</p>

<p>
#nullable enable <i>/ enables nullable reference types from this point on
#nullable disable /</i> disables nullable reference types from this point on
#nullable restore // resets nullable reference types to project setting
</p>
</blockquote>

<p>
Example:
</p>
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #828997;">#nullable</span> enable <span style="color: #5C6370; font-style: italic;">// </span><span style="color: #5C6370; font-style: italic;">Enable nullable reference types</span>
<span style="color: #E5C07B;">string</span> <span style="color: #E06C75;">s1</span> = <span style="color: #56B6C2;">null</span>; <span style="color: #5C6370; font-style: italic;">// </span><span style="color: #5C6370; font-style: italic;">Generates a compiler warning!</span>
<span style="color: #E5C07B;">string</span>? <span style="color: #E06C75;">s2</span> = <span style="color: #56B6C2;">null</span>; <span style="color: #5C6370; font-style: italic;">// </span><span style="color: #5C6370; font-style: italic;">OK: s2 is nullable reference type</span>
</pre>
</div>

<blockquote>
<p>
Because nullable reference types are compile-time constructs,
there's no runtime difference between string and string?.
In contrast, nullable value types introduce something concrete
into the type system, namely the Nullable&lt;T&gt; struct.
</p>
</blockquote>
</div>
</div>

<div id="outline-container-org5469dd0" class="outline-3">
<h3 id="org5469dd0"><span class="section-number-3">4.20</span> Extension methods</h3>
<div class="outline-text-3" id="text-4-20">
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #C678DD;">public</span> <span style="color: #C678DD;">static</span> <span style="color: #C678DD;">class</span> <span style="color: #E5C07B;">StringHelper</span>
{
    <span style="color: #C678DD;">public</span> <span style="color: #C678DD;">static</span> <span style="color: #E5C07B;">bool</span> <span style="color: #61AFEF;">IsCapitalized</span> (<span style="color: #C678DD;">this</span> <span style="color: #E5C07B;">string</span> <span style="color: #E06C75;">s</span>)
    {
        <span style="color: #C678DD;">if</span> (<span style="color: #E5C07B;">string</span>.<span style="color: #61AFEF;">IsNullOrEmpty</span>(<span style="color: #E5C07B;">s</span>)) <span style="color: #C678DD;">return</span> <span style="color: #56B6C2;">false</span>;
        <span style="color: #C678DD;">return</span> <span style="color: #E5C07B;">char</span>.IsUpper (<span style="color: #E5C07B;">s</span>[0]);
    }
}

Console.<span style="color: #61AFEF;">WriteLine</span> (<span style="color: #98C379;">"Perth"</span>.<span style="color: #61AFEF;">IsCapitalized</span>());
</pre>
</div>

<p>
Chaining Extension Methods example:
</p>

<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #C678DD;">public</span> <span style="color: #C678DD;">static</span> <span style="color: #C678DD;">class</span> <span style="color: #E5C07B;">StringHelper</span>
{
    <span style="color: #C678DD;">public</span> <span style="color: #C678DD;">static</span> <span style="color: #E5C07B;">string</span> <span style="color: #61AFEF;">Pluralize</span> (<span style="color: #C678DD;">this</span> <span style="color: #E5C07B;">string</span> <span style="color: #E06C75;">s</span>)
    {
        <span style="color: #5C6370; font-style: italic;">//</span><span style="color: #5C6370; font-style: italic;">...</span>
    }
    <span style="color: #C678DD;">public</span> <span style="color: #C678DD;">static</span> <span style="color: #E5C07B;">string</span> <span style="color: #61AFEF;">Capitalize</span> (<span style="color: #C678DD;">this</span> <span style="color: #E5C07B;">string</span> <span style="color: #E06C75;">s</span>) {
        <span style="color: #5C6370; font-style: italic;">//</span><span style="color: #5C6370; font-style: italic;">...</span>
    }
}

<span style="color: #E5C07B;">string</span> <span style="color: #E06C75;">x</span> = <span style="color: #98C379;">"sausage"</span>.<span style="color: #61AFEF;">Pluralize</span>().<span style="color: #61AFEF;">Capitalize</span>();
<span style="color: #E5C07B;">string</span> <span style="color: #E06C75;">y</span> = StringHelper.Capitalize (StringHelper.Pluralize (<span style="color: #98C379;">"sausage"</span>));
</pre>
</div>
</div>
</div>

<div id="outline-container-org5006da7" class="outline-3">
<h3 id="org5006da7"><span class="section-number-3">4.21</span> Anonymous Types</h3>
<div class="outline-text-3" id="text-4-21">
<blockquote>
<p>
An anonymous type is a simple class created by the compiler on the fly to store a set
of values.
</p>
</blockquote>

<p>
Example:
</p>
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #E5C07B;">var</span> <span style="color: #E06C75;">dudes</span> = <span style="color: #C678DD;">new</span>[]
{
    <span style="color: #C678DD;">new</span> { <span style="color: #E06C75;">Name</span> = <span style="color: #98C379;">"Bob"</span>, <span style="color: #E06C75;">Age</span> = 30 },
    <span style="color: #C678DD;">new</span> { <span style="color: #E06C75;">Name</span> = <span style="color: #98C379;">"Tom"</span>, <span style="color: #E06C75;">Age</span> = 40 }
};
</pre>
</div>

<blockquote>
<p>
Anonymous types are immutable, so instances cannot be modified after creation.
However, from C# 10, you can use the with keyword to create a copy with variations
(nondestructive mutation):
</p>
</blockquote>

<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #E5C07B;">var</span> <span style="color: #E06C75;">a1</span> = <span style="color: #C678DD;">new</span> { <span style="color: #E06C75;">A</span> = 1, <span style="color: #E06C75;">B</span> = 2, <span style="color: #E06C75;">C</span> = 3, <span style="color: #E06C75;">D</span> = 4, <span style="color: #E06C75;">E</span> = 5 };
<span style="color: #E5C07B;">var</span> <span style="color: #E06C75;">a2</span> = a1 with { E = 10 };
Console.WriteLine (a2); <span style="color: #5C6370; font-style: italic;">// </span><span style="color: #5C6370; font-style: italic;">{ A = 1, B = 2, C = 3, D = 4, E = 10 }</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org75c63b3" class="outline-3">
<h3 id="org75c63b3"><span class="section-number-3">4.22</span> Tuples</h3>
<div class="outline-text-3" id="text-4-22">
<p>
Examples:
</p>
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #E5C07B;">var</span> <span style="color: #E06C75;">bob</span> = (<span style="color: #98C379;">"Bob"</span>, 23); <span style="color: #5C6370; font-style: italic;">// </span><span style="color: #5C6370; font-style: italic;">Allow compiler to infer the element types</span>
Console.WriteLine (bob.Item1); <span style="color: #5C6370; font-style: italic;">// </span><span style="color: #5C6370; font-style: italic;">Bob</span>
Console.WriteLine (bob.Item2); <span style="color: #5C6370; font-style: italic;">// </span><span style="color: #5C6370; font-style: italic;">23</span>

(<span style="color: #E5C07B;">string</span>,<span style="color: #E5C07B;">int</span>) <span style="color: #61AFEF;">GetPerson</span>() =&gt; (<span style="color: #98C379;">"Bob"</span>, 23);
</pre>
</div>

<p>
With naming:
</p>
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #E5C07B;">var</span> <span style="color: #E06C75;">tuple</span> = (name:<span style="color: #98C379;">"Bob"</span>, age:23);
Console.WriteLine (tuple.name); <span style="color: #5C6370; font-style: italic;">// </span><span style="color: #5C6370; font-style: italic;">Bob</span>
Console.WriteLine (tuple.age); <span style="color: #5C6370; font-style: italic;">// </span><span style="color: #5C6370; font-style: italic;">23</span>

<span style="color: #E5C07B;">var</span> <span style="color: #E06C75;">person</span> = <span style="color: #61AFEF;">GetPerson</span>();
Console.WriteLine (person.name); <span style="color: #5C6370; font-style: italic;">// </span><span style="color: #5C6370; font-style: italic;">Bob</span>
Console.WriteLine (person.age); <span style="color: #5C6370; font-style: italic;">// </span><span style="color: #5C6370; font-style: italic;">23</span>
(<span style="color: #E5C07B;">string</span> <span style="color: #E06C75;">name</span>, <span style="color: #E5C07B;">int</span> <span style="color: #E06C75;">age</span>) <span style="color: #61AFEF;">GetPerson</span>() =&gt; (<span style="color: #98C379;">"Bob"</span>, 23);
</pre>
</div>

<p>
Deconstructing:
</p>
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #E5C07B;">var</span> <span style="color: #E06C75;">bob</span> = (<span style="color: #98C379;">"Bob"</span>, 23);
(<span style="color: #E5C07B;">string</span> <span style="color: #E06C75;">name</span>, <span style="color: #E5C07B;">int</span> <span style="color: #E06C75;">age</span>) = bob; <span style="color: #5C6370; font-style: italic;">// </span><span style="color: #5C6370; font-style: italic;">Deconstruct the bob tuple into</span>

<span style="color: #5C6370; font-style: italic;">// </span><span style="color: #5C6370; font-style: italic;">separate variables (name and age).</span>
Console.WriteLine (name);
Console.WriteLine (age);
</pre>
</div>

<p>
Withg type inference:
</p>
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #E5C07B;">var</span> (<span style="color: #E5C07B;">name</span>, <span style="color: #E5C07B;">age</span>, <span style="color: #E5C07B;">sex</span>) = <span style="color: #61AFEF;">GetBob</span>();
Console.WriteLine (name); <span style="color: #5C6370; font-style: italic;">// </span><span style="color: #5C6370; font-style: italic;">Bob</span>
Console.WriteLine (age); <span style="color: #5C6370; font-style: italic;">// </span><span style="color: #5C6370; font-style: italic;">23</span>
Console.WriteLine (sex); <span style="color: #5C6370; font-style: italic;">// </span><span style="color: #5C6370; font-style: italic;">M</span>
</pre>
</div>


<p>
Use in a constructor:
</p>
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #C678DD;">class</span> <span style="color: #E5C07B;">Point</span>
{
    <span style="color: #C678DD;">public</span> <span style="color: #C678DD;">readonly</span> <span style="color: #E5C07B;">int</span> <span style="color: #E06C75;">X</span>, <span style="color: #E06C75;">Y</span>;
    <span style="color: #C678DD;">public</span> Point (<span style="color: #E5C07B;">int</span> <span style="color: #E06C75;">x</span>, <span style="color: #E5C07B;">int</span> <span style="color: #E06C75;">y</span>) =&gt; (<span style="color: #E5C07B;">X</span>, <span style="color: #E5C07B;">Y</span>) = (<span style="color: #E5C07B;">x</span>, <span style="color: #E5C07B;">y</span>);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgd18e2e2" class="outline-3">
<h3 id="orgd18e2e2"><span class="section-number-3">4.23</span> Records</h3>
<div class="outline-text-3" id="text-4-23">
<blockquote>
<p>
A record is a special kind of class or struct that is designed to work well with immutable
(read-only) data. Its most useful feature is <b>nondestructive mutation</b>; however,
records are also useful in creating types that just combine or hold data.
</p>
</blockquote>

<p>
Obvi! but still cool:
</p>
<blockquote>
<p>
(a deep copy, where you also copy subobjects and
collections, is unnecessary when data is immutable)
</p>
</blockquote>

<p>
Definition example:
</p>
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #E5C07B;">record</span> <span style="color: #E06C75;">Point</span>
{
    <span style="color: #C678DD;">public</span> Point (<span style="color: #E5C07B;">double</span> <span style="color: #E06C75;">x</span>, <span style="color: #E5C07B;">double</span> <span style="color: #E06C75;">y</span>) =&gt; (X, Y) = (x, y);
    <span style="color: #C678DD;">public</span> <span style="color: #E5C07B;">double</span> <span style="color: #E06C75;">X</span> { <span style="color: #C678DD;">get</span>; init; }
    <span style="color: #C678DD;">public</span> <span style="color: #E5C07B;">double</span> <span style="color: #E06C75;">Y</span> { <span style="color: #C678DD;">get</span>; init; }
}
</pre>
</div>

<p>
Defintion with a <i>parameter</i> list:
</p>
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #E5C07B;">record</span> <span style="color: #61AFEF;">Point</span> (<span style="color: #E5C07B;">double</span> <span style="color: #E06C75;">X</span>, <span style="color: #E5C07B;">double</span> <span style="color: #E06C75;">Y</span>);
</pre>
</div>
</div>
</div>

<div id="outline-container-orgb7d6fe5" class="outline-3">
<h3 id="orgb7d6fe5"><span class="section-number-3">4.24</span> Records non-distructive mutation</h3>
<div class="outline-text-3" id="text-4-24">
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #E5C07B;">Point</span> <span style="color: #E06C75;">p1</span> = <span style="color: #C678DD;">new</span> <span style="color: #E5C07B;">Point</span> (3, 3);
<span style="color: #E5C07B;">Point</span> <span style="color: #E06C75;">p2</span> = p1 with { Y = 4 };
Console.WriteLine (p2); <span style="color: #5C6370; font-style: italic;">// </span><span style="color: #5C6370; font-style: italic;">Point { X = 3, Y = 4 }</span>

<span style="color: #E5C07B;">record</span> <span style="color: #61AFEF;">Point</span> (<span style="color: #E5C07B;">double</span> <span style="color: #E06C75;">X</span>, <span style="color: #E5C07B;">double</span> <span style="color: #E06C75;">Y</span>);
</pre>
</div>
</div>
</div>

<div id="outline-container-orgb63e485" class="outline-3">
<h3 id="orgb63e485"><span class="section-number-3">4.25</span> Patterns</h3>
<div class="outline-text-3" id="text-4-25">
<p>
Relational pattarns:
</p>
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #E5C07B;">string</span> <span style="color: #61AFEF;">GetWeightCategory</span> (<span style="color: #E5C07B;">decimal</span> <span style="color: #E06C75;">bmi</span>) =&gt; bmi <span style="color: #C678DD;">switch</span>
{
    &lt; 18.5m =&gt; <span style="color: #98C379;">"underweight"</span>,
    &lt; 25m =&gt; <span style="color: #98C379;">"normal"</span>,
    &lt; 30m =&gt; <span style="color: #98C379;">"overweight"</span>,
    _ =&gt; <span style="color: #98C379;">"obese"</span>
};
</pre>
</div>

<p>
Tuple positional patterns:
</p>
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #E5C07B;">int</span> <span style="color: #61AFEF;">AverageCelsiusTemperature</span> (<span style="color: #E5C07B;">Season</span> <span style="color: #E06C75;">season</span>, <span style="color: #E5C07B;">bool</span> <span style="color: #E06C75;">daytime</span>) =&gt;
    (season, daytime) <span style="color: #C678DD;">switch</span>
{
    (Season.Spring, <span style="color: #56B6C2;">true</span>) =&gt; 20,
    (Season.Spring, <span style="color: #56B6C2;">false</span>) =&gt; 16,
    (Season.Summer, <span style="color: #56B6C2;">true</span>) =&gt; 27,
    (Season.Summer, <span style="color: #56B6C2;">false</span>) =&gt; 22,
    (Season.Fall, <span style="color: #56B6C2;">true</span>) =&gt; 18,
    (Season.Fall, <span style="color: #56B6C2;">false</span>) =&gt; 12,
    (Season.Winter, <span style="color: #56B6C2;">true</span>) =&gt; 10,
    (Season.Winter, <span style="color: #56B6C2;">false</span>) =&gt; -2,
    _ =&gt; <span style="color: #C678DD;">throw</span> <span style="color: #C678DD;">new</span> <span style="color: #E5C07B;">Exception</span> (<span style="color: #98C379;">"Unexpected combination"</span>)
};

<span style="color: #C678DD;">enum</span> <span style="color: #E5C07B;">Season</span> { <span style="color: #E06C75;">Spring</span>, <span style="color: #E06C75;">Summer</span>, <span style="color: #E06C75;">Fall</span>, <span style="color: #E06C75;">Winter</span> };
</pre>
</div>

<p>
Property patterns:
</p>
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #E5C07B;">bool</span> <span style="color: #61AFEF;">ShouldAllow</span> (<span style="color: #E5C07B;">Uri</span> <span style="color: #E06C75;">uri</span>) =&gt; uri <span style="color: #C678DD;">switch</span>
{
    { Scheme: <span style="color: #98C379;">"http"</span>, Port: 80 } =&gt; <span style="color: #56B6C2;">true</span>,
    { Scheme: <span style="color: #98C379;">"https"</span>, Port: 443 } =&gt; <span style="color: #56B6C2;">true</span>,
    { Scheme: <span style="color: #98C379;">"ftp"</span>, Port: 21 } =&gt; <span style="color: #56B6C2;">true</span>,
    { IsLoopback: <span style="color: #56B6C2;">true</span> } =&gt; <span style="color: #56B6C2;">true</span>,
    _ =&gt; <span style="color: #56B6C2;">false</span>
};
</pre>
</div>

<p>
With a variable at the end of a pattern clause:
</p>
<div class="org-src-container">
<pre class="src src-csharp">Uri { <span style="color: #56B6C2;">Scheme</span>: <span style="color: #98C379;">"http"</span>, Port: 80 } httpUri
    <span style="color: #C678DD;">when</span> httpUri.Host.<span style="color: #E5C07B;">Length</span> &lt; 1000 =&gt; <span style="color: #56B6C2;">true</span>,
</pre>
</div>
</div>
</div>
</div>


<div id="outline-container-orgbdc7ff2" class="outline-2">
<h2 id="orgbdc7ff2"><span class="section-number-2">5</span> .NET Overview</h2>
<div class="outline-text-2" id="text-5">
</div>
<div id="outline-container-org7830c9a" class="outline-3">
<h3 id="org7830c9a"><span class="section-number-3">5.1</span> String and Text handling</h3>
<div class="outline-text-3" id="text-5-1">
<p>
<code>string.Format</code> example:
</p>
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #E5C07B;">string</span> <span style="color: #E06C75;">composite</span> = <span style="color: #98C379;">"It's {0} degrees in {1} on this {2} morning"</span>;
<span style="color: #E5C07B;">string</span> <span style="color: #E06C75;">s</span> = <span style="color: #E5C07B;">string</span>.Format (composite, 35, <span style="color: #98C379;">"Perth"</span>, DateTime.Now.DayOfWeek);

<span style="color: #5C6370; font-style: italic;">// </span><span style="color: #5C6370; font-style: italic;">s == "It's 35 degrees in Perth on this Friday morning"</span>
</pre>
</div>

<p>
Use of <b>interpolated</b> string literal example:
</p>
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #E5C07B;">string</span> <span style="color: #E06C75;">s</span> = $<span style="color: #98C379;">"It's hot this {DateTime.Now.DayOfWeek} morning"</span>;
</pre>
</div>

<p>
Example with left alignment:
</p>
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #E5C07B;">string</span> <span style="color: #E06C75;">composite</span> = <span style="color: #98C379;">"Name={0,-20} Credit Limit={1,15:C}"</span>;

Console.WriteLine (<span style="color: #E5C07B;">string</span>.Format (composite, <span style="color: #98C379;">"Mary"</span>, 500));
Console.WriteLine (<span style="color: #E5C07B;">string</span>.Format (composite, <span style="color: #98C379;">"Elizabeth"</span>, 20000));
</pre>
</div>

<p>
result (alignment is not rendered correctly below):
</p>
<div class="org-src-container">
<pre class="src src-csharp">Name=Mary Credit Limit= $500.00
Name=Elizabeth Credit Limit= $20,000.00
</pre>
</div>
</div>
</div>
</div>


<div id="outline-container-org3aa7185" class="outline-2">
<h2 id="org3aa7185"><span class="section-number-2">6</span> Collections</h2>
<div class="outline-text-2" id="text-6">
</div>
<div id="outline-container-orgb94dd57" class="outline-3">
<h3 id="orgb94dd57"><span class="section-number-3">6.1</span> <code>IEnumerator&lt;T&gt;</code> / <code>IEnumerable&lt;T&gt;</code></h3>
<div class="outline-text-3" id="text-6-1">
<p>
Low-level nongeneric interfaces
</p>

<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #C678DD;">public</span> <span style="color: #C678DD;">interface</span> <span style="color: #E5C07B;">IEnumerator</span>
{
    <span style="color: #E5C07B;">bool</span> <span style="color: #61AFEF;">MoveNext</span>();
    <span style="color: #E5C07B;">object</span> <span style="color: #E06C75;">Current</span> { <span style="color: #C678DD;">get</span>; }
    <span style="color: #E5C07B;">void</span> <span style="color: #61AFEF;">Reset</span>();
}
</pre>
</div>

<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #C678DD;">public</span> <span style="color: #C678DD;">interface</span> <span style="color: #E5C07B;">IEnumerable</span>
{
    <span style="color: #E5C07B;">IEnumerator</span> <span style="color: #61AFEF;">GetEnumerator</span>();
}
</pre>
</div>

<p>
Extended generic interfaces
</p>

<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #C678DD;">public</span> <span style="color: #C678DD;">interface</span> <span style="color: #E5C07B;">IEnumerator</span>&lt;<span style="color: #E5C07B;">T</span>&gt; : <span style="color: #E5C07B;">IEnumerator</span>, <span style="color: #E5C07B;">IDisposable</span>
{
    <span style="color: #E5C07B;">T</span> <span style="color: #E06C75;">Current</span> { <span style="color: #C678DD;">get</span>; }
}
</pre>
</div>

<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #C678DD;">public</span> <span style="color: #C678DD;">interface</span> <span style="color: #E5C07B;">IEnumerable</span>&lt;<span style="color: #E5C07B;">T</span>&gt; : <span style="color: #E5C07B;">IEnumerable</span>
{
    <span style="color: #E5C07B;">IEnumerator</span>&lt;<span style="color: #E5C07B;">T</span>&gt; <span style="color: #61AFEF;">GetEnumerator</span>();
}
</pre>
</div>

<p>
Since, <code>IEnumerator&lt;T&gt;</code> inherits from <code>IDisposable</code>, therefore:
</p>

<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #C678DD;">foreach</span>( <span style="color: #E5C07B;">var</span> <span style="color: #E06C75;">element</span> <span style="color: #C678DD;">in</span> somethingEnumerable) { ... }
</pre>
</div>

<p>
is translated into:
</p>

<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #C678DD;">using</span> (<span style="color: #E5C07B;">var</span> <span style="color: #E06C75;">rator</span> = somethingEnumerable.<span style="color: #61AFEF;">GetEnumerator</span>())
<span style="color: #C678DD;">while</span> (rator.<span style="color: #61AFEF;">MoveNext</span>())
{
    <span style="color: #E5C07B;">var</span> <span style="color: #E06C75;">element</span> = rator.Current;
    <span style="color: #5C6370; font-style: italic;">// </span><span style="color: #5C6370; font-style: italic;">...</span>
}
</pre>
</div>

<p>
Custom implemntation example:
</p>
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #C678DD;">public</span> <span style="color: #C678DD;">class</span> <span style="color: #E5C07B;">MyGenCollection</span> : <span style="color: #E5C07B;">IEnumerable</span>&lt;<span style="color: #E5C07B;">int</span>&gt;
{
    <span style="color: #E5C07B;">int</span>[] <span style="color: #E06C75;">data</span> = { 1, 2, 3 };
    <span style="color: #C678DD;">public</span> <span style="color: #E5C07B;">IEnumerator</span>&lt;<span style="color: #E5C07B;">int</span>&gt; <span style="color: #61AFEF;">GetEnumerator</span>()
    {
        <span style="color: #C678DD;">foreach</span> (<span style="color: #E5C07B;">int</span> <span style="color: #E06C75;">i</span> <span style="color: #C678DD;">in</span> data)
            <span style="color: #C678DD;">yield</span> <span style="color: #C678DD;">return</span> i;
    }
    <span style="color: #5C6370; font-style: italic;">// </span><span style="color: #5C6370; font-style: italic;">Explicit implementation keeps it hidden:</span>
    <span style="color: #E5C07B;">IEnumerator</span> IEnumerable.<span style="color: #61AFEF;">GetEnumerator</span>() =&gt; <span style="color: #61AFEF;">GetEnumerator</span>();
}
</pre>
</div>
<p>
<i>Note: <code>GetEnumerator</code> doesn't return <code>IEnumerator</code> directly, but generated by the compiler from <code>yield</code> statement.</i>
</p>
</div>
</div>

<div id="outline-container-org5093080" class="outline-3">
<h3 id="org5093080"><span class="section-number-3">6.2</span> <code>ICollection</code> and <code>IList</code> interfaces</h3>
<div class="outline-text-3" id="text-6-2">
<p>
Interface defintion:
</p>
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #C678DD;">public</span> <span style="color: #C678DD;">interface</span> <span style="color: #E5C07B;">ICollection</span>&lt;<span style="color: #E5C07B;">T</span>&gt; : <span style="color: #E5C07B;">IEnumerable</span>&lt;<span style="color: #E5C07B;">T</span>&gt;, <span style="color: #E5C07B;">IEnumerable</span>
{
    <span style="color: #E5C07B;">int</span> <span style="color: #E06C75;">Count</span> { <span style="color: #C678DD;">get</span>; }
    <span style="color: #E5C07B;">bool</span> <span style="color: #61AFEF;">Contains</span> (<span style="color: #E5C07B;">T</span> <span style="color: #E06C75;">item</span>);
    <span style="color: #E5C07B;">void</span> <span style="color: #61AFEF;">CopyTo</span> (<span style="color: #E5C07B;">T</span>[] <span style="color: #E06C75;">array</span>, <span style="color: #E5C07B;">int</span> <span style="color: #E06C75;">arrayIndex</span>);
    <span style="color: #E5C07B;">bool</span> <span style="color: #E06C75;">IsReadOnly</span> { <span style="color: #C678DD;">get</span>; }
    <span style="color: #E5C07B;">void</span> <span style="color: #61AFEF;">Add</span>(<span style="color: #E5C07B;">T</span> <span style="color: #E06C75;">item</span>);
    <span style="color: #E5C07B;">bool</span> <span style="color: #61AFEF;">Remove</span> (<span style="color: #E5C07B;">T</span> <span style="color: #E06C75;">item</span>);
    <span style="color: #E5C07B;">void</span> <span style="color: #61AFEF;">Clear</span>();
}
</pre>
</div>

<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #C678DD;">public</span> <span style="color: #C678DD;">interface</span> <span style="color: #E5C07B;">IList</span>&lt;<span style="color: #E5C07B;">T</span>&gt; : <span style="color: #E5C07B;">ICollection</span>&lt;<span style="color: #E5C07B;">T</span>&gt;, <span style="color: #E5C07B;">IEnumerable</span>&lt;<span style="color: #E5C07B;">T</span>&gt;, <span style="color: #E5C07B;">IEnumerable</span>
{
    <span style="color: #E5C07B;">T</span> <span style="color: #C678DD;">this</span> [<span style="color: #E5C07B;">int</span> index] { <span style="color: #C678DD;">get</span>; <span style="color: #C678DD;">set</span>; }
    <span style="color: #E5C07B;">int</span> <span style="color: #61AFEF;">IndexOf</span> (<span style="color: #E5C07B;">T</span> <span style="color: #E06C75;">item</span>);
    <span style="color: #E5C07B;">void</span> <span style="color: #61AFEF;">Insert</span> (<span style="color: #E5C07B;">int</span> <span style="color: #E06C75;">index</span>, <span style="color: #E5C07B;">T</span> <span style="color: #E06C75;">item</span>);
    <span style="color: #E5C07B;">void</span> <span style="color: #61AFEF;">RemoveAt</span> (<span style="color: #E5C07B;">int</span> <span style="color: #E06C75;">index</span>);
}<span style="color: #5C6370; font-weight: bold;">'</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgaef3931" class="outline-3">
<h3 id="orgaef3931"><span class="section-number-3">6.3</span> <code>IReadOnlyCollection&lt;T&gt;</code> / <code>IReadOnlyList&lt;T&gt;</code></h3>
<div class="outline-text-3" id="text-6-3">
<blockquote>
<p>
Because the type parameter for these interfaces is used only in output positions, it is marked as <b>covariant</b>. This allows a list of cats, for instance, to be treated as a readonly list of animals. In contrast, <code>T</code> is not marked as covariant with <code>ICollection&lt;T&gt;</code> and <code>IList&lt;T&gt;</code>, because <code>T</code> is used in both input and output positions.
</p>
</blockquote>

<p>
Defintion:
</p>
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #C678DD;">public</span> <span style="color: #C678DD;">interface</span> <span style="color: #E5C07B;">IReadOnlyCollection</span>&lt;<span style="color: #C678DD;">out</span> <span style="color: #E5C07B;">T</span>&gt; : <span style="color: #E5C07B;">IEnumerable</span>&lt;<span style="color: #E5C07B;">T</span>&gt;, <span style="color: #E5C07B;">IEnumerable</span>
{
    <span style="color: #E5C07B;">int</span> <span style="color: #E06C75;">Count</span> { <span style="color: #C678DD;">get</span>; }
}

<span style="color: #C678DD;">public</span> <span style="color: #C678DD;">interface</span> <span style="color: #E5C07B;">IReadOnlyList</span>&lt;<span style="color: #C678DD;">out</span> <span style="color: #E5C07B;">T</span>&gt; : <span style="color: #E5C07B;">IReadOnlyCollection</span>&lt;<span style="color: #E5C07B;">T</span>&gt;,
    <span style="color: #E5C07B;">IEnumerable</span>&lt;<span style="color: #E5C07B;">T</span>&gt;, <span style="color: #E5C07B;">IEnumerable</span>
{
    <span style="color: #E5C07B;">T</span> <span style="color: #C678DD;">this</span>[<span style="color: #E5C07B;">int</span> index] { <span style="color: #C678DD;">get</span>; }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org9bf03a6" class="outline-3">
<h3 id="org9bf03a6"><span class="section-number-3">6.4</span> Array Class</h3>
<div class="outline-text-3" id="text-6-4">
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #E5C07B;">int</span>[] <span style="color: #E06C75;">myArray</span> = { 1, 2, 3};
<span style="color: #C678DD;">foreach</span> (<span style="color: #E5C07B;">int</span> <span style="color: #E06C75;">val</span> <span style="color: #C678DD;">in</span> myArray)
    Console.WriteLine (val);
</pre>
</div>

<p>
Alternative enumeration method:
</p>
<div class="org-src-container">
<pre class="src src-csharp">Array.ForEach (<span style="color: #C678DD;">new</span>[] { 1, 2, 3 }, Console.<span style="color: #E5C07B;">WriteLine</span>);
</pre>
</div>

<p>
Searching:
</p>
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #E5C07B;">string</span>[] <span style="color: #E06C75;">names</span> = { <span style="color: #98C379;">"Rodney"</span>, <span style="color: #98C379;">"Jack"</span>, <span style="color: #98C379;">"Jill"</span> };
<span style="color: #E5C07B;">string</span> <span style="color: #E06C75;">match</span> = Array.Find (names, n =&gt; n.Contains (<span style="color: #98C379;">"a"</span>)); <span style="color: #5C6370; font-style: italic;">// </span><span style="color: #5C6370; font-style: italic;">Jack</span>
</pre>
</div>

<p>
Sorting:
</p>
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #E5C07B;">int</span>[] <span style="color: #E06C75;">numbers</span> = { 3, 2, 1 };
Array.Sort (numbers); <span style="color: #5C6370; font-style: italic;">// </span><span style="color: #5C6370; font-style: italic;">Array is now { 1, 2, 3 }</span>
</pre>
</div>

<p>
Sorting (as a pair):
</p>

<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #E5C07B;">int</span>[] <span style="color: #E06C75;">numbers</span> = { 3, 2, 1 };
<span style="color: #E5C07B;">string</span>[] <span style="color: #E06C75;">words</span> = { <span style="color: #98C379;">"three"</span>, <span style="color: #98C379;">"two"</span>, <span style="color: #98C379;">"one"</span> };
Array.Sort (numbers, words);

<span style="color: #5C6370; font-style: italic;">// </span><span style="color: #5C6370; font-style: italic;">numbers array is now { 1, 2, 3 }</span>
<span style="color: #5C6370; font-style: italic;">// </span><span style="color: #5C6370; font-style: italic;">words array is now { "one", "two", "three" }</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org4bbb7aa" class="outline-3">
<h3 id="org4bbb7aa"><span class="section-number-3">6.5</span> Lists, Queues, Stacks, and Sets</h3>
<div class="outline-text-3" id="text-6-5">
<blockquote>
<p>
List&lt;T&gt; is up to several times faster than ArrayList if T is
a value type, because List&lt;T&gt; avoids the overhead of boxing
and unboxing elements.
</p>
</blockquote>

<p>
Example:
</p>
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #E5C07B;">var</span> <span style="color: #E06C75;">words</span> = <span style="color: #C678DD;">new</span> <span style="color: #E5C07B;">List</span>&lt;<span style="color: #E5C07B;">string</span>&gt;(); <span style="color: #5C6370; font-style: italic;">// </span><span style="color: #5C6370; font-style: italic;">New string-typed list</span>

words.Add (<span style="color: #98C379;">"melon"</span>);
words.Add (<span style="color: #98C379;">"avocado"</span>);
words.AddRange (<span style="color: #C678DD;">new</span>[] { <span style="color: #98C379;">"banana"</span>, <span style="color: #98C379;">"plum"</span> } );

words.Insert (0, <span style="color: #98C379;">"lemon"</span>); <span style="color: #5C6370; font-style: italic;">// </span><span style="color: #5C6370; font-style: italic;">Insert at start</span>
words.InsertRange (0, <span style="color: #C678DD;">new</span>[] { <span style="color: #98C379;">"peach"</span>, <span style="color: #98C379;">"nashi"</span> }); <span style="color: #5C6370; font-style: italic;">// </span><span style="color: #5C6370; font-style: italic;">Insert at start</span>

words.Remove (<span style="color: #98C379;">"melon"</span>);
words.RemoveAt (3); <span style="color: #5C6370; font-style: italic;">// </span><span style="color: #5C6370; font-style: italic;">Remove the 4th element</span>
words.RemoveRange (0, 2); <span style="color: #5C6370; font-style: italic;">// </span><span style="color: #5C6370; font-style: italic;">Remove first 2 elements</span>

<span style="color: #5C6370; font-style: italic;">// </span><span style="color: #5C6370; font-style: italic;">Remove all strings starting in 'n':</span>
words.RemoveAll (s =&gt; s.StartsWith (<span style="color: #98C379;">"n"</span>));

Console.WriteLine (words [0]); <span style="color: #5C6370; font-style: italic;">// </span><span style="color: #5C6370; font-style: italic;">first word</span>
Console.WriteLine (words [words.Count - 1]); <span style="color: #5C6370; font-style: italic;">// </span><span style="color: #5C6370; font-style: italic;">last word</span>

<span style="color: #C678DD;">foreach</span> (<span style="color: #E5C07B;">string</span> <span style="color: #E06C75;">s</span> <span style="color: #C678DD;">in</span> words) Console.WriteLine (s); <span style="color: #5C6370; font-style: italic;">// </span><span style="color: #5C6370; font-style: italic;">all words</span>

<span style="color: #E5C07B;">List</span>&lt;<span style="color: #E5C07B;">string</span>&gt; <span style="color: #E06C75;">subset</span> = words.GetRange (1, 2); <span style="color: #5C6370; font-style: italic;">// </span><span style="color: #5C6370; font-style: italic;">2nd-&gt;3rd words</span>
<span style="color: #E5C07B;">string</span>[] <span style="color: #E06C75;">wordsArray</span> = words.<span style="color: #61AFEF;">ToArray</span>(); <span style="color: #5C6370; font-style: italic;">// </span><span style="color: #5C6370; font-style: italic;">Creates a new typed array</span>

<span style="color: #5C6370; font-style: italic;">// </span><span style="color: #5C6370; font-style: italic;">Copy first two elements to the end of an existing array:</span>
<span style="color: #E5C07B;">string</span>[] <span style="color: #E06C75;">existing</span> = <span style="color: #C678DD;">new</span> <span style="color: #E5C07B;">string</span> [1000];

words.CopyTo (0, existing, 998, 2);

<span style="color: #E5C07B;">List</span>&lt;<span style="color: #E5C07B;">string</span>&gt; <span style="color: #E06C75;">upperCaseWords</span> = words.ConvertAll (s =&gt; s.<span style="color: #61AFEF;">ToUpper</span>());
<span style="color: #E5C07B;">List</span>&lt;<span style="color: #E5C07B;">int</span>&gt; <span style="color: #E06C75;">lengths</span> = words.ConvertAll (s =&gt; s.Length);
</pre>
</div>

<p>
LinkedLis&lt;T? exmaple:
</p>
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #E5C07B;">var</span> <span style="color: #E06C75;">tune</span> = <span style="color: #C678DD;">new</span> <span style="color: #E5C07B;">LinkedList</span>&lt;<span style="color: #E5C07B;">string</span>&gt;();
tune.AddFirst (<span style="color: #98C379;">"do"</span>); <span style="color: #5C6370; font-style: italic;">// </span><span style="color: #5C6370; font-style: italic;">do</span>
tune.AddLast (<span style="color: #98C379;">"so"</span>); <span style="color: #5C6370; font-style: italic;">// </span><span style="color: #5C6370; font-style: italic;">do - so</span>
tune.AddAfter (tune.First, <span style="color: #98C379;">"re"</span>); <span style="color: #5C6370; font-style: italic;">// </span><span style="color: #5C6370; font-style: italic;">do - re- so</span>
tune.AddAfter (tune.First.Next, <span style="color: #98C379;">"mi"</span>); <span style="color: #5C6370; font-style: italic;">// </span><span style="color: #5C6370; font-style: italic;">do - re - mi- so</span>
tune.AddBefore (tune.Last, <span style="color: #98C379;">"fa"</span>); <span style="color: #5C6370; font-style: italic;">// </span><span style="color: #5C6370; font-style: italic;">do - re - mi - fa- so</span>

tune.<span style="color: #61AFEF;">RemoveFirst</span>(); <span style="color: #5C6370; font-style: italic;">// </span><span style="color: #5C6370; font-style: italic;">re - mi - fa - so</span>
tune.<span style="color: #61AFEF;">RemoveLast</span>(); <span style="color: #5C6370; font-style: italic;">// </span><span style="color: #5C6370; font-style: italic;">re - mi - fa</span>

<span style="color: #E5C07B;">LinkedListNode</span>&lt;<span style="color: #E5C07B;">string</span>&gt; <span style="color: #E06C75;">miNode</span> = tune.Find (<span style="color: #98C379;">"mi"</span>);
tune.Remove (miNode); <span style="color: #5C6370; font-style: italic;">// </span><span style="color: #5C6370; font-style: italic;">re - fa</span>
tune.AddFirst (miNode); <span style="color: #5C6370; font-style: italic;">// </span><span style="color: #5C6370; font-style: italic;">mi- re - fa</span>

<span style="color: #C678DD;">foreach</span> (<span style="color: #E5C07B;">string</span> <span style="color: #E06C75;">s</span> <span style="color: #C678DD;">in</span> tune) Console.WriteLine (s);
</pre>
</div>

<p>
Queue&lt;T&gt; example:
</p>
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #E5C07B;">var</span> <span style="color: #E06C75;">q</span> = <span style="color: #C678DD;">new</span> <span style="color: #E5C07B;">Queue</span>&lt;<span style="color: #E5C07B;">int</span>&gt;();
q.Enqueue (10);
q.Enqueue (20);

<span style="color: #E5C07B;">int</span>[] <span style="color: #E06C75;">data</span> = q.<span style="color: #61AFEF;">ToArray</span>(); <span style="color: #5C6370; font-style: italic;">// </span><span style="color: #5C6370; font-style: italic;">Exports to an array</span>

Console.WriteLine (q.Count); <span style="color: #5C6370; font-style: italic;">// </span><span style="color: #5C6370; font-style: italic;">"2"</span>
Console.WriteLine (q.<span style="color: #61AFEF;">Peek</span>()); <span style="color: #5C6370; font-style: italic;">// </span><span style="color: #5C6370; font-style: italic;">"10"</span>
Console.WriteLine (q.<span style="color: #61AFEF;">Dequeue</span>()); <span style="color: #5C6370; font-style: italic;">// </span><span style="color: #5C6370; font-style: italic;">"10"</span>
Console.WriteLine (q.<span style="color: #61AFEF;">Dequeue</span>()); <span style="color: #5C6370; font-style: italic;">// </span><span style="color: #5C6370; font-style: italic;">"20"</span>
Console.WriteLine (q.<span style="color: #61AFEF;">Dequeue</span>()); <span style="color: #5C6370; font-style: italic;">// </span><span style="color: #5C6370; font-style: italic;">throws an exception (queue empty)</span>
</pre>
</div>

<p>
Stack&lt;T&gt; example:
</p>
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #E5C07B;">var</span> <span style="color: #E06C75;">s</span> = <span style="color: #C678DD;">new</span> <span style="color: #E5C07B;">Stack</span>&lt;<span style="color: #E5C07B;">int</span>&gt;();

s.Push (1); <span style="color: #5C6370; font-style: italic;">// </span><span style="color: #5C6370; font-style: italic;">Stack = 1</span>
s.Push (2); <span style="color: #5C6370; font-style: italic;">// </span><span style="color: #5C6370; font-style: italic;">Stack = 1,2</span>
s.Push (3); <span style="color: #5C6370; font-style: italic;">// </span><span style="color: #5C6370; font-style: italic;">Stack = 1,2,3</span>

Console.WriteLine (s.Count); <span style="color: #5C6370; font-style: italic;">// </span><span style="color: #5C6370; font-style: italic;">Prints 3</span>
Console.WriteLine (s.<span style="color: #61AFEF;">Peek</span>()); <span style="color: #5C6370; font-style: italic;">// </span><span style="color: #5C6370; font-style: italic;">Prints 3, Stack = 1,2,3</span>
Console.WriteLine (s.<span style="color: #61AFEF;">Pop</span>()); <span style="color: #5C6370; font-style: italic;">// </span><span style="color: #5C6370; font-style: italic;">Prints 3, Stack = 1,2</span>
Console.WriteLine (s.<span style="color: #61AFEF;">Pop</span>()); <span style="color: #5C6370; font-style: italic;">// </span><span style="color: #5C6370; font-style: italic;">Prints 2, Stack = 1</span>
Console.WriteLine (s.<span style="color: #61AFEF;">Pop</span>()); <span style="color: #5C6370; font-style: italic;">// </span><span style="color: #5C6370; font-style: italic;">Prints 1, Stack =</span>
Console.WriteLine (s.<span style="color: #61AFEF;">Pop</span>()); <span style="color: #5C6370; font-style: italic;">// </span><span style="color: #5C6370; font-style: italic;">throws exception</span>
</pre>
</div>

<p>
HashSet&lt;T&gt; example:
</p>
<div class="org-src-container">
<pre class="src src-csharp">Console.WriteLine (letters.Contains (<span style="color: #98C379;">'t'</span>)); <span style="color: #5C6370; font-style: italic;">// </span><span style="color: #5C6370; font-style: italic;">true</span>
Console.WriteLine (letters.Contains (<span style="color: #98C379;">'j'</span>)); <span style="color: #5C6370; font-style: italic;">// </span><span style="color: #5C6370; font-style: italic;">false</span>

<span style="color: #C678DD;">foreach</span> (<span style="color: #E5C07B;">char</span> <span style="color: #E06C75;">c</span> <span style="color: #C678DD;">in</span> letters) Console.Write (c); <span style="color: #5C6370; font-style: italic;">// </span><span style="color: #5C6370; font-style: italic;">the quickbrownfx</span>
</pre>
</div>

<p>
Set oprations:
</p>

<p>
<i>destructive</i>
</p>
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #C678DD;">public</span> <span style="color: #E5C07B;">void</span> <span style="color: #61AFEF;">UnionWith</span> (<span style="color: #E5C07B;">IEnumerable</span>&lt;<span style="color: #E5C07B;">T</span>&gt; <span style="color: #E06C75;">other</span>); <span style="color: #5C6370; font-style: italic;">// </span><span style="color: #5C6370; font-style: italic;">Adds</span>
<span style="color: #C678DD;">public</span> <span style="color: #E5C07B;">void</span> <span style="color: #61AFEF;">IntersectWith</span> (<span style="color: #E5C07B;">IEnumerable</span>&lt;<span style="color: #E5C07B;">T</span>&gt; <span style="color: #E06C75;">other</span>); <span style="color: #5C6370; font-style: italic;">// </span><span style="color: #5C6370; font-style: italic;">Removes</span>
<span style="color: #C678DD;">public</span> <span style="color: #E5C07B;">void</span> <span style="color: #61AFEF;">ExceptWith</span> (<span style="color: #E5C07B;">IEnumerable</span>&lt;<span style="color: #E5C07B;">T</span>&gt; <span style="color: #E06C75;">other</span>); <span style="color: #5C6370; font-style: italic;">// </span><span style="color: #5C6370; font-style: italic;">Removes</span>
<span style="color: #C678DD;">public</span> <span style="color: #E5C07B;">void</span> <span style="color: #61AFEF;">SymmetricExceptWith</span> (<span style="color: #E5C07B;">IEnumerable</span>&lt;<span style="color: #E5C07B;">T</span>&gt; <span style="color: #E06C75;">other</span>); <span style="color: #5C6370; font-style: italic;">// </span><span style="color: #5C6370; font-style: italic;">Removes</span>
</pre>
</div>

<p>
<i>query</i>
</p>
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #C678DD;">public</span> <span style="color: #E5C07B;">bool</span> <span style="color: #61AFEF;">IsSubsetOf</span> (<span style="color: #E5C07B;">IEnumerable</span>&lt;<span style="color: #E5C07B;">T</span>&gt; <span style="color: #E06C75;">other</span>);
<span style="color: #C678DD;">public</span> <span style="color: #E5C07B;">bool</span> <span style="color: #61AFEF;">IsProperSubsetOf</span> (<span style="color: #E5C07B;">IEnumerable</span>&lt;<span style="color: #E5C07B;">T</span>&gt; <span style="color: #E06C75;">other</span>);
<span style="color: #C678DD;">public</span> <span style="color: #E5C07B;">bool</span> <span style="color: #61AFEF;">IsSupersetOf</span> (<span style="color: #E5C07B;">IEnumerable</span>&lt;<span style="color: #E5C07B;">T</span>&gt; <span style="color: #E06C75;">other</span>);
<span style="color: #C678DD;">public</span> <span style="color: #E5C07B;">bool</span> <span style="color: #61AFEF;">IsProperSupersetOf</span> (<span style="color: #E5C07B;">IEnumerable</span>&lt;<span style="color: #E5C07B;">T</span>&gt; <span style="color: #E06C75;">other</span>);
<span style="color: #C678DD;">public</span> <span style="color: #E5C07B;">bool</span> <span style="color: #61AFEF;">Overlaps</span> (<span style="color: #E5C07B;">IEnumerable</span>&lt;<span style="color: #E5C07B;">T</span>&gt; <span style="color: #E06C75;">other</span>);
<span style="color: #C678DD;">public</span> <span style="color: #E5C07B;">bool</span> <span style="color: #61AFEF;">SetEquals</span> (<span style="color: #E5C07B;">IEnumerable</span>&lt;<span style="color: #E5C07B;">T</span>&gt; <span style="color: #E06C75;">other</span>);
</pre>
</div>
</div>
</div>

<div id="outline-container-orgfa8d313" class="outline-3">
<h3 id="orgfa8d313"><span class="section-number-3">6.6</span> Dictionaries</h3>
<div class="outline-text-3" id="text-6-6">
<blockquote>
<p>
In Big-O notation, retrieval time by key is as follows:
</p>
<ul class="org-ul">
<li><b>O(1)</b> for <code>Hashtable</code>, <code>Dictionary</code>, and <code>OrderedDictionary</code></li>
<li><b>O(log n)</b> for <code>SortedDictionary</code> and <code>SortedList</code></li>
<li><b>O(n)</b> for <code>ListDictionary</code> (and nondictionary types such as <code>List&lt;T&gt;</code>)</li>
</ul>
<p>
n is the number of elements in the collection.
</p>
</blockquote>

<p>
Example:
</p>
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #E5C07B;">var</span> <span style="color: #E06C75;">d</span> = <span style="color: #C678DD;">new</span> <span style="color: #E5C07B;">Dictionary</span>&lt;<span style="color: #E5C07B;">string</span>, <span style="color: #E5C07B;">int</span>&gt;();

d.<span style="color: #61AFEF;">Add</span>(<span style="color: #98C379;">"One"</span>, 1);
d[<span style="color: #98C379;">"Two"</span>] = 2; <span style="color: #5C6370; font-style: italic;">// </span><span style="color: #5C6370; font-style: italic;">adds to dictionary because "two" not already present</span>
d[<span style="color: #98C379;">"Two"</span>] = 22; <span style="color: #5C6370; font-style: italic;">// </span><span style="color: #5C6370; font-style: italic;">updates dictionary because "two" is now present</span>
d[<span style="color: #98C379;">"Three"</span>] = 3;

Console.WriteLine (d[<span style="color: #98C379;">"Two"</span>]); <span style="color: #5C6370; font-style: italic;">// </span><span style="color: #5C6370; font-style: italic;">Prints "22"</span>
Console.WriteLine (d.ContainsKey (<span style="color: #98C379;">"One"</span>)); <span style="color: #5C6370; font-style: italic;">// </span><span style="color: #5C6370; font-style: italic;">true (fast operation)</span>
Console.WriteLine (d.ContainsValue (3)); <span style="color: #5C6370; font-style: italic;">// </span><span style="color: #5C6370; font-style: italic;">true (slow operation)</span>

<span style="color: #E5C07B;">int</span> <span style="color: #E06C75;">val</span> = 0;
<span style="color: #C678DD;">if</span> (<span style="color: #56B6C2; font-weight: bold;">!</span>d.TryGetValue (<span style="color: #98C379;">"onE"</span>, <span style="color: #C678DD;">out</span> <span style="color: #E5C07B;">val</span>))
Console.WriteLine (<span style="color: #98C379;">"No val"</span>); <span style="color: #5C6370; font-style: italic;">// </span><span style="color: #5C6370; font-style: italic;">"No val" (case sensitive)</span>

<span style="color: #5C6370; font-style: italic;">// </span><span style="color: #5C6370; font-style: italic;">Three different ways to enumerate the dictionary:</span>

<span style="color: #C678DD;">foreach</span> (KeyValuePair&lt;<span style="color: #E5C07B;">string</span>, <span style="color: #E5C07B;">int</span>&gt; kv <span style="color: #C678DD;">in</span> d) <span style="color: #5C6370; font-style: italic;">// </span><span style="color: #5C6370; font-style: italic;">One; 1</span>
Console.WriteLine (kv.Key + <span style="color: #98C379;">"; "</span> + kv.Value); <span style="color: #5C6370; font-style: italic;">// </span><span style="color: #5C6370; font-style: italic;">Two; 22</span>
                                              <span style="color: #5C6370; font-style: italic;">// </span><span style="color: #5C6370; font-style: italic;">Three; 3</span>

<span style="color: #C678DD;">foreach</span> (<span style="color: #E5C07B;">string</span> <span style="color: #E06C75;">s</span> <span style="color: #C678DD;">in</span> d.Keys) Console.Write (s); <span style="color: #5C6370; font-style: italic;">// </span><span style="color: #5C6370; font-style: italic;">OneTwoThree</span>

Console.<span style="color: #61AFEF;">WriteLine</span>();

<span style="color: #C678DD;">foreach</span> (<span style="color: #E5C07B;">int</span> <span style="color: #E06C75;">i</span> <span style="color: #C678DD;">in</span> d.Values) Console.Write (i); <span style="color: #5C6370; font-style: italic;">// </span><span style="color: #5C6370; font-style: italic;">1223</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgdde7162" class="outline-3">
<h3 id="orgdde7162"><span class="section-number-3">6.7</span> Custom collections</h3>
<div class="outline-text-3" id="text-6-7">
<p>
Not a great implmentation with <code>IReadOnlyList&lt;T&gt;</code>:
</p>
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #C678DD;">public</span> <span style="color: #C678DD;">class</span> <span style="color: #E5C07B;">Test</span>
{
    <span style="color: #E5C07B;">List</span>&lt;<span style="color: #E5C07B;">string</span>&gt; <span style="color: #E06C75;">names</span> = <span style="color: #C678DD;">new</span> <span style="color: #E5C07B;">List</span>&lt;<span style="color: #E5C07B;">string</span>&gt;();
    <span style="color: #C678DD;">public</span> <span style="color: #E5C07B;">IReadOnlyList</span>&lt;<span style="color: #E5C07B;">string</span>&gt; <span style="color: #E06C75;">Names</span> =&gt; names;
}
</pre>
</div>

<blockquote>
<p>
Although Names returns a read-only interface, the consumer can still downcast at
runtime to List&lt;string&gt; or IList&lt;string&gt; and then call Add, Remove, or Clear on
the list. ReadOnlyCollection&lt;T&gt; provides a more robust solution:
</p>
</blockquote>

<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #C678DD;">public</span> <span style="color: #C678DD;">class</span> <span style="color: #E5C07B;">Test</span>
{
    <span style="color: #E5C07B;">List</span>&lt;<span style="color: #E5C07B;">string</span>&gt; <span style="color: #E06C75;">names</span> = <span style="color: #C678DD;">new</span> <span style="color: #E5C07B;">List</span>&lt;<span style="color: #E5C07B;">string</span>&gt;();
    <span style="color: #C678DD;">public</span> <span style="color: #E5C07B;">ReadOnlyCollection</span>&lt;<span style="color: #E5C07B;">string</span>&gt; <span style="color: #E06C75;">Names</span> { <span style="color: #C678DD;">get</span>; <span style="color: #C678DD;">private</span> <span style="color: #C678DD;">set</span>; }
    <span style="color: #C678DD;">public</span> <span style="color: #61AFEF;">Test</span>() =&gt; Names = <span style="color: #C678DD;">new</span> <span style="color: #E5C07B;">ReadOnlyCollection</span>&lt;<span style="color: #E5C07B;">string</span>&gt; (<span style="color: #E5C07B;">names</span>);
    <span style="color: #C678DD;">public</span> <span style="color: #E5C07B;">void</span> <span style="color: #61AFEF;">AddInternally</span>() =&gt; names.Add (<span style="color: #98C379;">"test"</span>);
}
</pre>
</div>

<p>
Example of use:
</p>
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #E5C07B;">Test</span> <span style="color: #E06C75;">t</span> = <span style="color: #C678DD;">new</span> <span style="color: #E5C07B;">Test</span>();

Console.WriteLine (t.Names.Count); <span style="color: #5C6370; font-style: italic;">// </span><span style="color: #5C6370; font-style: italic;">0</span>
t.<span style="color: #61AFEF;">AddInternally</span>();
Console.WriteLine (t.Names.Count); <span style="color: #5C6370; font-style: italic;">// </span><span style="color: #5C6370; font-style: italic;">1</span>

t.Names.Add (<span style="color: #98C379;">"test"</span>); <span style="color: #5C6370; font-style: italic;">// </span><span style="color: #5C6370; font-style: italic;">Compiler error</span>
((<span style="color: #E5C07B;">IList</span>&lt;<span style="color: #E5C07B;">string</span>&gt;) t.Names).Add (<span style="color: #98C379;">"test"</span>); <span style="color: #5C6370; font-style: italic;">// </span><span style="color: #5C6370; font-style: italic;">NotSupportedException</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgd708bd4" class="outline-3">
<h3 id="orgd708bd4"><span class="section-number-3">6.8</span> Immutable Collections</h3>
<div class="outline-text-3" id="text-6-8">
<p>
Creating immutable collections:
</p>
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #E5C07B;">ImmutableArray</span>&lt;<span style="color: #E5C07B;">int</span>&gt; <span style="color: #E06C75;">array</span> = ImmutableArray.Create&lt;<span style="color: #E5C07B;">int</span>&gt; (1, 2, 3);
</pre>
</div>

<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #E5C07B;">var</span> <span style="color: #E06C75;">list</span> = <span style="color: #C678DD;">new</span>[] { 1, 2, 3 }.<span style="color: #61AFEF;">ToImmutableList</span>();
</pre>
</div>
</div>
</div>
</div>


<div id="outline-container-orgde45c83" class="outline-2">
<h2 id="orgde45c83"><span class="section-number-2">7</span> LINQ Queries</h2>
<div class="outline-text-2" id="text-7">
</div>
<div id="outline-container-org8f19f52" class="outline-3">
<h3 id="org8f19f52"><span class="section-number-3">7.1</span> Intro</h3>
<div class="outline-text-3" id="text-7-1">
<p>
LINQ = Language Integrated Query
</p>

<blockquote>
<p>
LINQ enables you to query any collection implementing <code>IEnumerable&lt;T&gt;</code>, whether
an array, list, or XML Document Object Model (DOM), as well as remote data
sources, such as tables in an SQL Server database. LINQ offers the benefits of both
compile-time type checking and dynamic query composition.
</p>
</blockquote>

<blockquote>
<p>
A <b>query operator</b> is a method that transforms a sequence. A typical query operator
accepts an <b>input sequence</b> and emits a transformed <b>output sequence</b>.
</p>
</blockquote>

<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #E5C07B;">string</span>[] <span style="color: #E06C75;">names</span> = { <span style="color: #98C379;">"Tom"</span>, <span style="color: #98C379;">"Dick"</span>, <span style="color: #98C379;">"Harry"</span> };

Console.<span style="color: #61AFEF;">WriteLine</span>(@<span style="color: #98C379;">"</span>
<span style="color: #98C379;">&gt;&gt;&gt; using standalone operator..."</span>);

<span style="color: #5C6370; font-style: italic;">// </span><span style="color: #5C6370; font-style: italic;">long...</span>
<span style="color: #E5C07B;">IEnumerable</span>&lt;<span style="color: #E5C07B;">string</span>&gt; <span style="color: #E06C75;">filteredNames</span> = System.Linq.Enumerable.Where
     (names, n =&gt; n.Length &gt;= 3);

<span style="color: #C678DD;">foreach</span> (<span style="color: #E5C07B;">string</span> <span style="color: #E06C75;">n</span> <span style="color: #C678DD;">in</span> filteredNames)
    Console.<span style="color: #61AFEF;">WriteLine</span>(n);

Console.<span style="color: #61AFEF;">WriteLine</span>(@<span style="color: #98C379;">"</span>
<span style="color: #98C379;">&gt;&gt;&gt; using operator..."</span>);

<span style="color: #5C6370; font-style: italic;">// </span><span style="color: #5C6370; font-style: italic;">shorter with an extension operator...</span>
<span style="color: #E5C07B;">var</span> <span style="color: #E06C75;">filtered</span> = names.<span style="color: #61AFEF;">Where</span>(n =&gt; n.Length ==5);

<span style="color: #C678DD;">foreach</span> ( <span style="color: #E5C07B;">var</span> <span style="color: #E06C75;">s</span>  <span style="color: #C678DD;">in</span> filtered )
    Console.<span style="color: #61AFEF;">WriteLine</span>( s );
</pre>
</div>

<div class="org-src-container">
<pre class="src src-shell">&gt;&gt;&gt; using standalone operator...
Tom
Dick
Harry

&gt;&gt;&gt; using operator...
Harry
</pre>
</div>

<p>
Signature for the <code>Where</code> operator:
</p>
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #C678DD;">public</span> <span style="color: #C678DD;">static</span> <span style="color: #E5C07B;">IEnumerable</span>&lt;<span style="color: #E5C07B;">TSource</span>&gt; <span style="color: #61AFEF;">Where</span>&lt;<span style="color: #E5C07B;">TSource</span>&gt;
    (<span style="color: #C678DD;">this</span> <span style="color: #E5C07B;">IEnumerable</span>&lt;<span style="color: #E5C07B;">TSource</span>&gt; <span style="color: #E06C75;">source</span>, <span style="color: #E5C07B;">Func</span>&lt;<span style="color: #E5C07B;">TSource</span>,<span style="color: #E5C07B;">bool</span>&gt; <span style="color: #E06C75;">predicate</span>)
</pre>
</div>

<p>
Fluent syntax:
</p>
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #E5C07B;">IEnumerable</span>&lt;<span style="color: #E5C07B;">string</span>&gt; <span style="color: #E06C75;">filteredNames</span> = <span style="color: #C678DD;">from</span> n <span style="color: #C678DD;">in</span> names
    <span style="color: #C678DD;">where</span> n.Contains
    <span style="color: #C678DD;">select</span> n;
</pre>
</div>
</div>
</div>

<div id="outline-container-org0bd2ded" class="outline-3">
<h3 id="org0bd2ded"><span class="section-number-3">7.2</span> Fluent syntax</h3>
<div class="outline-text-3" id="text-7-2">
<p>
Basic example:
</p>
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #E5C07B;">string</span>[] <span style="color: #E06C75;">names</span> = { <span style="color: #98C379;">"Tom"</span>, <span style="color: #98C379;">"Dick"</span>, <span style="color: #98C379;">"Harry"</span>, <span style="color: #98C379;">"Mary"</span>, <span style="color: #98C379;">"Jay"</span> };

<span style="color: #E5C07B;">IEnumerable</span>&lt;<span style="color: #E5C07B;">string</span>&gt; <span style="color: #E06C75;">query</span> = names
    .Where (n =&gt; n.Contains (<span style="color: #98C379;">"a"</span>))
    .OrderBy (n =&gt; n.Length)
    .Select (n =&gt; n.<span style="color: #61AFEF;">ToUpper</span>());

<span style="color: #C678DD;">foreach</span> (<span style="color: #E5C07B;">string</span> <span style="color: #E06C75;">name</span> <span style="color: #C678DD;">in</span> query)
    Console.WriteLine (name); <span style="color: #5C6370; font-style: italic;">// </span><span style="color: #5C6370; font-style: italic;">JAY \n MARY \n HARRY</span>
</pre>
</div>

<p>
Basic operators signatures:
</p>
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #C678DD;">public</span> <span style="color: #C678DD;">static</span> <span style="color: #E5C07B;">IEnumerable</span>&lt;<span style="color: #E5C07B;">TSource</span>&gt; <span style="color: #61AFEF;">Where</span>&lt;<span style="color: #E5C07B;">TSource</span>&gt;
    (<span style="color: #C678DD;">this</span> <span style="color: #E5C07B;">IEnumerable</span>&lt;<span style="color: #E5C07B;">TSource</span>&gt; <span style="color: #E06C75;">source</span>, <span style="color: #E5C07B;">Func</span>&lt;<span style="color: #E5C07B;">TSource</span>,<span style="color: #E5C07B;">bool</span>&gt; <span style="color: #E06C75;">predicate</span>);

<span style="color: #C678DD;">public</span> <span style="color: #C678DD;">static</span> <span style="color: #E5C07B;">IEnumerable</span>&lt;<span style="color: #E5C07B;">TSource</span>&gt; <span style="color: #61AFEF;">OrderBy</span>&lt;<span style="color: #E5C07B;">TSource</span>,<span style="color: #E5C07B;">TKey</span>&gt;
    (<span style="color: #C678DD;">this</span> <span style="color: #E5C07B;">IEnumerable</span>&lt;<span style="color: #E5C07B;">TSource</span>&gt; <span style="color: #E06C75;">source</span>, <span style="color: #E5C07B;">Func</span>&lt;<span style="color: #E5C07B;">TSource</span>,<span style="color: #E5C07B;">TKey</span>&gt; <span style="color: #E06C75;">keySelector</span>);

<span style="color: #C678DD;">public</span> <span style="color: #C678DD;">static</span> <span style="color: #E5C07B;">IEnumerable</span>&lt;<span style="color: #E5C07B;">TResult</span>&gt; <span style="color: #61AFEF;">Select</span>&lt;<span style="color: #E5C07B;">TSource</span>,<span style="color: #E5C07B;">TResult</span>&gt;
    (<span style="color: #C678DD;">this</span> <span style="color: #E5C07B;">IEnumerable</span>&lt;<span style="color: #E5C07B;">TSource</span>&gt; <span style="color: #E06C75;">source</span>, <span style="color: #E5C07B;">Func</span>&lt;<span style="color: #E5C07B;">TSource</span>,<span style="color: #E5C07B;">TResult</span>&gt; <span style="color: #E06C75;">selector</span>)
</pre>
</div>

<p>
<b>NOTE: no <i>terminal</i> operation in C#!</b>
</p>

<p>
This:
</p>
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #E5C07B;">IEnumerable</span>&lt;<span style="color: #E5C07B;">string</span>&gt; <span style="color: #E06C75;">query</span> = names
    .Where (n =&gt; n.Contains (<span style="color: #98C379;">"a"</span>))
    .OrderBy (n =&gt; n.Length)
    .Select (n =&gt; n.<span style="color: #61AFEF;">ToUpper</span>());
</pre>
</div>

<p>
is equal to this (conventional static methods):
</p>
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #E5C07B;">IEnumerable</span>&lt;<span style="color: #E5C07B;">string</span>&gt; <span style="color: #E06C75;">query</span> =
    Enumerable.Select (
        Enumerable.OrderBy (
            Enumerable.Where (
                names, n =&gt; n.Contains (<span style="color: #98C379;">"a"</span>)
            ), n =&gt; n.Length
        ), n =&gt; n.<span style="color: #61AFEF;">ToUpper</span>()
    );
</pre>
</div>

<p>
Internal immlementation of <code>Where</code> query operator:
</p>
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #C678DD;">public</span> <span style="color: #C678DD;">static</span> <span style="color: #E5C07B;">IEnumerable</span>&lt;<span style="color: #E5C07B;">TSource</span>&gt; <span style="color: #61AFEF;">Where</span>&lt;<span style="color: #E5C07B;">TSource</span>&gt;
    (<span style="color: #C678DD;">this</span> <span style="color: #E5C07B;">IEnumerable</span>&lt;<span style="color: #E5C07B;">TSource</span>&gt; <span style="color: #E06C75;">source</span>, <span style="color: #E5C07B;">Func</span>&lt;<span style="color: #E5C07B;">TSource</span>,<span style="color: #E5C07B;">bool</span>&gt; <span style="color: #E06C75;">predicate</span>)
{
    <span style="color: #C678DD;">foreach</span> (<span style="color: #E5C07B;">TSource</span> <span style="color: #E06C75;">element</span> <span style="color: #C678DD;">in</span> source)
        <span style="color: #C678DD;">if</span> (predicate (element))
            <span style="color: #C678DD;">yield</span> <span style="color: #C678DD;">return</span> element;
}
</pre>
</div>

<p>
Examples:
</p>
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #E5C07B;">int</span>[] <span style="color: #E06C75;">numbers</span> = { 10, 9, 8, 7, 6 };
<span style="color: #E5C07B;">IEnumerable</span>&lt;<span style="color: #E5C07B;">int</span>&gt; <span style="color: #E06C75;">firstThree</span> = numbers.Take (3); <span style="color: #5C6370; font-style: italic;">// </span><span style="color: #5C6370; font-style: italic;">{ 10, 9, 8 }</span>

<span style="color: #E5C07B;">IEnumerable</span>&lt;<span style="color: #E5C07B;">int</span>&gt; <span style="color: #E06C75;">lastTwo</span> = numbers.Skip (3); <span style="color: #5C6370; font-style: italic;">// </span><span style="color: #5C6370; font-style: italic;">{ 7, 6 }</span>

<span style="color: #E5C07B;">IEnumerable</span>&lt;<span style="color: #E5C07B;">int</span>&gt; <span style="color: #E06C75;">reversed</span> = numbers.<span style="color: #61AFEF;">Reverse</span>(); <span style="color: #5C6370; font-style: italic;">// </span><span style="color: #5C6370; font-style: italic;">{ 6, 7, 8, 9, 10 }</span>

<span style="color: #E5C07B;">int</span> <span style="color: #E06C75;">firstNumber</span> = numbers.<span style="color: #61AFEF;">First</span>(); <span style="color: #5C6370; font-style: italic;">// </span><span style="color: #5C6370; font-style: italic;">10</span>
<span style="color: #E5C07B;">int</span> <span style="color: #E06C75;">lastNumber</span> = numbers.<span style="color: #61AFEF;">Last</span>(); <span style="color: #5C6370; font-style: italic;">// </span><span style="color: #5C6370; font-style: italic;">6</span>
<span style="color: #E5C07B;">int</span> <span style="color: #E06C75;">secondNumber</span> = numbers.<span style="color: #61AFEF;">ElementAt</span>(1); <span style="color: #5C6370; font-style: italic;">// </span><span style="color: #5C6370; font-style: italic;">9</span>
<span style="color: #E5C07B;">int</span> <span style="color: #E06C75;">secondLowest</span> = numbers.<span style="color: #61AFEF;">OrderBy</span>(n=&gt;n).<span style="color: #61AFEF;">Skip</span>(1).<span style="color: #61AFEF;">First</span>(); <span style="color: #5C6370; font-style: italic;">// </span><span style="color: #5C6370; font-style: italic;">7</span>
</pre>
</div>

<p>
Aggrgation:
</p>
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #E5C07B;">int</span> <span style="color: #E06C75;">count</span> = numbers.<span style="color: #61AFEF;">Count</span>(); <span style="color: #5C6370; font-style: italic;">// </span><span style="color: #5C6370; font-style: italic;">5;</span>
<span style="color: #E5C07B;">int</span> <span style="color: #E06C75;">min</span> = numbers.<span style="color: #61AFEF;">Min</span>(); <span style="color: #5C6370; font-style: italic;">// </span><span style="color: #5C6370; font-style: italic;">6;</span>
</pre>
</div>

<p>
Quantifiers:
</p>
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #E5C07B;">bool</span> <span style="color: #E06C75;">hasTheNumberNine</span> = numbers.Contains (9); <span style="color: #5C6370; font-style: italic;">// </span><span style="color: #5C6370; font-style: italic;">true</span>
<span style="color: #E5C07B;">bool</span> <span style="color: #E06C75;">hasMoreThanZeroElements</span> = numbers.<span style="color: #61AFEF;">Any</span>(); <span style="color: #5C6370; font-style: italic;">// </span><span style="color: #5C6370; font-style: italic;">true</span>
<span style="color: #E5C07B;">bool</span> <span style="color: #E06C75;">hasAnOddElement</span> = numbers.Any (n =&gt; n % 2 != 0); <span style="color: #5C6370; font-style: italic;">// </span><span style="color: #5C6370; font-style: italic;">true</span>
</pre>
</div>

<p>
Milti-sequence operators:
</p>
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #E5C07B;">int</span>[] <span style="color: #E06C75;">seq1</span> = { 1, 2, 3 };
<span style="color: #E5C07B;">int</span>[] <span style="color: #E06C75;">seq2</span> = { 3, 4, 5 };
<span style="color: #E5C07B;">IEnumerable</span>&lt;<span style="color: #E5C07B;">int</span>&gt; <span style="color: #E06C75;">concat</span> = seq1.Concat (seq2); <span style="color: #5C6370; font-style: italic;">// </span><span style="color: #5C6370; font-style: italic;">{ 1, 2, 3, 3, 4, 5 }</span>
<span style="color: #E5C07B;">IEnumerable</span>&lt;<span style="color: #E5C07B;">int</span>&gt; <span style="color: #E06C75;">union</span> = seq1.Union (seq2); <span style="color: #5C6370; font-style: italic;">// </span><span style="color: #5C6370; font-style: italic;">{ 1, 2, 3, 4, 5 }</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgc650cfa" class="outline-3">
<h3 id="orgc650cfa"><span class="section-number-3">7.3</span> Query expressions</h3>
<div class="outline-text-3" id="text-7-3">
<blockquote>
<p>
Query expressions always start with a from clause and end with either a select
or group clause.
</p>
</blockquote>

<p>
This:
</p>
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #E5C07B;">string</span>[] <span style="color: #E06C75;">names</span> = { <span style="color: #98C379;">"Tom"</span>, <span style="color: #98C379;">"Dick"</span>, <span style="color: #98C379;">"Harry"</span>, <span style="color: #98C379;">"Mary"</span>, <span style="color: #98C379;">"Jay"</span> };

<span style="color: #E5C07B;">IEnumerable</span>&lt;<span style="color: #E5C07B;">string</span>&gt; <span style="color: #E06C75;">query</span> = names
    .Where (n =&gt; n.Contains (<span style="color: #98C379;">"a"</span>))
    .OrderBy (n =&gt; n.Length)
    .Select (n =&gt; n.<span style="color: #61AFEF;">ToUpper</span>());

<span style="color: #C678DD;">foreach</span> (<span style="color: #E5C07B;">string</span> <span style="color: #E06C75;">name</span> <span style="color: #C678DD;">in</span> query)
    Console.WriteLine (name);
</pre>
</div>

<p>
is equal to this:
</p>
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #E5C07B;">string</span>[] <span style="color: #E06C75;">names</span> = { <span style="color: #98C379;">"Tom"</span>, <span style="color: #98C379;">"Dick"</span>, <span style="color: #98C379;">"Harry"</span>, <span style="color: #98C379;">"Mary"</span>, <span style="color: #98C379;">"Jay"</span> };

<span style="color: #E5C07B;">IEnumerable</span>&lt;<span style="color: #E5C07B;">string</span>&gt; <span style="color: #E06C75;">query</span> =
    <span style="color: #C678DD;">from</span> n <span style="color: #C678DD;">in</span> names
    <span style="color: #C678DD;">where</span> n.Contains (<span style="color: #98C379;">"a"</span>) <span style="color: #5C6370; font-style: italic;">// </span><span style="color: #5C6370; font-style: italic;">Filter elements</span>
    <span style="color: #C678DD;">orderby</span> n.Length <span style="color: #5C6370; font-style: italic;">// </span><span style="color: #5C6370; font-style: italic;">Sort elements</span>
    <span style="color: #C678DD;">select</span> n.<span style="color: #61AFEF;">ToUpper</span>(); <span style="color: #5C6370; font-style: italic;">// </span><span style="color: #5C6370; font-style: italic;">Translate each element (project)</span>

<span style="color: #C678DD;">foreach</span> (<span style="color: #E5C07B;">string</span> <span style="color: #E06C75;">name</span> <span style="color: #C678DD;">in</span> query) Console.WriteLine (name);
</pre>
</div>
</div>
</div>

<div id="outline-container-orgfd9f515" class="outline-3">
<h3 id="orgfd9f515"><span class="section-number-3">7.4</span> How Deferred Execution Works</h3>
<div class="outline-text-3" id="text-7-4">
<p>
Example of writing a custom <code>Select</code> operator:
</p>
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #C678DD;">public</span> <span style="color: #C678DD;">static</span> <span style="color: #E5C07B;">IEnumerable</span>&lt;<span style="color: #E5C07B;">TResult</span>&gt; <span style="color: #61AFEF;">MySelect</span>&lt;<span style="color: #E5C07B;">TSource</span>,<span style="color: #E5C07B;">TResult</span>&gt;
    (<span style="color: #C678DD;">this</span> <span style="color: #E5C07B;">IEnumerable</span>&lt;<span style="color: #E5C07B;">TSource</span>&gt; <span style="color: #E06C75;">source</span>, <span style="color: #E5C07B;">Func</span>&lt;<span style="color: #E5C07B;">TSource</span>,<span style="color: #E5C07B;">TResult</span>&gt; <span style="color: #E06C75;">selector</span>)
{
    <span style="color: #C678DD;">foreach</span> (<span style="color: #E5C07B;">TSource</span> <span style="color: #E06C75;">element</span> <span style="color: #C678DD;">in</span> source)
        <span style="color: #C678DD;">yield</span> <span style="color: #C678DD;">return</span> selector (element);
}
</pre>
</div>


<p>
Strange looking variable assignment :)
</p>
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #E5C07B;">IEnumerable</span>&lt;<span style="color: #E5C07B;">int</span>&gt;
    <span style="color: #E06C75;">source</span> = <span style="color: #C678DD;">new</span> <span style="color: #E5C07B;">int</span>[] { 5, 12, 3 },
    filtered = source .Where (n =&gt; n &lt; 10),
    sorted = filtered .OrderBy (n =&gt; n),
    query = sorted .Select (n =&gt; n * 10);

<span style="color: #C678DD;">foreach</span>( <span style="color: #E5C07B;">int</span> <span style="color: #E06C75;">n</span> <span style="color: #C678DD;">in</span> query)
    Console.<span style="color: #61AFEF;">WriteLine</span>(n); <span style="color: #5C6370; font-style: italic;">// </span><span style="color: #5C6370; font-style: italic;">50 \n 30</span>

</pre>
</div>
</div>
</div>

<div id="outline-container-org19b7aae" class="outline-3">
<h3 id="org19b7aae"><span class="section-number-3">7.5</span> Subqueries</h3>
<div class="outline-text-3" id="text-7-5">
<blockquote>
<p>
<b>Subquery</b>: embeds an inner query within the lambda expression of another.
</p>
</blockquote>

<p>
Objective is to select a shortest string from a set:
</p>

<p>
Using operator fluent syntax:
</p>
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #E5C07B;">IEnumerable</span>&lt;<span style="color: #E5C07B;">string</span>&gt; <span style="color: #E06C75;">outerQuery</span> = names
    .Where (n =&gt; n.Length == names
            .OrderBy (n2 =&gt; n2.Length)
            .Select (n2 =&gt; n2.Length).<span style="color: #61AFEF;">First</span>());

<span style="color: #C678DD;">foreach</span> (<span style="color: #E5C07B;">string</span> <span style="color: #E06C75;">name</span> <span style="color: #C678DD;">in</span> outerQuery)
    Console.WriteLine (name);
</pre>
</div>

<p>
Using query expression:
</p>
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #E5C07B;">IEnumerable</span>&lt;<span style="color: #E5C07B;">string</span>&gt; <span style="color: #E06C75;">outerQueryExp</span> =
    <span style="color: #C678DD;">from</span> n <span style="color: #C678DD;">in</span> names
    <span style="color: #C678DD;">where</span> n.Length ==
    (<span style="color: #C678DD;">from</span> n2 <span style="color: #C678DD;">in</span> names <span style="color: #C678DD;">orderby</span> n2.Length <span style="color: #C678DD;">select</span> n2.Length).<span style="color: #61AFEF;">First</span>()
    <span style="color: #C678DD;">select</span> n;
</pre>
</div>

<p>
<i>Note: the second <code>names</code> for subqueries.</i>
</p>

<p>
Shorter versions:
</p>

<p>
Mixed fluent syntax and query expression:
</p>
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #E5C07B;">IEnumerable</span>&lt;<span style="color: #E5C07B;">string</span>&gt; <span style="color: #E06C75;">query</span> =
    <span style="color: #C678DD;">from</span> n <span style="color: #C678DD;">in</span> names
    <span style="color: #C678DD;">where</span> n.Length == names.OrderBy (n2 =&gt; n2.Length).<span style="color: #61AFEF;">First</span>().Length
    <span style="color: #C678DD;">select</span> n;
</pre>
</div>

<p>
Using <code>Min</code> operator:
</p>
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #E5C07B;">IEnumerable</span>&lt;<span style="color: #E5C07B;">string</span>&gt; <span style="color: #E06C75;">query</span> =
    <span style="color: #C678DD;">from</span> n <span style="color: #C678DD;">in</span> names
    <span style="color: #C678DD;">where</span> n.Length == names.Min (n2 =&gt; n2.Length)
    <span style="color: #C678DD;">select</span> n;
</pre>
</div>

<p>
<i><b>WARNING</b>: above forces the subquery to be execure for every element!!!</i>
</p>

<p>
Better way of doing the same (externalize the subquery):
</p>
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #E5C07B;">int</span> <span style="color: #E06C75;">shortest</span> = names.Min (n =&gt; n.Length);

<span style="color: #E5C07B;">IEnumerable</span>&lt;<span style="color: #E5C07B;">string</span>&gt; <span style="color: #E06C75;">query</span> = <span style="color: #C678DD;">from</span> n <span style="color: #C678DD;">in</span> names
    <span style="color: #C678DD;">where</span> n.Length
</pre>
</div>

<p>
This filtering using operators is impossible to replicate with query expression due to the requirement on order of elements - <code>from</code> &#x2026;. <code>select</code>:
</p>

<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #E5C07B;">IEnumerable</span>&lt;<span style="color: #E5C07B;">string</span>&gt; <span style="color: #E06C75;">query</span> = names
    .Select (n =&gt; n.Replace (<span style="color: #98C379;">"a"</span>, <span style="color: #98C379;">""</span>).Replace (<span style="color: #98C379;">"e"</span>, <span style="color: #98C379;">""</span>).Replace (<span style="color: #98C379;">"i"</span>, <span style="color: #98C379;">""</span>)
             .Replace (<span style="color: #98C379;">"o"</span>, <span style="color: #98C379;">""</span>).Replace (<span style="color: #98C379;">"u"</span>, <span style="color: #98C379;">""</span>))
    .Where (n =&gt; n.Length &gt; 2)
    .OrderBy (n =&gt; n);
</pre>
</div>

<p>
We need to split the query statement into two to achive the same result:
</p>

<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #E5C07B;">IEnumerable</span>&lt;<span style="color: #E5C07B;">string</span>&gt; <span style="color: #E06C75;">queryExp</span> =
    <span style="color: #C678DD;">from</span> n <span style="color: #C678DD;">in</span> names
    <span style="color: #C678DD;">select</span> n.Replace (<span style="color: #98C379;">"a"</span>, <span style="color: #98C379;">""</span>).Replace (<span style="color: #98C379;">"e"</span>, <span style="color: #98C379;">""</span>).<span style="color: #61AFEF;">Replace</span>(<span style="color: #98C379;">"i"</span>, <span style="color: #98C379;">""</span>)
    .Replace (<span style="color: #98C379;">"o"</span>, <span style="color: #98C379;">""</span>).Replace (<span style="color: #98C379;">"u"</span>, <span style="color: #98C379;">""</span>);

queryExp = <span style="color: #C678DD;">from</span> n <span style="color: #C678DD;">in</span> query <span style="color: #C678DD;">where</span> n.Length &gt; 2 <span style="color: #C678DD;">orderby</span> n <span style="color: #C678DD;">select</span> n;
</pre>
</div>
</div>
</div>

<div id="outline-container-org248ec21" class="outline-3">
<h3 id="org248ec21"><span class="section-number-3">7.6</span> The <code>into</code> keyword</h3>
<div class="outline-text-3" id="text-7-6">
<p>
<code>into</code> is signaling a <i>query continuaton</i>
</p>

<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #E5C07B;">IEnumerable</span>&lt;<span style="color: #E5C07B;">string</span>&gt; <span style="color: #E06C75;">query</span> =
    <span style="color: #C678DD;">from</span> n <span style="color: #C678DD;">in</span> names
    <span style="color: #C678DD;">select</span> n.Replace (<span style="color: #98C379;">"a"</span>, <span style="color: #98C379;">""</span>).Replace (<span style="color: #98C379;">"e"</span>, <span style="color: #98C379;">""</span>).Replace (<span style="color: #98C379;">"i"</span>, <span style="color: #98C379;">""</span>)
               .Replace (<span style="color: #98C379;">"o"</span>, <span style="color: #98C379;">""</span>).Replace (<span style="color: #98C379;">"u"</span>, <span style="color: #98C379;">""</span>)
    <span style="color: #C678DD;">into</span> noVowelElement                     <span style="color: #5C6370; font-style: italic;">// </span><span style="color: #5C6370; font-style: italic;">new query, no relations to n</span>
      <span style="color: #C678DD;">where</span> noVowelElement.Length &gt; 2
      <span style="color: #C678DD;">orderby</span> noVowelElement
      <span style="color: #C678DD;">select</span> noVowelElement;
</pre>
</div>
</div>
</div>

<div id="outline-container-orgf7d7445" class="outline-3">
<h3 id="orgf7d7445"><span class="section-number-3">7.7</span> Wrapping queries</h3>
<div class="outline-text-3" id="text-7-7">
<p>
(<i>Pattern</i>) from this:
</p>
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #E5C07B;">var</span> <span style="color: #E06C75;">tempQuery</span> = tempQueryExpr
<span style="color: #E5C07B;">var</span> finalQuery = <span style="color: #C678DD;">from</span> ... <span style="color: #C678DD;">in</span> tempQuery ...
</pre>
</div>

<p>
to this:
</p>
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #E5C07B;">var</span> <span style="color: #E06C75;">finalQuery</span> = <span style="color: #C678DD;">from</span> ... <span style="color: #C678DD;">in</span> (tempQueryExpr)
</pre>
</div>

<p>
No Vowels solution using query wrapping facility:
</p>
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #E5C07B;">IEnumerable</span>&lt;<span style="color: #E5C07B;">string</span>&gt; <span style="color: #E06C75;">query</span> =
    <span style="color: #C678DD;">from</span> n1 <span style="color: #C678DD;">in</span>
    (
        <span style="color: #C678DD;">from</span> n2 <span style="color: #C678DD;">in</span> names
        <span style="color: #C678DD;">select</span> n2.Replace (<span style="color: #98C379;">"a"</span>, <span style="color: #98C379;">""</span>).Replace (<span style="color: #98C379;">"e"</span>, <span style="color: #98C379;">""</span>).Replace (<span style="color: #98C379;">"i"</span>, <span style="color: #98C379;">""</span>)
        .Replace (<span style="color: #98C379;">"o"</span>, <span style="color: #98C379;">""</span>).Replace (<span style="color: #98C379;">"u"</span>, <span style="color: #98C379;">""</span>)
    )
    <span style="color: #C678DD;">where</span> n1.Length &gt; 2 <span style="color: #C678DD;">orderby</span> n1 <span style="color: #C678DD;">select</span> n1;
</pre>
</div>

<p>
<b>THIS IS NOT a <i>subquery</i>!</b>
It is a syntactic sugar for the following statement using fluent syntax:
</p>
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #E5C07B;">IEnumerable</span>&lt;<span style="color: #E5C07B;">string</span>&gt; <span style="color: #E06C75;">query</span> = names
    .Select (n =&gt; n.Replace (<span style="color: #98C379;">"a"</span>, <span style="color: #98C379;">""</span>).Replace (<span style="color: #98C379;">"e"</span>, <span style="color: #98C379;">""</span>).Replace (<span style="color: #98C379;">"i"</span>, <span style="color: #98C379;">""</span>)
             .Replace (<span style="color: #98C379;">"o"</span>, <span style="color: #98C379;">""</span>).Replace (<span style="color: #98C379;">"u"</span>, <span style="color: #98C379;">""</span>))
    .Where (n =&gt; n.Length &gt; 2)
    .OrderBy (n =&gt; n);
</pre>
</div>

<p>
Which is equal to the standard <b>chaining</b> of operators.
</p>
</div>
</div>

<div id="outline-container-orgd760554" class="outline-3">
<h3 id="orgd760554"><span class="section-number-3">7.8</span> Mapping to objects</h3>
<div class="outline-text-3" id="text-7-8">
<p>
Mapping to a new object:
</p>

<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #E5C07B;">string</span>[] <span style="color: #E06C75;">names</span> = { <span style="color: #98C379;">"Tom"</span>, <span style="color: #98C379;">"Dick"</span>, <span style="color: #98C379;">"Harry"</span>, <span style="color: #98C379;">"Mary"</span>, <span style="color: #98C379;">"Jay"</span> };

<span style="color: #E5C07B;">IEnumerable</span>&lt;<span style="color: #E5C07B;">TempProjectionItem</span>&gt; <span style="color: #E06C75;">temp</span> =
    <span style="color: #C678DD;">from</span> n <span style="color: #C678DD;">in</span> names
    <span style="color: #C678DD;">select</span> <span style="color: #C678DD;">new</span> <span style="color: #E5C07B;">TempProjectionItem</span>
    {
        <span style="color: #E06C75;">Original</span> = n,
        <span style="color: #E06C75;">Vowelless</span> = n.Replace (<span style="color: #98C379;">"a"</span>, <span style="color: #98C379;">""</span>).Replace (<span style="color: #98C379;">"e"</span>, <span style="color: #98C379;">""</span>).Replace (<span style="color: #98C379;">"i"</span>, <span style="color: #98C379;">""</span>)
                .Replace (<span style="color: #98C379;">"o"</span>, <span style="color: #98C379;">""</span>).Replace (<span style="color: #98C379;">"u"</span>, <span style="color: #98C379;">""</span>) ?? <span style="color: #98C379;">""</span>
    };

<span style="color: #C678DD;">foreach</span> (<span style="color: #E5C07B;">var</span> <span style="color: #E06C75;">e</span> <span style="color: #C678DD;">in</span> temp)
    Console.<span style="color: #61AFEF;">WriteLine</span>(e.Original + <span style="color: #98C379;">" -- "</span> + e.Vowelless );

<span style="color: #C678DD;">class</span> <span style="color: #E5C07B;">TempProjectionItem</span>
{
    <span style="color: #C678DD;">public</span> <span style="color: #E5C07B;">string</span> <span style="color: #E06C75;">Original</span> = <span style="color: #98C379;">""</span>; <span style="color: #5C6370; font-style: italic;">// </span><span style="color: #5C6370; font-style: italic;">Original name</span>
    <span style="color: #C678DD;">public</span> <span style="color: #E5C07B;">string</span> <span style="color: #E06C75;">Vowelless</span> = <span style="color: #98C379;">""</span>; <span style="color: #5C6370; font-style: italic;">// </span><span style="color: #5C6370; font-style: italic;">Vowel-stripped name</span>
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orga4c1a05" class="outline-3">
<h3 id="orga4c1a05"><span class="section-number-3">7.9</span> Mapping with anonymous types</h3>
<div class="outline-text-3" id="text-7-9">
<p>
Same thing with anonymous class(<i>Note <code>var</code>!</i>):
</p>
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #E5C07B;">string</span>[] <span style="color: #E06C75;">names</span> = { <span style="color: #98C379;">"Tom"</span>, <span style="color: #98C379;">"Dick"</span>, <span style="color: #98C379;">"Harry"</span>, <span style="color: #98C379;">"Mary"</span>, <span style="color: #98C379;">"Jay"</span> };

<span style="color: #E5C07B;">var</span> <span style="color: #E06C75;">temp</span> =
    <span style="color: #C678DD;">from</span> n <span style="color: #C678DD;">in</span> names
    <span style="color: #C678DD;">select</span> <span style="color: #C678DD;">new</span>
    {
        <span style="color: #E06C75;">Original</span> = n,
        <span style="color: #E06C75;">Vowelless</span> = n.Replace (<span style="color: #98C379;">"a"</span>, <span style="color: #98C379;">""</span>).Replace (<span style="color: #98C379;">"e"</span>, <span style="color: #98C379;">""</span>).Replace (<span style="color: #98C379;">"i"</span>, <span style="color: #98C379;">""</span>)
                .Replace (<span style="color: #98C379;">"o"</span>, <span style="color: #98C379;">""</span>).Replace (<span style="color: #98C379;">"u"</span>, <span style="color: #98C379;">""</span>)
    };

<span style="color: #C678DD;">foreach</span> (<span style="color: #E5C07B;">var</span> <span style="color: #E06C75;">e</span> <span style="color: #C678DD;">in</span> temp)
    Console.<span style="color: #61AFEF;">WriteLine</span>(e.Original + <span style="color: #98C379;">" -- "</span> + e.Vowelless );
</pre>
</div>

<p>
Now, a reasonably tidy version with <i>query continuaton</i> for the original task:
</p>
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #E5C07B;">var</span> <span style="color: #E06C75;">query</span> = <span style="color: #C678DD;">from</span> n <span style="color: #C678DD;">in</span> names
    <span style="color: #C678DD;">select</span> <span style="color: #C678DD;">new</span>
    {
        <span style="color: #E06C75;">Original</span> = n,
        <span style="color: #E06C75;">Vowelless</span> = n.Replace (<span style="color: #98C379;">"a"</span>, <span style="color: #98C379;">""</span>).Replace (<span style="color: #98C379;">"e"</span>, <span style="color: #98C379;">""</span>).Replace (<span style="color: #98C379;">"i"</span>, <span style="color: #98C379;">""</span>)
        .Replace (<span style="color: #98C379;">"o"</span>, <span style="color: #98C379;">""</span>).Replace (<span style="color: #98C379;">"u"</span>, <span style="color: #98C379;">""</span>)
    }
    <span style="color: #C678DD;">into</span> temp
        <span style="color: #C678DD;">where</span> temp.Vowelless.Length &gt; 2
        <span style="color: #C678DD;">select</span> temp.Original;
</pre>
</div>
</div>
</div>

<div id="outline-container-orgfc171b2" class="outline-3">
<h3 id="orgfc171b2"><span class="section-number-3">7.10</span> The <code>let</code> keyword</h3>
<div class="outline-text-3" id="text-7-10">
<blockquote>
<p>
The <code>let</code> keyword introduces a new variable alongside the range variable.
</p>
</blockquote>

<p>
This creates parallel stream of mapped objects - very cool!
</p>

<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #E5C07B;">string</span>[] <span style="color: #E06C75;">names</span> = { <span style="color: #98C379;">"Tom"</span>, <span style="color: #98C379;">"Dick"</span>, <span style="color: #98C379;">"Harry"</span>, <span style="color: #98C379;">"Mary"</span>, <span style="color: #98C379;">"Jay"</span> };
<span style="color: #E5C07B;">IEnumerable</span>&lt;<span style="color: #E5C07B;">string</span>&gt; <span style="color: #E06C75;">query</span> =
    <span style="color: #C678DD;">from</span> n <span style="color: #C678DD;">in</span> names
    <span style="color: #C678DD;">let</span> vowelless = n.Replace (<span style="color: #98C379;">"a"</span>, <span style="color: #98C379;">""</span>).Replace (<span style="color: #98C379;">"e"</span>, <span style="color: #98C379;">""</span>).Replace (<span style="color: #98C379;">"i"</span>, <span style="color: #98C379;">""</span>)
    .Replace (<span style="color: #98C379;">"o"</span>, <span style="color: #98C379;">""</span>).Replace (<span style="color: #98C379;">"u"</span>, <span style="color: #98C379;">""</span>)
    <span style="color: #C678DD;">where</span> vowelless.Length &gt; 2
    <span style="color: #C678DD;">orderby</span> vowelless
    <span style="color: #C678DD;">select</span> n; <span style="color: #5C6370; font-style: italic;">// </span><span style="color: #5C6370; font-style: italic;">Thanks to let, n is still in scope.</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgdd5cdd3" class="outline-3">
<h3 id="orgdd5cdd3"><span class="section-number-3">7.11</span> [SKIPPED for now] Interpreted(DB) Queries with EF framework</h3>
<div class="outline-text-3" id="text-7-11">
<p>
[DeepDive note for EF and C# - DB interaction patterns]
</p>
</div>
</div>
</div>


<div id="outline-container-orgf2d5fc7" class="outline-2">
<h2 id="orgf2d5fc7"><span class="section-number-2">8</span> LINQ Operators</h2>
<div class="outline-text-2" id="text-8">
</div>
<div id="outline-container-org21a4eed" class="outline-3">
<h3 id="org21a4eed"><span class="section-number-3">8.1</span> Overview</h3>
<div class="outline-text-3" id="text-8-1">
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">action</th>
<th scope="col" class="org-left">signature</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">Filtering</td>
<td class="org-left"><code>IEnumerable&lt;TSource&gt; -&gt;IEnumerable&lt;TSource&gt;</code></td>
</tr>

<tr>
<td class="org-left">Projecting</td>
<td class="org-left"><code>IEnumerable&lt;TSource&gt; -&gt;  IEnumerable&lt;TResult&gt;</code></td>
</tr>

<tr>
<td class="org-left">Join and GroupJoin</td>
<td class="org-left"><code>IEnumerable&lt;TOuter&gt;, IEnumerable&lt;TInner&gt; -&gt; IEnumerable&lt;TResult&gt;</code></td>
</tr>

<tr>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
</tr>
</tbody>
</table>
</div>
</div>

<div id="outline-container-org5590f1a" class="outline-3">
<h3 id="org5590f1a"><span class="section-number-3">8.2</span> Examples</h3>
<div class="outline-text-3" id="text-8-2">
<p>
Indexed filtering:
</p>
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #E5C07B;">IEnumerable</span>&lt;<span style="color: #E5C07B;">string</span>&gt; <span style="color: #E06C75;">query</span> = names.Where ((n, i) =&gt; i % 2 == 0);
</pre>
</div>

<p>
Stop stream after a predicate flip:
</p>
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #E5C07B;">int</span>[] <span style="color: #E06C75;">numbers</span> = { 3, 5, 2, 234, 4, 1 };
<span style="color: #E5C07B;">var</span> <span style="color: #E06C75;">takeWhileSmall</span> = numbers.TakeWhile (n =&gt; n &lt; 100);
</pre>
</div>

<p>
Distinct results of lambda:
</p>
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #C678DD;">new</span>[] { 1.0, 1.1, 2.0, 2.1, 3.0, 3.1 }.DistinctBy (n =&gt; Math.Round (n, 0));
</pre>
</div>

<p>
Indexed projection:
</p>
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #E5C07B;">string</span>[] <span style="color: #E06C75;">names</span> = { <span style="color: #98C379;">"Tom"</span>, <span style="color: #98C379;">"Dick"</span>, <span style="color: #98C379;">"Harry"</span>, <span style="color: #98C379;">"Mary"</span>, <span style="color: #98C379;">"Jay"</span> };

<span style="color: #E5C07B;">IEnumerable</span>&lt;<span style="color: #E5C07B;">string</span>&gt; <span style="color: #E06C75;">query</span> = names
    .Select ((s,i) =&gt; i + <span style="color: #98C379;">"="</span> + s); <span style="color: #5C6370; font-style: italic;">// </span><span style="color: #5C6370; font-style: italic;">{ "0=Tom", "1=Dick", ... }</span>
</pre>
</div>

<p>
<i>correlated subquery</i> - subquery is using a var from the top query:
</p>
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #E5C07B;">string</span> <span style="color: #E06C75;">tempPath</span> = Path.<span style="color: #61AFEF;">GetTempPath</span>();
<span style="color: #E5C07B;">DirectoryInfo</span>[] <span style="color: #E06C75;">dirs</span> = <span style="color: #C678DD;">new</span> <span style="color: #E5C07B;">DirectoryInfo</span> (tempPath).<span style="color: #61AFEF;">GetDirectories</span>();

<span style="color: #E5C07B;">var</span> <span style="color: #E06C75;">query</span> =
    <span style="color: #C678DD;">from</span> d <span style="color: #C678DD;">in</span> dirs
    <span style="color: #C678DD;">where</span> (d.Attributes &amp; FileAttributes.System) == 0
    <span style="color: #C678DD;">select</span> <span style="color: #C678DD;">new</span>
    {
        <span style="color: #E06C75;">DirectoryName</span> = d.FullName,
        <span style="color: #E06C75;">Created</span> = d.CreationTime,
        <span style="color: #E06C75;">Files</span> = <span style="color: #C678DD;">from</span> f <span style="color: #C678DD;">in</span> d.<span style="color: #61AFEF;">GetFiles</span>()
        <span style="color: #C678DD;">where</span> (f.Attributes &amp; FileAttributes.Hidden) == 0
        <span style="color: #C678DD;">select</span> <span style="color: #C678DD;">new</span> { FileName = f.Name, f.Length, }
    };

<span style="color: #C678DD;">foreach</span> (<span style="color: #E5C07B;">var</span> <span style="color: #E06C75;">dirFiles</span> <span style="color: #C678DD;">in</span> query)
{
    Console.WriteLine (<span style="color: #98C379;">"Directory: "</span> + dirFiles.DirectoryName);

    <span style="color: #C678DD;">foreach</span> (<span style="color: #E5C07B;">var</span> <span style="color: #E06C75;">file</span> <span style="color: #C678DD;">in</span> dirFiles.Files)
        Console.WriteLine (<span style="color: #98C379;">" "</span> + file.FileName + <span style="color: #98C379;">" Len: "</span> + file.Length);
}
</pre>
</div>

<p>
<code>SelectMany</code> = <code>FlatMap</code>:
</p>
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #E5C07B;">string</span>[] <span style="color: #E06C75;">fullNames</span> = { <span style="color: #98C379;">"Anne Williams"</span>, <span style="color: #98C379;">"John Fred Smith"</span>, <span style="color: #98C379;">"Sue Green"</span> };

<span style="color: #E5C07B;">IEnumerable</span>&lt;<span style="color: #E5C07B;">string</span>&gt; <span style="color: #E06C75;">query</span> = fullNames.SelectMany (name =&gt; name.<span style="color: #61AFEF;">Split</span>());

<span style="color: #C678DD;">foreach</span> (<span style="color: #E5C07B;">string</span> <span style="color: #E06C75;">name</span> <span style="color: #C678DD;">in</span> query)
    Console.Write (name + <span style="color: #98C379;">"|"</span>); <span style="color: #5C6370; font-style: italic;">// </span><span style="color: #5C6370; font-style: italic;">Anne|Williams|John|Fred|Smith|Sue|Green|</span>
</pre>
</div>

<p>
Query syntax with the same result:
</p>
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #E5C07B;">IEnumerable</span>&lt;<span style="color: #E5C07B;">string</span>&gt; <span style="color: #E06C75;">query</span> =
    <span style="color: #C678DD;">from</span> fullName <span style="color: #C678DD;">in</span> fullNames
    <span style="color: #C678DD;">from</span> name <span style="color: #C678DD;">in</span> fullName.<span style="color: #61AFEF;">Split</span>() <span style="color: #5C6370; font-style: italic;">// </span><span style="color: #5C6370; font-style: italic;">Translates to SelectMany</span>
    <span style="color: #C678DD;">select</span> name;
</pre>
</div>

<p>
Multiple range variables:
</p>

<p>
Operator syntax (need anonymous object mapping!):
</p>
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #E5C07B;">IEnumerable</span>&lt;<span style="color: #E5C07B;">string</span>&gt; <span style="color: #E06C75;">query</span> = fullNames
    .SelectMany (fName =&gt; fName.<span style="color: #61AFEF;">Split</span>()
                 .Select (name =&gt; <span style="color: #C678DD;">new</span> { <span style="color: #E06C75;">name</span>, <span style="color: #E06C75;">fName</span> } ))
    .OrderBy (x =&gt; x.fName)
    .ThenBy (x =&gt; x.name)
    .Select (x =&gt; x.name + <span style="color: #98C379;">" came from "</span> + x.fName);
</pre>
</div>

<p>
Query syntaxt (easier with orginal values elements being in scope):
</p>
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #C678DD;">from</span> fullName <span style="color: #C678DD;">in</span> fullNames
    <span style="color: #C678DD;">from</span> name <span style="color: #C678DD;">in</span> fullName.<span style="color: #61AFEF;">Split</span>()
    <span style="color: #C678DD;">orderby</span> fullName, name
    <span style="color: #C678DD;">select</span> name + <span style="color: #98C379;">" came from "</span> + fullName;
</pre>
</div>

<p>
Full example:
</p>
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #E5C07B;">string</span>[] <span style="color: #E06C75;">fullNames</span> = { <span style="color: #98C379;">"Anne Williams"</span>, <span style="color: #98C379;">"John Fred Smith"</span>, <span style="color: #98C379;">"Sue Green"</span> };

<span style="color: #E5C07B;">IEnumerable</span>&lt;<span style="color: #E5C07B;">string</span>&gt; <span style="color: #E06C75;">query</span> =
    <span style="color: #C678DD;">from</span> fullName <span style="color: #C678DD;">in</span> fullNames
    <span style="color: #C678DD;">from</span> name <span style="color: #C678DD;">in</span> fullName.<span style="color: #61AFEF;">Split</span>()
    <span style="color: #C678DD;">orderby</span> fullName, <span style="color: #E06C75;">name</span>
    <span style="color: #C678DD;">select</span> name + <span style="color: #98C379;">" came from "</span> + fullName;

<span style="color: #C678DD;">foreach</span> (<span style="color: #E5C07B;">var</span> <span style="color: #E06C75;">s</span> <span style="color: #C678DD;">in</span> query)
    Console.<span style="color: #61AFEF;">WriteLine</span>(s);
</pre>
</div>

<p>
Result:
</p>
<div class="org-src-container">
<pre class="src src-shell">Anne came from Anne Williams
Williams came from Anne Williams
Fred came from John Fred Smith
John came from John Fred Smith
Smith came from John Fred Smith
Green came from Sue Green
Sue came from Sue Green
</pre>
</div>

<p>
(<i>Pattern</i>) Expanding and Flattening subsequences
</p>

<p>
<i>pervious example</i>
</p>

<p>
(<i>Pattern</i>) Cartsian product, or cross joint
</p>

<p>
solution: additional selector is unrelated to the one before:
</p>
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #E5C07B;">int</span>[] <span style="color: #E06C75;">numbers</span> = { 1, 2, 3 }; <span style="color: #E5C07B;">string</span>[] <span style="color: #E06C75;">letters</span> = { <span style="color: #98C379;">"a"</span>, <span style="color: #98C379;">"b"</span> };

<span style="color: #E5C07B;">IEnumerable</span>&lt;<span style="color: #E5C07B;">string</span>&gt; <span style="color: #E06C75;">query</span> =
    <span style="color: #C678DD;">from</span> n <span style="color: #C678DD;">in</span> numbers
    <span style="color: #C678DD;">from</span> l <span style="color: #C678DD;">in</span> letters
    <span style="color: #C678DD;">select</span> n.<span style="color: #61AFEF;">ToString</span>() + l;
<span style="color: #5C6370; font-style: italic;">// </span><span style="color: #5C6370; font-style: italic;">RESULT: { "1a", "1b", "2a", "2b", "3a", "3b" }</span>
</pre>
</div>

<p>
Joining with <i>joint condition</i>:
</p>
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #E5C07B;">IEnumerable</span>&lt;<span style="color: #E5C07B;">string</span>&gt; <span style="color: #E06C75;">query</span> = <span style="color: #C678DD;">from</span> name1 <span style="color: #C678DD;">in</span> players
    <span style="color: #C678DD;">from</span> name2 <span style="color: #C678DD;">in</span> players
    <span style="color: #C678DD;">where</span> name1.CompareTo (name2) &lt; 0
    <span style="color: #C678DD;">orderby</span> name1, <span style="color: #E06C75;">name2</span>
    <span style="color: #C678DD;">select</span> name1 + <span style="color: #98C379;">" vs "</span> + name2;
<span style="color: #5C6370; font-style: italic;">//</span><span style="color: #5C6370; font-style: italic;">RESULT: { "Jay vs Mary", "Jay vs Tom", "Mary vs Tom" }</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgef755fa" class="outline-3">
<h3 id="orgef755fa"><span class="section-number-3">8.3</span> Join with a simple key</h3>
<div class="outline-text-3" id="text-8-3">
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #E5C07B;">Person</span> <span style="color: #E06C75;">magnus</span> = <span style="color: #C678DD;">new</span>(FirstName: <span style="color: #98C379;">"Magnus"</span>, LastName: <span style="color: #98C379;">"Hedlund"</span>);
<span style="color: #E5C07B;">Person</span> <span style="color: #E06C75;">terry</span> = <span style="color: #C678DD;">new</span>(<span style="color: #98C379;">"Terry"</span>, <span style="color: #98C379;">"Adams"</span>);
<span style="color: #E5C07B;">Person</span> <span style="color: #E06C75;">charlotte</span> = <span style="color: #C678DD;">new</span>(<span style="color: #98C379;">"Charlotte"</span>, <span style="color: #98C379;">"Weiss"</span>);
<span style="color: #E5C07B;">Person</span> <span style="color: #E06C75;">arlene</span> = <span style="color: #C678DD;">new</span>(<span style="color: #98C379;">"Arlene"</span>, <span style="color: #98C379;">"Huff"</span>);
<span style="color: #E5C07B;">Person</span> <span style="color: #E06C75;">rui</span> = <span style="color: #C678DD;">new</span>(<span style="color: #98C379;">"Rui"</span>, <span style="color: #98C379;">"Raposo"</span>);

<span style="color: #E5C07B;">List</span>&lt;<span style="color: #E5C07B;">Person</span>&gt; <span style="color: #E06C75;">people</span> = <span style="color: #C678DD;">new</span>() { <span style="color: #E06C75;">magnus</span>, <span style="color: #E06C75;">terry</span>, <span style="color: #E06C75;">charlotte</span>, <span style="color: #E06C75;">arlene</span>, <span style="color: #E06C75;">rui</span> };

<span style="color: #E5C07B;">List</span>&lt;<span style="color: #E5C07B;">Pet</span>&gt; <span style="color: #E06C75;">pets</span> = <span style="color: #C678DD;">new</span>()
{
    <span style="color: #C678DD;">new</span>(Name: <span style="color: #98C379;">"Barley"</span>, Owner: terry),
    <span style="color: #C678DD;">new</span>(<span style="color: #98C379;">"Boots"</span>, terry),
    <span style="color: #C678DD;">new</span>(<span style="color: #98C379;">"Whiskers"</span>, charlotte),
    <span style="color: #C678DD;">new</span>(<span style="color: #98C379;">"Blue Moon"</span>, rui),
    <span style="color: #C678DD;">new</span>(<span style="color: #98C379;">"Daisy"</span>, magnus),
};

<span style="color: #E5C07B;">var</span> <span style="color: #E06C75;">query</span> =
    <span style="color: #C678DD;">from</span> person <span style="color: #C678DD;">in</span> people
    <span style="color: #C678DD;">join</span> pet <span style="color: #C678DD;">in</span> pets <span style="color: #C678DD;">on</span> person <span style="color: #C678DD;">equals</span> pet.Owner
    <span style="color: #C678DD;">select</span> <span style="color: #C678DD;">new</span>
    {
        <span style="color: #E06C75;">OwnerName</span> = person.FirstName,
        <span style="color: #E06C75;">PetName</span> = pet.Name
    };

<span style="color: #C678DD;">foreach</span> (<span style="color: #E5C07B;">var</span> <span style="color: #E06C75;">ownerAndPet</span> <span style="color: #C678DD;">in</span> query)
{
    Console.<span style="color: #61AFEF;">WriteLine</span>($<span style="color: #98C379;">"{ownerAndPet.PetName} is owned by {ownerAndPet.OwnerName}"</span>);
}

<span style="color: #E5C07B;">record</span> <span style="color: #61AFEF;">Person</span>(<span style="color: #E5C07B;">string</span> <span style="color: #E06C75;">FirstName</span>, <span style="color: #E5C07B;">string</span> <span style="color: #E06C75;">LastName</span>);
<span style="color: #E5C07B;">record</span> <span style="color: #61AFEF;">Pet</span>(<span style="color: #E5C07B;">string</span> <span style="color: #E06C75;">Name</span>, <span style="color: #E5C07B;">Person</span> <span style="color: #E06C75;">Owner</span>);
</pre>
</div>

<p>
Note that result does not include "Huff" since no Pet object references it Person object.
</p>

<div class="org-src-container">
<pre class="src src-shell">Daisy is owned by Magnus
Barley is owned by Terry
Boots is owned by Terry
Whiskers is owned by Charlotte
Blue Moon is owned by Rui
</pre>
</div>
</div>
</div>

<div id="outline-container-orgb722f23" class="outline-3">
<h3 id="orgb722f23"><span class="section-number-3">8.4</span> Multiple join with composite key</h3>
<div class="outline-text-3" id="text-8-4">
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #E5C07B;">Person</span> <span style="color: #E06C75;">magnus</span> = <span style="color: #C678DD;">new</span>(FirstName: <span style="color: #98C379;">"Magnus"</span>, LastName: <span style="color: #98C379;">"Hedlund"</span>);
<span style="color: #E5C07B;">Person</span> <span style="color: #E06C75;">terry</span> = <span style="color: #C678DD;">new</span>(<span style="color: #98C379;">"Terry"</span>, <span style="color: #98C379;">"Adams"</span>);
<span style="color: #E5C07B;">Person</span> <span style="color: #E06C75;">charlotte</span> = <span style="color: #C678DD;">new</span>(<span style="color: #98C379;">"Charlotte"</span>, <span style="color: #98C379;">"Weiss"</span>);
<span style="color: #E5C07B;">Person</span> <span style="color: #E06C75;">arlene</span> = <span style="color: #C678DD;">new</span>(<span style="color: #98C379;">"Arlene"</span>, <span style="color: #98C379;">"Huff"</span>);
<span style="color: #E5C07B;">Person</span> <span style="color: #E06C75;">rui</span> = <span style="color: #C678DD;">new</span>(<span style="color: #98C379;">"Rui"</span>, <span style="color: #98C379;">"Raposo"</span>);
<span style="color: #E5C07B;">Person</span> <span style="color: #E06C75;">phyllis</span> = <span style="color: #C678DD;">new</span>(<span style="color: #98C379;">"Phyllis"</span>, <span style="color: #98C379;">"Harris"</span>);

<span style="color: #E5C07B;">List</span>&lt;<span style="color: #E5C07B;">Person</span>&gt; <span style="color: #E06C75;">people</span> = <span style="color: #C678DD;">new</span>() { <span style="color: #E06C75;">magnus</span>, <span style="color: #E06C75;">terry</span>, <span style="color: #E06C75;">charlotte</span>, <span style="color: #E06C75;">arlene</span>, <span style="color: #E06C75;">rui</span>, <span style="color: #E06C75;">phyllis</span> };

<span style="color: #E5C07B;">List</span>&lt;<span style="color: #E5C07B;">Cat</span>&gt; <span style="color: #E06C75;">cats</span> = <span style="color: #C678DD;">new</span>()
{
    <span style="color: #C678DD;">new</span>(Name: <span style="color: #98C379;">"Barley"</span>, Owner: terry),
    <span style="color: #C678DD;">new</span>(<span style="color: #98C379;">"Boots"</span>, terry),
    <span style="color: #C678DD;">new</span>(<span style="color: #98C379;">"Whiskers"</span>, charlotte),
    <span style="color: #C678DD;">new</span>(<span style="color: #98C379;">"Blue Moon"</span>, rui),
    <span style="color: #C678DD;">new</span>(<span style="color: #98C379;">"Daisy"</span>, magnus),
};

<span style="color: #E5C07B;">List</span>&lt;<span style="color: #E5C07B;">Dog</span>&gt; <span style="color: #E06C75;">dogs</span> = <span style="color: #C678DD;">new</span>()
{
    <span style="color: #C678DD;">new</span>(Name: <span style="color: #98C379;">"Four Wheel Drive"</span>, Owner: phyllis),
    <span style="color: #C678DD;">new</span>(<span style="color: #98C379;">"Duke"</span>, magnus),
    <span style="color: #C678DD;">new</span>(<span style="color: #98C379;">"Denim"</span>, terry),
    <span style="color: #C678DD;">new</span>(<span style="color: #98C379;">"Wiley"</span>, charlotte),
    <span style="color: #C678DD;">new</span>(<span style="color: #98C379;">"Snoopy"</span>, rui),
    <span style="color: #C678DD;">new</span>(<span style="color: #98C379;">"Snickers"</span>, arlene),
};

<span style="color: #5C6370; font-style: italic;">// </span><span style="color: #5C6370; font-style: italic;">The first join matches Person and Cat.Owner from the list of people and</span>
<span style="color: #5C6370; font-style: italic;">// </span><span style="color: #5C6370; font-style: italic;">cats, based on a common Person. The second join matches dogs whose names start</span>
<span style="color: #5C6370; font-style: italic;">// </span><span style="color: #5C6370; font-style: italic;">with the same letter as the cats that have the same owner.</span>
<span style="color: #E5C07B;">var</span> <span style="color: #E06C75;">query</span> =
    <span style="color: #C678DD;">from</span> person <span style="color: #C678DD;">in</span> people
    <span style="color: #C678DD;">join</span> cat <span style="color: #C678DD;">in</span> cats <span style="color: #C678DD;">on</span> person <span style="color: #C678DD;">equals</span> cat.Owner
    <span style="color: #C678DD;">join</span> dog <span style="color: #C678DD;">in</span> dogs <span style="color: #C678DD;">on</span> <span style="color: #C678DD;">new</span>
    {
        <span style="color: #E06C75;">Owner</span> = person,
        <span style="color: #E06C75;">Letter</span> = cat.Name.<span style="color: #61AFEF;">Substring</span>(0, 1)
    } <span style="color: #C678DD;">equals</span> <span style="color: #C678DD;">new</span>
    {
        dog.<span style="color: #E06C75;">Owner</span>,
        <span style="color: #E06C75;">Letter</span> = dog.Name.<span style="color: #61AFEF;">Substring</span>(0, 1)
    }
    <span style="color: #C678DD;">select</span> <span style="color: #C678DD;">new</span>
    {
        <span style="color: #E06C75;">CatName</span> = cat.Name,
        <span style="color: #E06C75;">DogName</span> = dog.Name
    };

<span style="color: #C678DD;">foreach</span> (<span style="color: #E5C07B;">var</span> <span style="color: #E06C75;">obj</span> <span style="color: #C678DD;">in</span> query)
{
    Console.<span style="color: #61AFEF;">WriteLine</span>(
        $<span style="color: #98C379;">"The cat \"{obj.CatName}\" shares a house, and the first letter of their name, with \"{obj.DogName}\"."</span>
    );
}

<span style="color: #E5C07B;">record</span> <span style="color: #61AFEF;">Person</span>(<span style="color: #E5C07B;">string</span> <span style="color: #E06C75;">FirstName</span>, <span style="color: #E5C07B;">string</span> <span style="color: #E06C75;">LastName</span>);
<span style="color: #E5C07B;">record</span> <span style="color: #61AFEF;">Pet</span>(<span style="color: #E5C07B;">string</span> <span style="color: #E06C75;">Name</span>, <span style="color: #E5C07B;">Person</span> <span style="color: #E06C75;">Owner</span>);
<span style="color: #E5C07B;">record</span> <span style="color: #61AFEF;">Cat</span>(<span style="color: #E5C07B;">string</span> <span style="color: #E06C75;">Name</span>, <span style="color: #E5C07B;">Person</span> <span style="color: #E06C75;">Owner</span>) : <span style="color: #61AFEF;">Pet</span>(Name, Owner);
<span style="color: #E5C07B;">record</span> <span style="color: #61AFEF;">Dog</span>(<span style="color: #E5C07B;">string</span> <span style="color: #E06C75;">Name</span>, <span style="color: #E5C07B;">Person</span> <span style="color: #E06C75;">Owner</span>) : <span style="color: #61AFEF;">Pet</span>(Name, Owner);
</pre>
</div>
</div>
</div>

<div id="outline-container-org1639464" class="outline-3">
<h3 id="org1639464"><span class="section-number-3">8.5</span> <code>join</code> clause</h3>
<div class="outline-text-3" id="text-8-5">
<p>
<a href="https://learn.microsoft.com/en-us/dotnet/csharp/language-reference/keywords/join-clause">Reference</a>
</p>

<blockquote>
<p>
The <code>join</code> clause is useful for associating elements from different source sequences that have no direct relationship in the object model. The only requirement is that the elements in each source share some value that can be compared for equality
</p>
</blockquote>

<blockquote>
<p>
A <code>join</code> clause takes two source sequences as input. The elements in each sequence must either be or contain a property that can be compared to a corresponding property in the other sequence. The join clause compares the specified keys for equality by using the special equals keyword. All joins performed by the join clause are equijoins.
</p>
</blockquote>
</div>

<div id="outline-container-orgab62b94" class="outline-4">
<h4 id="orgab62b94"><span class="section-number-4">8.5.1</span> Inner join</h4>
<div class="outline-text-4" id="text-8-5-1">
<blockquote>
<p>
entityA.ID == entityB.ID
==&gt; List&lt; entityA - entytyB&gt;
</p>
</blockquote>

<p>
Query expression:
</p>
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #E5C07B;">var</span> <span style="color: #E06C75;">innerJoinQuery</span> =
    <span style="color: #C678DD;">from</span> category <span style="color: #C678DD;">in</span> categories
    <span style="color: #C678DD;">join</span> prod <span style="color: #C678DD;">in</span> products <span style="color: #C678DD;">on</span> category.ID <span style="color: #C678DD;">equals</span> prod.CategoryID
    <span style="color: #C678DD;">select</span> <span style="color: #C678DD;">new</span> {<span style="color: #E06C75;">ProductName</span> = prod.Name, <span style="color: #E06C75;">CategoryName</span> = category.Name };

Console.<span style="color: #61AFEF;">WriteLine</span>();
Console.<span style="color: #61AFEF;">WriteLine</span>($<span style="color: #98C379;">"inner join ({innerJoinQuery.Count()}):"</span>);

<span style="color: #C678DD;">foreach</span> (<span style="color: #E5C07B;">var</span> <span style="color: #E06C75;">r</span> <span style="color: #C678DD;">in</span> innerJoinQuery)
{
    Console.<span style="color: #61AFEF;">WriteLine</span>(r);
}
</pre>
</div>



<p>
Result:
</p>
<div class="org-src-container">
<pre class="src src-shell">inner join (8):
{ ProductName = Cola, CategoryName = Beverages }
{ ProductName = Tea, CategoryName = Beverages }
{ ProductName = Mustard, CategoryName = Condiments }
{ ProductName = Pickles, CategoryName = Condiments }
{ ProductName = Carrots, CategoryName = Vegetables }
{ ProductName = Bok Choy, CategoryName = Vegetables }
{ ProductName = Peaches, CategoryName = Fruit }
{ ProductName = Melons, CategoryName = Fruit }
</pre>
</div>
</div>
</div>

<div id="outline-container-org0840788" class="outline-4">
<h4 id="org0840788"><span class="section-number-4">8.5.2</span> Group join</h4>
<div class="outline-text-4" id="text-8-5-2">
<blockquote>
<p>
entityA.ID == entityB.ID
</p>

<p>
==&gt; entityA.ID - List&lt;entityB&gt;
</p>
</blockquote>

<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #E5C07B;">var</span> <span style="color: #E06C75;">groupJoinQuery</span> =
    <span style="color: #C678DD;">from</span> category <span style="color: #C678DD;">in</span> categories
    <span style="color: #C678DD;">join</span> prod <span style="color: #C678DD;">in</span> products <span style="color: #C678DD;">on</span> category.ID <span style="color: #C678DD;">equals</span> prod.CategoryID <span style="color: #C678DD;">into</span> prodGroup
    <span style="color: #C678DD;">select</span> <span style="color: #C678DD;">new</span> {<span style="color: #E06C75;">CategoryName</span> = category.Name, <span style="color: #E06C75;">ProductCount</span> = prodGroup.<span style="color: #61AFEF;">Count</span>()};

Console.<span style="color: #61AFEF;">WriteLine</span>();
Console.<span style="color: #61AFEF;">WriteLine</span>($<span style="color: #98C379;">"group join ({groupJoinQuery.Count()}):"</span>);

<span style="color: #C678DD;">foreach</span> (<span style="color: #E5C07B;">var</span> <span style="color: #E06C75;">cp</span> <span style="color: #C678DD;">in</span> groupJoinQuery)
{
    Console.<span style="color: #61AFEF;">WriteLine</span>(cp);
}
</pre>
</div>

<p>
Result:
</p>
<div class="org-src-container">
<pre class="src src-shell">group join (5):
{ CategoryName = Beverages, ProductCount = 2 }
{ CategoryName = Condiments, ProductCount = 2 }
{ CategoryName = Vegetables, ProductCount = 2 }
{ CategoryName = Grains, ProductCount = 0 }
{ CategoryName = Fruit, ProductCount = 2 }
</pre>
</div>
</div>
</div>

<div id="outline-container-orgf3d3f3d" class="outline-4">
<h4 id="orgf3d3f3d"><span class="section-number-4">8.5.3</span> Left outer join</h4>
<div class="outline-text-4" id="text-8-5-3">
<blockquote>
<p>
entityA.ID == entityB.ID OR NULL
</p>

<p>
==&gt; entityA.ID - (entityB.ID OR Default)
</p>
</blockquote>

<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #E5C07B;">var</span> <span style="color: #E06C75;">leftOuterJoinQuery</span> =
    <span style="color: #C678DD;">from</span> category <span style="color: #C678DD;">in</span> categories
    <span style="color: #C678DD;">join</span> prod <span style="color: #C678DD;">in</span> products <span style="color: #C678DD;">on</span> category.ID <span style="color: #C678DD;">equals</span> prod.CategoryID <span style="color: #C678DD;">into</span> prodGroup
    <span style="color: #C678DD;">from</span> item <span style="color: #C678DD;">in</span> prodGroup.<span style="color: #61AFEF;">DefaultIfEmpty</span>( <span style="color: #56B6C2;">null</span> )
    <span style="color: #C678DD;">select</span> <span style="color: #C678DD;">new</span> {<span style="color: #E06C75;">CategoryName</span> = category.Name, <span style="color: #E06C75;">Product</span> = item?.Name ?? <span style="color: #98C379;">"NOTHING!"</span>};

Console.<span style="color: #61AFEF;">WriteLine</span>();
Console.<span style="color: #61AFEF;">WriteLine</span>($<span style="color: #98C379;">"left outer join ({leftOuterJoinQuery.Count()}):"</span>);

<span style="color: #C678DD;">foreach</span> (<span style="color: #E5C07B;">var</span> <span style="color: #E06C75;">e</span> <span style="color: #C678DD;">in</span> leftOuterJoinQuery) {
    Console.<span style="color: #61AFEF;">WriteLine</span>(e);
}
</pre>
</div>

<p>
Result:
</p>

<div class="org-src-container">
<pre class="src src-shell">left outer join (9):
{ CategoryName = Beverages, Product = Cola }
{ CategoryName = Beverages, Product = Tea }
{ CategoryName = Condiments, Product = Mustard }
{ CategoryName = Condiments, Product = Pickles }
{ CategoryName = Vegetables, Product = Carrots }
{ CategoryName = Vegetables, Product = Bok Choy }
{ CategoryName = Grains, Product = NOTHING! }
{ CategoryName = Fruit, Product = Peaches }
{ CategoryName = Fruit, Product = Melons }
</pre>
</div>
</div>
</div>

<div id="outline-container-org8f00386" class="outline-4">
<h4 id="org8f00386"><span class="section-number-4">8.5.4</span> <i>source data for examples above</i></h4>
<div class="outline-text-4" id="text-8-5-4">
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #C678DD;">using</span> <span style="color: #E06C75;">System</span>;
<span style="color: #C678DD;">using</span> <span style="color: #E06C75;">System</span>.<span style="color: #E06C75;">Collections</span>.<span style="color: #E06C75;">Generic</span>;
<span style="color: #C678DD;">using</span> <span style="color: #E06C75;">System</span>.<span style="color: #E06C75;">Linq</span>;

Console.<span style="color: #61AFEF;">WriteLine</span>(<span style="color: #C678DD;">new</span> <span style="color: #E5C07B;">string</span>(<span style="color: #98C379;">'='</span>, 15));
Console.<span style="color: #61AFEF;">WriteLine</span>();

<span style="color: #E5C07B;">List</span>&lt;<span style="color: #E5C07B;">Category</span>&gt; <span style="color: #E06C75;">categories</span> = <span style="color: #C678DD;">new</span>() {
    <span style="color: #C678DD;">new</span>(Name: <span style="color: #98C379;">"Beverages"</span>, ID: 001),
    <span style="color: #C678DD;">new</span>(Name: <span style="color: #98C379;">"Condiments"</span>, ID: 002),
    <span style="color: #C678DD;">new</span>(Name: <span style="color: #98C379;">"Vegetables"</span>, ID: 003),
    <span style="color: #C678DD;">new</span>(Name: <span style="color: #98C379;">"Grains"</span>, ID: 004),
    <span style="color: #C678DD;">new</span>(Name: <span style="color: #98C379;">"Fruit"</span>, ID: 005),
};

<span style="color: #E5C07B;">List</span>&lt;<span style="color: #E5C07B;">Product</span>&gt; <span style="color: #E06C75;">products</span> = <span style="color: #C678DD;">new</span>() {
    <span style="color: #C678DD;">new</span>(Name: <span style="color: #98C379;">"Cola"</span>,  CategoryID: 001),
    <span style="color: #C678DD;">new</span>(Name: <span style="color: #98C379;">"Tea"</span>,  CategoryID: 001),
    <span style="color: #C678DD;">new</span>(Name: <span style="color: #98C379;">"Mustard"</span>, CategoryID: 002),
    <span style="color: #C678DD;">new</span>(Name: <span style="color: #98C379;">"Pickles"</span>, CategoryID: 002),
    <span style="color: #C678DD;">new</span>(Name: <span style="color: #98C379;">"Carrots"</span>, CategoryID: 003),
    <span style="color: #C678DD;">new</span>(Name: <span style="color: #98C379;">"Bok Choy"</span>, CategoryID: 003),
    <span style="color: #C678DD;">new</span>(Name: <span style="color: #98C379;">"Peaches"</span>, CategoryID: 005),
    <span style="color: #C678DD;">new</span>(Name: <span style="color: #98C379;">"Melons"</span>, CategoryID: 005),
};

<span style="color: #5C6370; font-style: italic;">// </span><span style="color: #5C6370; font-style: italic;">... QUERY CODE ...</span>

<span style="color: #E5C07B;">record</span> <span style="color: #61AFEF;">Category</span> (<span style="color: #E5C07B;">string</span> <span style="color: #E06C75;">Name</span>, <span style="color: #E5C07B;">int</span> <span style="color: #E06C75;">ID</span>);
<span style="color: #E5C07B;">record</span> <span style="color: #61AFEF;">Product</span> (<span style="color: #E5C07B;">string</span> <span style="color: #E06C75;">Name</span>, <span style="color: #E5C07B;">int</span> <span style="color: #E06C75;">CategoryID</span>);
</pre>
</div>
</div>
</div>
</div>


<div id="outline-container-orga9c271d" class="outline-3">
<h3 id="orga9c271d"><span class="section-number-3">8.6</span> <code>group by</code> clause</h3>
<div class="outline-text-3" id="text-8-6">
<p>
Group by a composite key:
</p>
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #E5C07B;">List</span>&lt;<span style="color: #E5C07B;">Plate</span>&gt; <span style="color: #E06C75;">plates</span> = <span style="color: #C678DD;">new</span> ()
{
    <span style="color: #C678DD;">new</span>(Name: <span style="color: #98C379;">"plate1"</span>, Requirement: <span style="color: #C678DD;">new</span> (Name: <span style="color: #98C379;">"REQ001"</span>, ID: 001)),
    <span style="color: #C678DD;">new</span>(Name: <span style="color: #98C379;">"plate2"</span>, Requirement: <span style="color: #C678DD;">new</span> (Name: <span style="color: #98C379;">"REQ001"</span>, ID: 001)),
    <span style="color: #C678DD;">new</span>(Name: <span style="color: #98C379;">"plate3"</span>, Requirement: <span style="color: #C678DD;">new</span> (Name: <span style="color: #98C379;">"REQ002"</span>, ID: 002)),
    <span style="color: #C678DD;">new</span>(Name: <span style="color: #98C379;">"plate4"</span>, Requirement: <span style="color: #C678DD;">new</span> (Name: <span style="color: #98C379;">"REQ003"</span>, ID: 003)),
    <span style="color: #C678DD;">new</span>(Name: <span style="color: #98C379;">"plate5"</span>, Requirement: <span style="color: #C678DD;">new</span> (Name: <span style="color: #98C379;">"REQ003"</span>, ID: 003)),
};

<span style="color: #E5C07B;">var</span> <span style="color: #E06C75;">groupByRequirement</span> =
    <span style="color: #C678DD;">from</span> plate <span style="color: #C678DD;">in</span> plates
    <span style="color: #C678DD;">group</span> plate <span style="color: #C678DD;">by</span> <span style="color: #C678DD;">new</span>
    {
        <span style="color: #E06C75;">ReqID</span> = plate.Requirement.ID,
        <span style="color: #E06C75;">ReqName</span> = plate.Requirement.Name
    };

<span style="color: #C678DD;">foreach</span> (<span style="color: #E5C07B;">var</span> <span style="color: #E06C75;">g</span> <span style="color: #C678DD;">in</span> groupByRequirement)
{
    Console.<span style="color: #61AFEF;">WriteLine</span>($<span style="color: #98C379;">"ID: {g.Key.ReqID} Name: {g.Key.ReqName}"</span>);
    <span style="color: #C678DD;">foreach</span> (<span style="color: #E5C07B;">var</span> <span style="color: #E06C75;">s</span> <span style="color: #C678DD;">in</span> g)
    {
        Console.<span style="color: #61AFEF;">WriteLine</span>($<span style="color: #98C379;">"\t {s}"</span>);
    }
}

<span style="color: #E5C07B;">record</span> <span style="color: #61AFEF;">Requirement</span> (<span style="color: #E5C07B;">string</span> <span style="color: #E06C75;">Name</span>, <span style="color: #E5C07B;">int</span> <span style="color: #E06C75;">ID</span>);
<span style="color: #E5C07B;">record</span> <span style="color: #61AFEF;">Plate</span> (<span style="color: #E5C07B;">string</span> <span style="color: #E06C75;">Name</span>, <span style="color: #E5C07B;">Requirement</span> <span style="color: #E06C75;">Requirement</span>);
</pre>
</div>
</div>
</div>



<div id="outline-container-orgaf78e50" class="outline-3">
<h3 id="orgaf78e50"><span class="section-number-3">8.7</span> Generation Methods</h3>
<div class="outline-text-3" id="text-8-7">
<p>
Cool example of using <code>Empty</code> to enable a generic <code>SelectMany</code>.
</p>

<p>
Thus will fail with an exception
</p>
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #E5C07B;">int</span>[][] <span style="color: #E06C75;">numbers</span> =
{
    <span style="color: #C678DD;">new</span> <span style="color: #E5C07B;">int</span>[] { 1, 2, 3 },
    <span style="color: #C678DD;">new</span> <span style="color: #E5C07B;">int</span>[] { 4, 5, 6 },
    <span style="color: #56B6C2;">null</span> <span style="color: #5C6370; font-style: italic;">// </span><span style="color: #5C6370; font-style: italic;">this null makes the query below fail.</span>
};

<span style="color: #E5C07B;">IEnumerable</span>&lt;<span style="color: #E5C07B;">int</span>&gt; <span style="color: #E06C75;">flat</span> = numbers.SelectMany (innerArray =&gt; innerArray);
</pre>
</div>

<p>
This will do fine:
</p>
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #E5C07B;">IEnumerable</span>&lt;<span style="color: #E5C07B;">int</span>&gt; <span style="color: #E06C75;">flat</span> = numbers
    .SelectMany (innerArray =&gt; innerArray ?? Enumerable.Empty &lt;<span style="color: #E5C07B;">int</span>&gt;());

<span style="color: #C678DD;">foreach</span> (<span style="color: #E5C07B;">int</span> <span style="color: #E06C75;">i</span> <span style="color: #C678DD;">in</span> flat)
    Console.Write (i + <span style="color: #98C379;">" "</span>); <span style="color: #5C6370; font-style: italic;">// </span><span style="color: #5C6370; font-style: italic;">1 2 3 4 5 6</span>
</pre>
</div>
</div>
</div>
</div>


<div id="outline-container-orgcb0acc6" class="outline-2">
<h2 id="orgcb0acc6"><span class="section-number-2">9</span> Working with JSON</h2>
<div class="outline-text-2" id="text-9">
<p>
Use JsonNode.
</p>

<blockquote>
<p>
JsonNode (in System.Text.Json.Nodes) was introduced in .NET 6, primarily to
satisfy the demand for a writable DOM. However, it is also suitable in read-only scenarios and exposes a somewhat more fluent interface, backed by a traditional DOM that uses classes for JSON values, arrays, and objects (see Figure 11-1). Being classes, they incur a garbage-collection cost, but this is likely to be negligible in most real-world scenarios.
</p>
</blockquote>

<p>
Example:
</p>
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #C678DD;">using</span> <span style="color: #E06C75;">System</span>;
<span style="color: #C678DD;">using</span> <span style="color: #E06C75;">System</span>.<span style="color: #E06C75;">Collections</span>.<span style="color: #E06C75;">Generic</span>;
<span style="color: #C678DD;">using</span> <span style="color: #E06C75;">System</span>.<span style="color: #E06C75;">Linq</span>;
<span style="color: #C678DD;">using</span> <span style="color: #E06C75;">System</span>.<span style="color: #E06C75;">Text</span>.<span style="color: #E06C75;">Json</span>.<span style="color: #E06C75;">Nodes</span>;

Console.<span style="color: #61AFEF;">WriteLine</span>(<span style="color: #C678DD;">new</span> <span style="color: #E5C07B;">string</span>(<span style="color: #98C379;">'='</span>, 15));
Console.<span style="color: #61AFEF;">WriteLine</span>();

<span style="color: #E5C07B;">var</span> <span style="color: #E06C75;">jsonString</span> = <span style="color: #98C379;">""</span><span style="color: #5C6370; font-weight: bold;">"</span>
[
 {
  <span style="color: #98C379;">"FirstName"</span>:<span style="color: #98C379;">"Sara"</span>,
  <span style="color: #98C379;">"LastName"</span>:<span style="color: #98C379;">"Wells"</span>,
  <span style="color: #98C379;">"Age"</span>:35,
  <span style="color: #98C379;">"Friends"</span>:[<span style="color: #98C379;">"Ian"</span>]
 },
 {
  <span style="color: #98C379;">"FirstName"</span>:<span style="color: #98C379;">"Ian"</span>,
  <span style="color: #98C379;">"LastName"</span>:<span style="color: #98C379;">"Weems"</span>,
  <span style="color: #98C379;">"Age"</span>:42,
  <span style="color: #98C379;">"Friends"</span>:[<span style="color: #98C379;">"Joe"</span>,<span style="color: #98C379;">"Eric"</span>,<span style="color: #98C379;">"Li"</span>]
 },
 {
  <span style="color: #98C379;">"FirstName"</span>:<span style="color: #98C379;">"Dylan"</span>,
  <span style="color: #98C379;">"LastName"</span>:<span style="color: #98C379;">"Lockwood"</span>,
  <span style="color: #98C379;">"Age"</span>:46,
  <span style="color: #98C379;">"Friends"</span>:[<span style="color: #98C379;">"Sara"</span>,<span style="color: #98C379;">"Ian"</span>]
 }
]
<span style="color: #98C379;">""</span><span style="color: #5C6370; font-weight: bold;">"</span><span style="color: #98C379;">;</span>

JsonNode node = JsonNode.Parse (jsonString)<span style="color: #56B6C2; font-weight: bold;">!</span>;

<span style="color: #E5C07B;">var</span> <span style="color: #E06C75;">jsonQuery</span> =
    <span style="color: #C678DD;">from</span> person <span style="color: #C678DD;">in</span> node?.<span style="color: #61AFEF;">AsArray</span>()
    <span style="color: #C678DD;">select</span> <span style="color: #C678DD;">new</span>
    {
        <span style="color: #E06C75;">FirstName</span> = (<span style="color: #E5C07B;">string</span>?) person[<span style="color: #98C379;">"FirstName"</span>],
        <span style="color: #E06C75;">Age</span> = (<span style="color: #E5C07B;">int</span>?) person[<span style="color: #98C379;">"Age"</span>],
        <span style="color: #E06C75;">Firends</span> = <span style="color: #C678DD;">from</span> friend <span style="color: #C678DD;">in</span>  person[<span style="color: #98C379;">"Friends"</span>]?.<span style="color: #61AFEF;">AsArray</span>()
        <span style="color: #C678DD;">select</span> (<span style="color: #E5C07B;">string</span>?) friend
    };

<span style="color: #C678DD;">foreach</span> (<span style="color: #E5C07B;">var</span> <span style="color: #E06C75;">e</span> <span style="color: #C678DD;">in</span> jsonQuery)
{
    Console.<span style="color: #61AFEF;">WriteLine</span>(<span style="color: #98C379;">"FirstName: "</span> + e.FirstName);
    Console.<span style="color: #61AFEF;">WriteLine</span>(<span style="color: #98C379;">"Age: "</span> + e.Age);
    Console.<span style="color: #61AFEF;">Write</span>(<span style="color: #98C379;">"Friends: "</span>);
    <span style="color: #C678DD;">foreach</span> (<span style="color: #E5C07B;">var</span> <span style="color: #E06C75;">friend</span> <span style="color: #C678DD;">in</span> e.Firends)
    {
        Console.<span style="color: #61AFEF;">Write</span>(<span style="color: #98C379;">" "</span> + friend);
    }
    Console.<span style="color: #61AFEF;">WriteLine</span>();
    Console.<span style="color: #61AFEF;">WriteLine</span>();
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org58dc54c" class="outline-2">
<h2 id="org58dc54c"><span class="section-number-2">10</span> Stream and I/O</h2>
<div class="outline-text-2" id="text-10">
</div>
<div id="outline-container-org26d4eb5" class="outline-3">
<h3 id="org26d4eb5"><span class="section-number-3">10.1</span> Stream architecture</h3>
<div class="outline-text-3" id="text-10-1">

<div id="org0a80403" class="figure">
<p><img src="images/StreamArchitecture.jpeg" alt="StreamArchitecture.jpeg" />
</p>
</div>

<blockquote>
<p>
As a rule, streams are not thread-safe, meaning that two threads cannot concurrently
read or write to the same stream without possible error.
</p>
</blockquote>

<blockquote>
<p>
The Stream class
offers a simple workaround via the static Synchronized method. This method
accepts a stream of any type and returns a thread-safe wrapper. The wrapper works
by obtaining an exclusive lock around each read, write, or seek, ensuring that
only one thread can perform such an operation at a time.
</p>
</blockquote>
</div>
</div>

<div id="outline-container-org2807b7f" class="outline-3">
<h3 id="org2807b7f"><span class="section-number-3">10.2</span> <code>FileStream</code></h3>
<div class="outline-text-3" id="text-10-2">
</div>
<div id="outline-container-org587b878" class="outline-4">
<h4 id="org587b878"><span class="section-number-4">10.2.1</span> Create with facade static methods</h4>
<div class="outline-text-4" id="text-10-2-1">
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #E5C07B;">FileStream</span> <span style="color: #E06C75;">fs1</span> = File.OpenRead (<span style="color: #98C379;">"readme.bin"</span>); <span style="color: #5C6370; font-style: italic;">// </span><span style="color: #5C6370; font-style: italic;">Read-only</span>
<span style="color: #E5C07B;">FileStream</span> <span style="color: #E06C75;">fs2</span> = File.OpenWrite (<span style="color: #98C379;">"writeme.tmp"</span>); <span style="color: #5C6370; font-style: italic;">// </span><span style="color: #5C6370; font-style: italic;">Write-only</span>
<span style="color: #E5C07B;">FileStream</span> <span style="color: #E06C75;">fs3</span> = File.Create (<span style="color: #98C379;">"readwrite.tmp"</span>); <span style="color: #5C6370; font-style: italic;">// </span><span style="color: #5C6370; font-style: italic;">Read/write</span>
</pre>
</div>

<p>
Equivalent:
</p>
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #C678DD;">using</span> <span style="color: #E06C75;">var</span> f<span style="color: #E06C75;">s</span> = <span style="color: #E06C75;">new</span> F<span style="color: #E06C75;">ileStream</span> (<span style="color: #98C379;">"readwrite.tmp"</span>, FileMode.Open);
</pre>
</div>
</div>
</div>

<div id="outline-container-orgaedec60" class="outline-4">
<h4 id="orgaedec60"><span class="section-number-4">10.2.2</span> Specify file name</h4>
<div class="outline-text-4" id="text-10-2-2">
<blockquote>
<p>
AppDomain.CurrentDomain.BaseDirectory returns the application base directory,
which in normal cases is the folder containing the programs executable.
</p>
</blockquote>

<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #E5C07B;">string</span> <span style="color: #E06C75;">baseFolder</span> = AppDomain.CurrentDomain.BaseDirectory;
<span style="color: #E5C07B;">string</span> <span style="color: #E06C75;">logoPath</span> = Path.Combine (baseFolder, <span style="color: #98C379;">"logo.jpg"</span>);
Console.WriteLine (File.Exists (logoPath));
</pre>
</div>
</div>
</div>

<div id="outline-container-org81de674" class="outline-4">
<h4 id="org81de674"><span class="section-number-4">10.2.3</span> Read file content</h4>
<div class="outline-text-4" id="text-10-2-3">
<blockquote>
<ul class="org-ul">
<li>File.ReadAllText (returns a string)</li>
<li>File.ReadAllLines (returns an array of strings)</li>
<li>File.ReadAllBytes (returns a byte array)</li>
</ul>
</blockquote>

<p>
Use <code>File.ReadLines</code> for lazy LINQ queries:
</p>
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #E5C07B;">int</span> <span style="color: #E06C75;">longLines</span> = File.ReadLines (<span style="color: #98C379;">"filePath"</span>)
    .Count (l =&gt; l.Length &gt; 80);
</pre>
</div>
</div>
</div>


<div id="outline-container-org1ad58a0" class="outline-4">
<h4 id="org1ad58a0"><span class="section-number-4">10.2.4</span> Write into file</h4>
<div class="outline-text-4" id="text-10-2-4">
<div class="org-src-container">
<pre class="src src-csharp">- File.WriteAllText
- File.WriteAllLines
- File.WriteAllBytes
- File.AppendAllText (great <span style="color: #C678DD;">for</span> appending to a log file)
</pre>
</div>

<blockquote>
<p>
Coupling a BufferedStream to a FileStream, as in this example, is of limited
value because FileStream already has built-in buffering. Its only use might be in
enlarging the buffer on an already-constructed FileStream.
</p>
</blockquote>
</div>
</div>
</div>

<div id="outline-container-orgb67a37f" class="outline-3">
<h3 id="orgb67a37f"><span class="section-number-3">10.3</span> <code>StreamReader</code> and <code>StreamWriter</code></h3>
<div class="outline-text-3" id="text-10-3">
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #C678DD;">using</span> (<span style="color: #E5C07B;">FileStream</span> <span style="color: #E06C75;">fs</span> = File.Create (<span style="color: #98C379;">"test.txt"</span>))
<span style="color: #C678DD;">using</span> (<span style="color: #E5C07B;">TextWriter</span> <span style="color: #E06C75;">writer</span> = <span style="color: #C678DD;">new</span> <span style="color: #E5C07B;">StreamWriter</span> (fs))
{
    writer.WriteLine (<span style="color: #98C379;">"Line1"</span>);
    writer.WriteLine (<span style="color: #98C379;">"Line2"</span>);
}
<span style="color: #C678DD;">using</span> (<span style="color: #E5C07B;">FileStream</span> <span style="color: #E06C75;">fs</span> = File.OpenRead (<span style="color: #98C379;">"test.txt"</span>))
<span style="color: #C678DD;">using</span> (<span style="color: #E5C07B;">TextReader</span> <span style="color: #E06C75;">reader</span> = <span style="color: #C678DD;">new</span> <span style="color: #E5C07B;">StreamReader</span> (fs))
{
    Console.WriteLine (reader.<span style="color: #61AFEF;">ReadLine</span>()); <span style="color: #5C6370; font-style: italic;">// </span><span style="color: #5C6370; font-style: italic;">Line1</span>
    Console.WriteLine (reader.<span style="color: #61AFEF;">ReadLine</span>()); <span style="color: #5C6370; font-style: italic;">// </span><span style="color: #5C6370; font-style: italic;">Line2</span>
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org8c06633" class="outline-3">
<h3 id="org8c06633"><span class="section-number-3">10.4</span> File and Directory Operations</h3>
<div class="outline-text-3" id="text-10-4">
</div>
<div id="outline-container-org75a6975" class="outline-4">
<h4 id="org75a6975"><span class="section-number-4">10.4.1</span> <code>File</code></h4>
<div class="outline-text-4" id="text-10-4-1">
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #E5C07B;">bool</span> <span style="color: #61AFEF;">Exists</span> (<span style="color: #E5C07B;">string</span> <span style="color: #E06C75;">path</span>); <span style="color: #5C6370; font-style: italic;">// </span><span style="color: #5C6370; font-style: italic;">Returns true if the file is present</span>
<span style="color: #E5C07B;">void</span> <span style="color: #61AFEF;">Delete</span> (<span style="color: #E5C07B;">string</span> <span style="color: #E06C75;">path</span>);
<span style="color: #E5C07B;">void</span> <span style="color: #61AFEF;">Copy</span> (<span style="color: #E5C07B;">string</span> <span style="color: #E06C75;">sourceFileName</span>, <span style="color: #E5C07B;">string</span> <span style="color: #E06C75;">destFileName</span>);
<span style="color: #E5C07B;">void</span> <span style="color: #61AFEF;">Move</span> (<span style="color: #E5C07B;">string</span> <span style="color: #E06C75;">sourceFileName</span>, <span style="color: #E5C07B;">string</span> <span style="color: #E06C75;">destFileName</span>);
<span style="color: #E5C07B;">void</span> <span style="color: #61AFEF;">Replace</span> (<span style="color: #E5C07B;">string</span> <span style="color: #E06C75;">sourceFileName</span>, <span style="color: #E5C07B;">string</span> <span style="color: #E06C75;">destinationFileName</span>,
<span style="color: #E5C07B;">string</span> <span style="color: #E06C75;">destinationBackupFileName</span>);
<span style="color: #E5C07B;">FileAttributes</span> <span style="color: #61AFEF;">GetAttributes</span> (<span style="color: #E5C07B;">string</span> <span style="color: #E06C75;">path</span>);
<span style="color: #E5C07B;">void</span> <span style="color: #61AFEF;">SetAttributes</span> (<span style="color: #E5C07B;">string</span> <span style="color: #E06C75;">path</span>, <span style="color: #E5C07B;">FileAttributes</span> <span style="color: #E06C75;">fileAttributes</span>);
<span style="color: #E5C07B;">void</span> <span style="color: #61AFEF;">Decrypt</span> (<span style="color: #E5C07B;">string</span> <span style="color: #E06C75;">path</span>);
<span style="color: #E5C07B;">void</span> <span style="color: #61AFEF;">Encrypt</span> (<span style="color: #E5C07B;">string</span> <span style="color: #E06C75;">path</span>);
<span style="color: #E5C07B;">DateTime</span> <span style="color: #61AFEF;">GetCreationTime</span> (<span style="color: #E5C07B;">string</span> <span style="color: #E06C75;">path</span>); <span style="color: #5C6370; font-style: italic;">// </span><span style="color: #5C6370; font-style: italic;">UTC versions are</span>
<span style="color: #E5C07B;">DateTime</span> <span style="color: #61AFEF;">GetLastAccessTime</span> (<span style="color: #E5C07B;">string</span> <span style="color: #E06C75;">path</span>); <span style="color: #5C6370; font-style: italic;">// </span><span style="color: #5C6370; font-style: italic;">also provided.</span>
<span style="color: #E5C07B;">DateTime</span> <span style="color: #61AFEF;">GetLastWriteTime</span> (<span style="color: #E5C07B;">string</span> <span style="color: #E06C75;">path</span>);
<span style="color: #E5C07B;">void</span> <span style="color: #61AFEF;">SetCreationTime</span> (<span style="color: #E5C07B;">string</span> <span style="color: #E06C75;">path</span>, <span style="color: #E5C07B;">DateTime</span> <span style="color: #E06C75;">creationTime</span>);
<span style="color: #E5C07B;">void</span> <span style="color: #61AFEF;">SetLastAccessTime</span> (<span style="color: #E5C07B;">string</span> <span style="color: #E06C75;">path</span>, <span style="color: #E5C07B;">DateTime</span> <span style="color: #E06C75;">lastAccessTime</span>);
<span style="color: #E5C07B;">void</span> <span style="color: #61AFEF;">SetLastWriteTime</span> (<span style="color: #E5C07B;">string</span> <span style="color: #E06C75;">path</span>, <span style="color: #E5C07B;">DateTime</span> <span style="color: #E06C75;">lastWriteTime</span>);
<span style="color: #E5C07B;">FileSecurity</span> <span style="color: #61AFEF;">GetAccessControl</span> (<span style="color: #E5C07B;">string</span> <span style="color: #E06C75;">path</span>);
<span style="color: #E5C07B;">FileSecurity</span> <span style="color: #61AFEF;">GetAccessControl</span> (<span style="color: #E5C07B;">string</span> <span style="color: #E06C75;">path</span>,
<span style="color: #E5C07B;">AccessControlSections</span> <span style="color: #E06C75;">includeSections</span>);
<span style="color: #E5C07B;">void</span> <span style="color: #61AFEF;">SetAccessControl</span> (<span style="color: #E5C07B;">string</span> <span style="color: #E06C75;">path</span>, <span style="color: #E5C07B;">FileSecurity</span> <span style="color: #E06C75;">fileSecurity</span>);
</pre>
</div>
</div>
</div>

<div id="outline-container-orgfd07dee" class="outline-4">
<h4 id="orgfd07dee"><span class="section-number-4">10.4.2</span> <code>Directory</code></h4>
<div class="outline-text-4" id="text-10-4-2">
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #E5C07B;">string</span> <span style="color: #61AFEF;">GetCurrentDirectory</span> ();
<span style="color: #E5C07B;">void</span> <span style="color: #61AFEF;">SetCurrentDirectory</span> (<span style="color: #E5C07B;">string</span> <span style="color: #E06C75;">path</span>);
<span style="color: #E5C07B;">DirectoryInfo</span> <span style="color: #61AFEF;">CreateDirectory</span> (<span style="color: #E5C07B;">string</span> <span style="color: #E06C75;">path</span>);
<span style="color: #E5C07B;">DirectoryInfo</span> <span style="color: #61AFEF;">GetParent</span> (<span style="color: #E5C07B;">string</span> <span style="color: #E06C75;">path</span>);
<span style="color: #E5C07B;">string</span> <span style="color: #61AFEF;">GetDirectoryRoot</span> (<span style="color: #E5C07B;">string</span> <span style="color: #E06C75;">path</span>);
<span style="color: #E5C07B;">string</span>[] <span style="color: #61AFEF;">GetLogicalDrives</span>(); <span style="color: #5C6370; font-style: italic;">// </span><span style="color: #5C6370; font-style: italic;">Gets mount points on Unix</span>

<span style="color: #5C6370; font-style: italic;">// </span><span style="color: #5C6370; font-style: italic;">The following methods all return full paths:</span>
<span style="color: #E5C07B;">string</span>[] <span style="color: #61AFEF;">GetFiles</span> (<span style="color: #E5C07B;">string</span> <span style="color: #E06C75;">path</span>);
<span style="color: #E5C07B;">string</span>[] <span style="color: #61AFEF;">GetDirectories</span> (<span style="color: #E5C07B;">string</span> <span style="color: #E06C75;">path</span>);
<span style="color: #E5C07B;">string</span>[] <span style="color: #61AFEF;">GetFileSystemEntries</span> (<span style="color: #E5C07B;">string</span> <span style="color: #E06C75;">path</span>);
<span style="color: #E5C07B;">IEnumerable</span>&lt;<span style="color: #E5C07B;">string</span>&gt; <span style="color: #61AFEF;">EnumerateFiles</span> (<span style="color: #E5C07B;">string</span> <span style="color: #E06C75;">path</span>);
<span style="color: #E5C07B;">IEnumerable</span>&lt;<span style="color: #E5C07B;">string</span>&gt; <span style="color: #61AFEF;">EnumerateDirectories</span> (<span style="color: #E5C07B;">string</span> <span style="color: #E06C75;">path</span>);
<span style="color: #E5C07B;">IEnumerable</span>&lt;<span style="color: #E5C07B;">string</span>&gt; <span style="color: #61AFEF;">EnumerateFileSystemEntries</span> (<span style="color: #E5C07B;">string</span> <span style="color: #E06C75;">path</span>);
</pre>
</div>
</div>
</div>

<div id="outline-container-orgba2aa48" class="outline-4">
<h4 id="orgba2aa48"><span class="section-number-4">10.4.3</span> <code>Path</code></h4>
<div class="outline-text-4" id="text-10-4-3">
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #E5C07B;">string</span> <span style="color: #E06C75;">dir</span> = @<span style="color: #98C379;">"c:\mydir"</span>; <span style="color: #5C6370; font-style: italic;">// </span><span style="color: #5C6370; font-style: italic;">or /mydir</span>
<span style="color: #E5C07B;">string</span> <span style="color: #E06C75;">file</span> = <span style="color: #98C379;">"myfile.txt"</span>;
<span style="color: #E5C07B;">string</span> <span style="color: #E06C75;">path</span> = @<span style="color: #98C379;">"c:\mydir\myfile.txt"</span>; <span style="color: #5C6370; font-style: italic;">// </span><span style="color: #5C6370; font-style: italic;">or /mydir/myfile.txt</span>
</pre>
</div>

<blockquote>
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<tbody>
<tr>
<td class="org-left">Path.IsPathRooted (file)</td>
<td class="org-left">False</td>
</tr>

<tr>
<td class="org-left">Path.IsPathRooted (path)</td>
<td class="org-left">True</td>
</tr>

<tr>
<td class="org-left">Path.GetPathRoot (path)</td>
<td class="org-left">c:\ or /</td>
</tr>

<tr>
<td class="org-left">Path.GetDirectoryName (path)</td>
<td class="org-left">c:\mydir or /mydir</td>
</tr>

<tr>
<td class="org-left">Path.GetFileName (path)</td>
<td class="org-left">myfile.txt</td>
</tr>

<tr>
<td class="org-left">Path.GetFullPath (file)</td>
<td class="org-left">k:\demo\myfile.txt or /demo/myfile.txt</td>
</tr>

<tr>
<td class="org-left">Path.Combine (dir, file)</td>
<td class="org-left">c:\mydir\myfile.txt or /mydir/myfile.txt</td>
</tr>
</tbody>
</table>
<p>
File extensions:
</p>
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<tbody>
<tr>
<td class="org-left">Path.HasExtension (file)</td>
<td class="org-left">True</td>
</tr>

<tr>
<td class="org-left">Path.GetExtension (file)</td>
<td class="org-left">.txt</td>
</tr>

<tr>
<td class="org-left">Path.GetFileNameWithoutExtension (file)</td>
<td class="org-left">myfile</td>
</tr>

<tr>
<td class="org-left">Path.ChangeExtension (file, ".log")</td>
<td class="org-left">myfile.log</td>
</tr>
</tbody>
</table>
</blockquote>
</div>
</div>
</div>

<div id="outline-container-org98ed3ae" class="outline-3">
<h3 id="org98ed3ae"><span class="section-number-3">10.5</span> Catching Filesystem Events</h3>
<div class="outline-text-3" id="text-10-5">
<p>
Example:
</p>

<div class="org-src-container">
<pre class="src src-csharp">Watch (<span style="color: #61AFEF;">GetTestDirectory</span>(), <span style="color: #98C379;">"*.txt"</span>, <span style="color: #56B6C2;">true</span>);

<span style="color: #E5C07B;">void</span> <span style="color: #61AFEF;">Watch</span> (<span style="color: #E5C07B;">string</span> <span style="color: #E06C75;">path</span>, <span style="color: #E5C07B;">string</span> <span style="color: #E06C75;">filter</span>, <span style="color: #E5C07B;">bool</span> <span style="color: #E06C75;">includeSubDirs</span>)
{
    <span style="color: #C678DD;">using</span> (<span style="color: #E5C07B;">var</span> <span style="color: #E06C75;">watcher</span> = <span style="color: #C678DD;">new</span> <span style="color: #E5C07B;">FileSystemWatcher</span> (path, filter))
    {
        watcher.Created += FileCreatedChangedDeleted;
        watcher.Changed += FileCreatedChangedDeleted;
        watcher.Deleted += FileCreatedChangedDeleted;
        watcher.Renamed += FileRenamed;
        watcher.Error += FileError;
        watcher.IncludeSubdirectories = includeSubDirs;
        watcher.EnableRaisingEvents = <span style="color: #56B6C2;">true</span>;
        Console.WriteLine (<span style="color: #98C379;">"Listening for events - press &lt;enter&gt; to end"</span>);
        Console.<span style="color: #61AFEF;">ReadLine</span>();
    }
    <span style="color: #5C6370; font-style: italic;">// </span><span style="color: #5C6370; font-style: italic;">Disposing the FileSystemWatcher stops further events from firing.</span>
}

<span style="color: #E5C07B;">void</span> <span style="color: #61AFEF;">FileCreatedChangedDeleted</span> (<span style="color: #E5C07B;">object</span> <span style="color: #E06C75;">o</span>, <span style="color: #E5C07B;">FileSystemEventArgs</span> <span style="color: #E06C75;">e</span>)
    =&gt; Console.WriteLine (<span style="color: #98C379;">"File {0} has been {1}"</span>, e.FullPath, e.ChangeType);

<span style="color: #E5C07B;">void</span> <span style="color: #61AFEF;">FileRenamed</span> (<span style="color: #E5C07B;">object</span> <span style="color: #E06C75;">o</span>, <span style="color: #E5C07B;">RenamedEventArgs</span> <span style="color: #E06C75;">e</span>)
    =&gt; Console.WriteLine (<span style="color: #98C379;">"Renamed: {0}-&gt;{1}"</span>, e.OldFullPath, e.FullPath);

<span style="color: #E5C07B;">void</span> <span style="color: #61AFEF;">FileError</span> (<span style="color: #E5C07B;">object</span> <span style="color: #E06C75;">o</span>, <span style="color: #E5C07B;">ErrorEventArgs</span> <span style="color: #E06C75;">e</span>)
    =&gt; Console.WriteLine (<span style="color: #98C379;">"Error: "</span> + e.<span style="color: #61AFEF;">GetException</span>().Message);

<span style="color: #E5C07B;">string</span> <span style="color: #61AFEF;">GetTestDirectory</span>() =&gt;
    RuntimeInformation.IsOSPlatform (OSPlatform.Windows)
    ? @<span style="color: #98C379;">"C:\Temp"</span>
    : <span style="color: #98C379;">"/tmp"</span>;
</pre>
</div>
</div>
</div>
</div>


<div id="outline-container-orgdc0598d" class="outline-2">
<h2 id="orgdc0598d"><span class="section-number-2">11</span> LogProcessor project</h2>
<div class="outline-text-2" id="text-11">
</div>
<div id="outline-container-orgb36a6e6" class="outline-3">
<h3 id="orgb36a6e6"><span class="section-number-3">11.1</span> Create initial stab</h3>
<div class="outline-text-3" id="text-11-1">
<div class="org-src-container">
<pre class="src src-shell">dotnet new sln -o LogProcessor
<span style="color: #56B6C2;">cd</span> .\LogProcessor<span style="color: #98C379;">\</span>
dotnet new console -o ./src/LogProcessor
dotnet sln add .\src\LogProcessor\LogProcessor.csproj
dotnet new xunit -o .\test\LogProcessor.Tests
dotnet add .\test\LogProcessor.Tests\LogProcessor.Tests.csproj reference .\src\LogProcessor\Lo...
dotnet sln add .\test\LogProcessor.Tests\LogProcessor.Tests.csproj
dotnet test -l:<span style="color: #98C379;">"console;verbosity=detailed"</span>
dotnet run --project .\src\LogProcessor<span style="color: #98C379;">\</span>
<span style="color: #56B6C2;">cd</span> .\src\LogProcessor<span style="color: #98C379;">\</span>
dotnet add package System.CommandLine --prerelease
dotnet publish -o publish .\src\LogProcessor<span style="color: #98C379;">\</span>
<span style="color: #56B6C2;">cd</span> publish
.\LogProcessor.exe
.\LogProcessor.exe --files <span style="color: #98C379;">"one.txt"</span> <span style="color: #98C379;">"two.txt"</span> --type <span style="color: #98C379;">"NCSA"</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgd16080e" class="outline-3">
<h3 id="orgd16080e"><span class="section-number-3">11.2</span> Working with the GitHub repo</h3>
<div class="outline-text-3" id="text-11-2">
</div>
<div id="outline-container-org9965ace" class="outline-4">
<h4 id="org9965ace"><span class="section-number-4">11.2.1</span> Create a repo with VisualStudio .gitignore</h4>
<div class="outline-text-4" id="text-11-2-1">
<p>
At <a href="https://github.com/rustam-isangulov/HorizonDiscoveryCSharp">https://github.com/rustam-isangulov/HorizonDiscoveryCSharp</a>
</p>
</div>
</div>

<div id="outline-container-org1f07905" class="outline-4">
<h4 id="org1f07905"><span class="section-number-4">11.2.2</span> Clone repo</h4>
<div class="outline-text-4" id="text-11-2-2">
<div class="org-src-container">
<pre class="src src-shell"><span style="color: #56B6C2;">cd</span> HorizonDiscoveryCSharp
</pre>
</div>
</div>
</div>

<div id="outline-container-org07f0662" class="outline-4">
<h4 id="org07f0662"><span class="section-number-4">11.2.3</span> Check <code>.net</code> info:</h4>
<div class="outline-text-4" id="text-11-2-3">
<div class="org-src-container">
<pre class="src src-shell">dotnet --info

.NET SDK:
 Version:   7.0.203
 Commit:    5b005c19f5

Runtime Environment:
 OS Name:     Windows
 OS Version:  10.0.19045
 OS Platform: Windows
 RID:         win10-x64
 Base Path:   C:\Program Files\dotnet\sdk\7.0.203<span style="color: #98C379;">\</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgb78cd8f" class="outline-4">
<h4 id="orgb78cd8f"><span class="section-number-4">11.2.4</span> Create a new solution with main and test projects</h4>
<div class="outline-text-4" id="text-11-2-4">
<div class="org-src-container">
<pre class="src src-shell">dotnet new sln -o LogProcessor
<span style="color: #56B6C2;">cd</span> .\LogProcessor<span style="color: #98C379;">\</span>
dotnet new console -o ./src/LogProcessor
dotnet new xunit -o .\test\LogProcessor.Tests
dotnet add .\test\LogProcessor.Tests\LogProcessor.Tests.csproj reference .\src\LogProcessor\LogProcessor.csproj
dotnet sln add .\src\LogProcessor\LogProcessor.csproj
dotnet sln add .\test\LogProcessor.Tests\LogProcessor.Tests.csproj
</pre>
</div>
</div>
</div>

<div id="outline-container-org0c6b5f8" class="outline-4">
<h4 id="org0c6b5f8"><span class="section-number-4">11.2.5</span> Run test and main projects</h4>
<div class="outline-text-4" id="text-11-2-5">
<p>
Test:
</p>
<div class="org-src-container">
<pre class="src src-shell">dotnet test -l:<span style="color: #98C379;">"console;verbosity=detailed"</span>

 Determining projects to restore...
  Restored C:\Users\rustam.isangulov\Projects\CSharpDeepDive\HorizonDiscoveryCSharp\LogProcessor\test\LogProcessor.Tests\LogProcessor.Tests.csproj (<span style="color: #C678DD;">in</span> 528
  ms).
  1 of 2 projects are up-to-date for restore.
  LogProcessor -&gt; C:\Users\rustam.isangulov\Projects\CSharpDeepDive\HorizonDiscoveryCSharp\LogProcessor\src\LogProcessor\bin\Debug\net7.0\LogProcessor.dll
  LogProcessor.Tests -&gt; C:\Users\rustam.isangulov\Projects\CSharpDeepDive\HorizonDiscoveryCSharp\LogProcessor\test\LogProcessor.Tests\bin\Debug\net7.0\LogP
  rocessor.Tests.dll
Test run for C:\Users\rustam.isangulov\Projects\CSharpDeepDive\HorizonDiscoveryCSharp\LogProcessor\test\LogProcessor.Tests\bin\Debug\net7.0\LogProcessor.Tests.dll (.NETCoreApp,<span style="color: #E06C75;">Version</span>=v7.0)
<span style="color: #61AFEF;">Microsoft</span> (R) Test Execution Command Line Tool Version 17.5.0 (x64)
<span style="color: #61AFEF;">Copyright</span> (c) Microsoft Corporation.  All rights reserved.

Starting test execution, please wait...
A total of 1 test files matched the specified pattern.
C:\Users\rustam.isangulov\Projects\CSharpDeepDive\HorizonDiscoveryCSharp\LogProcessor\test\LogProcessor.Tests\bin\Debug\net7.0\LogProcessor.Tests.dll
[xUnit.net 00:00:00.00] xUnit.net VSTest Adapter v2.4.5+1caef2f33e (64-bit .NET 7.0.5)
[xUnit.net 00:00:00.96]   Discovering: LogProcessor.Tests
[xUnit.net 00:00:00.98]   Discovered:  LogProcessor.Tests
[xUnit.net 00:00:00.98]   Starting:    LogProcessor.Tests
[xUnit.net 00:00:01.02]   Finished:    LogProcessor.Tests
  Passed LogProcessor.Tests.UnitTest1.Test1 [1 ms]

Test Run Successful.
Total tests: 1
     Passed: 1
 Total time: 1.8314 Seconds
</pre>
</div>

<p>
Run:
</p>
<div class="org-src-container">
<pre class="src src-shell">dotnet run --project .\src\LogProcessor<span style="color: #98C379;">\</span>

Hello, World!
</pre>
</div>
</div>
</div>

<div id="outline-container-org19c81e0" class="outline-4">
<h4 id="org19c81e0"><span class="section-number-4">11.2.6</span> Add command line parser to the main project</h4>
<div class="outline-text-4" id="text-11-2-6">
<div class="org-src-container">
<pre class="src src-shell">dotnet add .\src\LogProcessor\LogProcessor.csproj package System.CommandLine --prerelease
</pre>
</div>

<p>
Update <code>Program.cs</code> content:
</p>

<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #C678DD;">using</span> <span style="color: #E06C75;">System</span>.<span style="color: #E06C75;">CommandLine</span>;

<span style="color: #C678DD;">namespace</span> <span style="color: #E06C75;">LogProcessor</span>;

<span style="color: #C678DD;">public</span> <span style="color: #C678DD;">class</span> <span style="color: #E5C07B;">Program</span>
{
    <span style="color: #C678DD;">private</span> <span style="color: #C678DD;">const</span> <span style="color: #E5C07B;">string</span> <span style="color: #E06C75;">_description</span> = <span style="color: #98C379;">"Log processor parses log files, filters, aggregates and outputs ranked list of entries."</span>;

    <span style="color: #C678DD;">public</span> <span style="color: #C678DD;">static</span> <span style="color: #E5C07B;">int</span> <span style="color: #61AFEF;">Main</span> (<span style="color: #E5C07B;">string</span>[] <span style="color: #E06C75;">args</span>)
    {
        <span style="color: #E5C07B;">var</span> <span style="color: #E06C75;">filesOption</span> = <span style="color: #C678DD;">new</span> <span style="color: #E5C07B;">Option</span>&lt;<span style="color: #E5C07B;">string</span>[]&gt;
            (
                name: <span style="color: #98C379;">"--files"</span>,
                description: <span style="color: #98C379;">"Files to process"</span>
            )
            {
                IsRequired = <span style="color: #56B6C2;">true</span>,
                AllowMultipleArgumentsPerToken = <span style="color: #56B6C2;">true</span>
            };

        <span style="color: #E5C07B;">var</span> <span style="color: #E06C75;">typeOption</span> = <span style="color: #C678DD;">new</span> <span style="color: #E5C07B;">Option</span>&lt;<span style="color: #E5C07B;">string</span>&gt;
            (
                name: <span style="color: #98C379;">"--type"</span>,
                description: <span style="color: #98C379;">"Processor type"</span>
            )
            { IsRequired = <span style="color: #56B6C2;">true</span> }
            .<span style="color: #61AFEF;">FromAmong</span>(<span style="color: #98C379;">"W3C"</span>,<span style="color: #98C379;">"NCSA"</span>);

        <span style="color: #E5C07B;">var</span> <span style="color: #E06C75;">rootCommand</span> = <span style="color: #C678DD;">new</span> <span style="color: #E5C07B;">RootCommand</span>(<span style="color: #E5C07B;">_description</span>);
        rootCommand.<span style="color: #61AFEF;">Add</span>(<span style="color: #E5C07B;">filesOption</span>);
        rootCommand.<span style="color: #61AFEF;">Add</span>(<span style="color: #E5C07B;">typeOption</span>);

        rootCommand.<span style="color: #61AFEF;">SetHandler</span>((<span style="color: #E5C07B;">filesOptionValues</span>, <span style="color: #E5C07B;">typeOptionValue</span>) =&gt;
                               <span style="color: #61AFEF;">RunProcessor</span>(<span style="color: #E5C07B;">filesOptionValues</span>, <span style="color: #E5C07B;">typeOptionValue</span>),
                               <span style="color: #E5C07B;">filesOption</span>,
                               <span style="color: #E5C07B;">typeOption</span>);

        <span style="color: #C678DD;">return</span> rootCommand.<span style="color: #61AFEF;">InvokeAsync</span>(<span style="color: #E5C07B;">args</span>).Result;
    }

    <span style="color: #C678DD;">internal</span> <span style="color: #C678DD;">static</span> <span style="color: #E5C07B;">void</span> <span style="color: #61AFEF;">RunProcessor</span>(<span style="color: #E5C07B;">IList</span>&lt;<span style="color: #E5C07B;">string</span>&gt; <span style="color: #E06C75;">files</span>, <span style="color: #E5C07B;">string</span> <span style="color: #E06C75;">type</span>)
    {
        Console.<span style="color: #61AFEF;">WriteLine</span>(<span style="color: #98C379;">"files to process:"</span>);
        <span style="color: #C678DD;">foreach</span> (<span style="color: #E5C07B;">var</span> <span style="color: #E06C75;">file</span> <span style="color: #C678DD;">in</span> files)
        {
            Console.<span style="color: #61AFEF;">WriteLine</span>($<span style="color: #98C379;">"\t: {file}"</span>);
        }
        Console.<span style="color: #61AFEF;">WriteLine</span>($<span style="color: #98C379;">"log type: {type}"</span>);
    }
}
</pre>
</div>

<p>
Run with no argument:
</p>
<div class="org-src-container">
<pre class="src src-shell">dotnet run --project .\src\LogProcessor<span style="color: #98C379;">\</span>

Option <span style="color: #98C379;">'--files'</span> is required.
Option <span style="color: #98C379;">'--type'</span> is required.

Description:
  Log processor parses log files, filters, aggregates and outputs ranked list of entries.

Usage:
  LogProcessor [options]

Options:
  --files &lt;files&gt; (REQUIRED)    Files to process
  --type &lt;NCSA|W3C&gt; (REQUIRED)  Processor type
  --version                     Show version information
  -?, -h, --help                Show help and usage information
</pre>
</div>

<p>
Run with expected arguments:
</p>
<div class="org-src-container">
<pre class="src src-shell">dotnet run --project .\src\LogProcessor<span style="color: #98C379;">\ </span>-- --files <span style="color: #98C379;">"one.txt"</span> <span style="color: #98C379;">"two.txt"</span> --type W3C

files to process:
        : one.txt
        : two.txt
log type: W3C
</pre>
</div>
</div>
</div>

<div id="outline-container-org9420e55" class="outline-4">
<h4 id="org9420e55"><span class="section-number-4">11.2.7</span> Update test project</h4>
<div class="outline-text-4" id="text-11-2-7">
<ul class="org-ul">
<li>Delete default UnitTest1.cs</li>
<li>Add ProgramUnitTest.cs</li>
</ul>

<p>
Update <code>PrpgramUnitTest.cs</code> content:
</p>

<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #C678DD;">using</span> <span style="color: #E06C75;">Xunit</span>;
<span style="color: #C678DD;">using</span> <span style="color: #E06C75;">Xunit</span>.<span style="color: #E06C75;">Abstractions</span>;

<span style="color: #C678DD;">using</span> <span style="color: #E06C75;">LogProcessor</span>;

<span style="color: #C678DD;">namespace</span> <span style="color: #E06C75;">LogProcessor</span>.<span style="color: #E06C75;">Tests</span>;

<span style="color: #C678DD;">public</span> <span style="color: #C678DD;">class</span> <span style="color: #E5C07B;">ProgramUnitTests</span>
{
    [<span style="color: #E06C75;">Fact</span>]
    <span style="color: #C678DD;">public</span> <span style="color: #E5C07B;">void</span> <span style="color: #61AFEF;">Test_EmptyArgumentsString</span>()
    {
        <span style="color: #E5C07B;">var</span> <span style="color: #E06C75;">expected</span> = 1;

        <span style="color: #E5C07B;">var</span> <span style="color: #E06C75;">actual</span> = Program.<span style="color: #61AFEF;">Main</span>(<span style="color: #C678DD;">new</span> <span style="color: #E5C07B;">string</span>[0]);

        Assert.<span style="color: #61AFEF;">Equal</span>(<span style="color: #E5C07B;">expected</span>, <span style="color: #E5C07B;">actual</span>);
    }

    [<span style="color: #E06C75;">Fact</span>]
    <span style="color: #C678DD;">public</span> <span style="color: #E5C07B;">void</span> <span style="color: #61AFEF;">Test_GoodArgumentsString</span>()
    {
        <span style="color: #E5C07B;">var</span> <span style="color: #E06C75;">expected</span> = 0;

        <span style="color: #E5C07B;">var</span> <span style="color: #E06C75;">actual</span> = Program.Main
            (
                <span style="color: #C678DD;">new</span> <span style="color: #E5C07B;">string</span>[]
                {
                    <span style="color: #98C379;">"--files"</span>, <span style="color: #98C379;">"one.txt"</span>, <span style="color: #98C379;">"two.txt"</span>,
                    <span style="color: #98C379;">"--type"</span>, <span style="color: #98C379;">"W3C"</span>
                }
            );

        Assert.<span style="color: #61AFEF;">Equal</span>(<span style="color: #E5C07B;">expected</span>, <span style="color: #E5C07B;">actual</span>);
    }
}
</pre>
</div>

<p>
Run tests:
</p>
<div class="org-src-container">
<pre class="src src-shell">dotnet test -l:<span style="color: #98C379;">"console;verbosity=detailed"</span>

Starting test execution, please wait...
A total of 1 test files matched the specified pattern.
C:\Users\rustam.isangulov\Projects\CSharpDeepDive\HorizonDiscoveryCSharp\LogProcessor\test\LogProcessor.Tests\bin\Debug\net7.0\LogProcessor.Tests.dll
[xUnit.net 00:00:00.00] xUnit.net VSTest Adapter v2.4.5+1caef2f33e (64-bit .NET 7.0.5)
[xUnit.net 00:00:00.28]   Discovering: LogProcessor.Tests
[xUnit.net 00:00:00.30]   Discovered:  LogProcessor.Tests
[xUnit.net 00:00:00.30]   Starting:    LogProcessor.Tests
[xUnit.net 00:00:00.39]   Finished:    LogProcessor.Tests
  Passed LogProcessor.Tests.ProgramUnitTests.Test_GoodArgumentsString [24 ms]
  Passed LogProcessor.Tests.ProgramUnitTests.Test_EmptyArgumentsString [24 ms]

Test Run Successful.
Total tests: 2
     Passed: 2
 Total time: 0.8064 Seconds
</pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="date">Created: 2023-06-06 Tue 09:48</p>
<p class="validation"><a href="https://validator.w3.org/check?uri=referer">Validate</a></p>
</div>
</body>
</html>
